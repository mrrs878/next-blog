---
title: "JavaScriptå¤ä¹ -Promise"
tags: "JavaScript Promise Generator Promise"
categories: "2024å¤ä¹ "
description: ""
createDate: "2024-04-07 19:38:54"
updateDate: "2024-04-08 19:47:28"
---

æ·±å…¥ç ”ç©¶ä¸€ä¸‹ `Promise`

ğŸ¤”

## ä»¤äººç–‘æƒ‘çš„æ‰§è¡Œé¡ºåº

è§‚å¯Ÿä»¥ä¸‹ä»£ç ç‰‡æ®µ

``` js
new Promise((resolve) => {
  console.log('promise1 resolve');
  resolve();
}).then(() => {
  console.log('promise1 then1');
  new Promise((resolve) => {
    console.log('promise2 resolve');
    resolve();
  }).then(() => {
    console.log('promise2 then1');
  }).then(() => {
    console.log('promise2 then2');
  })
}).then(() => {
  console.log('promise1 then2');
})
console.log('hello Promise');

// promise1 resolve
// hello Promise
// promise1 then1
// promise2 resolve
// promise2 then1
// promise1 then2
// promise2 then2
```

Q1: ä¸ºä»€ä¹ˆ `hello Promise` åœ¨è¾ƒå‰æ‰“å°ï¼Ÿ
A1: å› ä¸º **éé‡å…¥æœŸçº¦æ–¹æ³•** æœºåˆ¶ï¼Œå³ï¼š å½“ `Promise` è¿›å…¥ `Settled` çŠ¶æ€æ—¶ï¼Œä¸è¯¥çŠ¶æ€ç›¸å…³çš„å¤„ç†ç¨‹åºä»…ä»…ä¼šè¢«æ’æœŸï¼ˆè¿›å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼‰ï¼Œè€Œéç«‹å³æ‰§è¡Œã€‚è·Ÿåœ¨æ·»åŠ è¿™ä¸ªå¤„ç†ç¨‹åºçš„ä»£ç ä¹‹åçš„åŒæ­¥ä»£ç ä¸€å®šä¼šåœ¨å¤„ç†ç¨‹åºä¹‹å‰æ‰§è¡Œã€‚ `new Promise` ä¸­çš„ä»£ç æ˜¯åŒæ­¥çš„ï¼Œ `then` æ–¹æ³•ä¸­çš„å¤„ç†ç¨‹åºæ˜¯æ‰æ˜¯å¼‚æ­¥çš„ã€‚

Q2: ä¸ºä»€ä¹ˆ `promise2 then1` åœ¨ `promise1 then2` å‰æ‰“å°
A2: å½“æ‰“å° `promise2 resolve` åï¼Œæ­¤æ—¶ `promise2` è¿›å…¥ `Settled` çŠ¶æ€ï¼Œæ­¤æ—¶ä¼šå°† `promise2-then1` æ·»åŠ è¿›å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ³¨æ„æ­¤æ—¶ä»åœ¨**æ‰§è¡Œå¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­**çš„ä»»åŠ¡ä¸­ï¼Œå› æ­¤ï¼Œæ¥ä¸‹æ¥ä¼šæ‰“å° `promise2 then1` ã€‚

Q3: ä¸ºä»€ä¹ˆ `promise1 then2` åœ¨ `promise2 then2` å‰æ‰“å°
A3: å½“æ‰“å°å®Œ `promise2 then1` æ—¶ï¼ŒæŒ‰ç†è¯´åº”è¯¥æ³¨å†Œ `promise2-then2` å›è°ƒï¼Œä½†ç¼–è¯‘å™¨ä¼šä¼˜åŒ–ï¼Œé˜²æ­¢ä¸€ä¸ª `Promise` å æ®è¿‡å¤šæ—¶é—´ã€‚å³**å¦‚æœæœ‰å¤šä¸ªfulfilledçš„Promiseå®ä¾‹ï¼ŒåŒæ—¶æ‰§è¡Œthené“¾å¼è°ƒç”¨ï¼Œthenä¼šäº¤æ›¿æ‰§è¡Œã€‚**

## ä¸ºä»€ä¹ˆ Promise çŠ¶æ€ä¸å¯é€†

ç¡®ä¿ `Promise` çš„è¡Œä¸ºæ˜¯å¯é¢„æµ‹å’Œå¯é çš„ã€‚è¿™ä¸ªè®¾è®¡å†³å®šä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› :

- ä¿è¯å¼‚æ­¥æ‰§è¡Œç»“æœçš„å¯é æ€§:ä¸€æ—¦ `Promise` çš„çŠ¶æ€è¢«æ”¹å˜( `fulfilled` æˆ– `rejected` ),å°±ä¸ä¼šå†å‘ç”Ÿå˜åŒ–ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿å¼‚æ­¥æ“ä½œçš„ç»“æœä¸€å®šä¼šè¢«å¯é åœ°ä¼ é€’ç»™åç»­çš„ then æˆ– catch å›è°ƒå‡½æ•°ã€‚

- ç®€åŒ–é”™è¯¯å¤„ç†: `Promise` çš„çŠ¶æ€ä¸€æ—¦æ”¹å˜å°±ä¸å¯é€†,è¿™æ„å‘³ç€ä¸€ä¸ª `Promise` å¯¹è±¡åªä¼šè§¦å‘ä¸€æ¬¡ `then` æˆ– `catch` å›è°ƒã€‚è¿™ç®€åŒ–äº†é”™è¯¯å¤„ç†çš„é€»è¾‘,å¼€å‘è€…ä¸éœ€è¦æ‹…å¿ƒçŠ¶æ€å†æ¬¡æ”¹å˜è€Œå¼•å‘æ–°çš„é”™è¯¯ã€‚

- é¿å…ç«æ€æ¡ä»¶: å¦‚æœ `Promise` çŠ¶æ€å¯é€†,å°±å¯èƒ½å‡ºç°ç«æ€æ¡ä»¶,å³å¤šä¸ªå¼‚æ­¥æ“ä½œåŒæ—¶ä¿®æ”¹ `Promise` çŠ¶æ€,å¯¼è‡´ç»“æœä¸å¯é¢„æµ‹ã€‚çŠ¶æ€ä¸å¯é€†å¯ä»¥é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚

- æ›´å¥½çš„å¹¶è¡Œå’Œä¸²è¡Œç»„åˆ: `Promise` çš„çŠ¶æ€ä¸å¯é€†ä½¿å¾—å¤šä¸ª `Promise` çš„å¹¶è¡Œå’Œä¸²è¡Œç»„åˆå˜å¾—æ›´åŠ ç®€å•å’Œå¯é ã€‚å¼€å‘è€…å¯ä»¥æ”¾å¿ƒåœ°ä½¿ç”¨ `Promise.all` ã€ `Promise.race` ç­‰æ–¹æ³•,ä¸å¿…æ‹…å¿ƒçŠ¶æ€çš„å˜åŒ–ä¼šå½±å“ç»“æœã€‚

æ€»ä¹‹, `Promise` çŠ¶æ€ä¸å¯é€†æ˜¯ä¸ºäº†ç¡®ä¿å¼‚æ­¥ç¼–ç¨‹ä¸­çš„å¯é æ€§å’Œå¯é¢„æµ‹æ€§,è¿™æ˜¯ `Promise` è®¾è®¡çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ã€‚è™½ç„¶æœ‰æ—¶ä¼šç»™å¼€å‘å¸¦æ¥ä¸€äº›é™åˆ¶,ä½†æ€»çš„æ¥è¯´è¿™æ˜¯ä¸€ä¸ªåˆç†çš„è®¾è®¡å†³å®šã€‚

## ä¸ºä»€ä¹ˆ try/catch æ— æ³•æ•è· Promise.reject

å¦‚ä¸‹æ‰€ç¤º

``` js
try {
  Promise.reject(new Error("foo"));
} catch (e) {
  console.log(e);
}

// Uncaught (in promise) Error: foo
```

`Promise.reject` å¹¶æ²¡æœ‰æŠ›åˆ°æ‰§è¡ŒåŒæ­¥ä»£ç çš„çº¿ç¨‹é‡Œï¼Œè€Œæ˜¯é€šè¿‡æµè§ˆå™¨å¼‚æ­¥æ¶ˆæ¯é˜Ÿåˆ—æ¥å¤„ç†çš„ã€‚å› æ­¤ï¼Œä»£ç ä¸€æ—¦ä»¥å¼‚æ­¥æ¨¡å¼æ‰§è¡Œï¼Œåˆ™å”¯ä¸€ä¸ä¹‹äº¤äº’çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨å¼‚æ­¥ç»“æ„--æ›´å…·ä½“åœ°è¯´ï¼Œå°±æ˜¯ `Promise` çš„æ–¹æ³•

## ä¸ºä»€ä¹ˆ Promise ä¸å¯å–æ¶ˆ

> æˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°æœŸçº¦æ­£åœ¨å¤„ç†è¿‡ç¨‹ä¸­ï¼Œç¨‹åºå´ä¸å†éœ€è¦å…¶ç»“æœçš„æƒ…å½¢ã€‚è¿™æ—¶å€™å¦‚æœèƒ½å¤Ÿå–æ¶ˆæœŸçº¦å°±å¥½äº†ã€‚æŸäº›ç¬¬ä¸‰æ–¹åº“ï¼Œæ¯”å¦‚Bluebirdï¼Œå°±æä¾›äº†è¿™ä¸ªç‰¹æ€§ã€‚å®é™…ä¸Šï¼ŒTC39 å§”å‘˜ä¼šä¹Ÿæ›¾å‡†å¤‡å¢åŠ è¿™ä¸ªç‰¹æ€§ï¼Œä½†ç›¸å…³ææ¡ˆæœ€ç»ˆè¢«æ’¤å›äº†ã€‚ç»“æœï¼ŒES6æœŸçº¦è¢«è®¤ä¸ºæ˜¯â€œæ¿€è¿›çš„â€: åªè¦æœŸçº¦çš„é€»è¾‘å¼€å§‹æ‰§è¡Œï¼Œå°±æ²¡æœ‰åŠæ³•é˜»æ­¢å®ƒæ‰§è¡Œåˆ°å®Œæˆ --JSé«˜ç¨‹4

## ä¸€ä¸ª Promise ä¸€ç›´æ²¡æœ‰è¢« resolve æˆ– reject ä¼šé€ æˆå†…å­˜æ³„æ¼å—

åˆ†æƒ…å†µï¼Œ `Promise` å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼Œä¹Ÿéµå¾ªåƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå½“æ²¡æœ‰å¼•ç”¨æ—¶ï¼Œåœ¨åˆé€‚çš„æ—¶æœºå³è¢«å›æ”¶ã€‚ä½†ä¸€äº›ä¸è§„èŒƒçš„å†™æ³•ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼Œä½†å´ä¸æ˜¯ `Promise` å¼•èµ·çš„ï¼Œæ¯”å¦‚ä¸‹é¢çš„ğŸŒ°

``` js
const p = new Promise((resolve) => {
  setTimeout(resolve, 100000000, null);
});
```

è¿™ä¸ª `Promise` å®ä¾‹å¯èƒ½ä¼šé•¿æ—¶é—´ä¸ä¼šè¢«å›æ”¶ä»è€Œé€ æˆå†…å­˜æ³„æ¼ï¼Œä½†æœ¬è´¨åŸå› åœ¨äº `setTimeout` å†…éƒ¨å¼•ç”¨äº† `resolve` å¯¼è‡´ `Promise` æ— æ³•è¢«å›æ”¶

## å‚è€ƒ

[MDN-ä½¿ç”¨Promise-æ—¶åº](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Using_promises#%E6%97%B6%E5%BA%8F)
