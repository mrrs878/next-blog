---
title: "JavaScriptç›¸å…³-2"
tags: "Javascript åŸºç¡€"
categories: "JavaScript"
description: ""
createDate: "2020-02-12 22:53:13"
updateDate: "2021-05-13 17:47:54"
---


## Promise

**WHAT**

**Promise** å¯¹è±¡ç”¨äºè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„æœ€ç»ˆå®Œæˆ (æˆ–å¤±è´¥), åŠå…¶ç»“æœå€¼.

å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆ

`Promise`å¯èƒ½å¤„äºä»¥ä¸‹ä¸‰ä¸ªçŠ¶æ€ä¹‹ä¸€ï¼š`fulfilled`ã€`rejected`ã€`pending`ã€‚ç”¨æˆ·å¯ä»¥å¯¹`Promise`æ·»åŠ å›è°ƒå‡½æ•°æ¥å¤„ç†æ“ä½œæˆåŠŸçš„ç»“æœæˆ–å¤±è´¥çš„åŸå› 

**WHY**

ä¼ ç»Ÿçš„å¼‚æ­¥ç¼–ç¨‹ç¼ºç‚¹éš¾ä»¥å¿å—:

- ä»£ç è‡ƒè‚¿
- å¯è¯»æ€§å·®
- è€¦åˆåº¦è¿‡é«˜ï¼Œå¯ç»´æŠ¤æ€§å·®
- ä»£ç å¤ç”¨æ€§å·®
- åªèƒ½åœ¨å›è°ƒé‡Œå¤„ç†å¼‚å¸¸

``` javascript
è¯·æ±‚1(function(è¯·æ±‚ç»“æœ1){
    è¯·æ±‚2(function(è¯·æ±‚ç»“æœ2){
        è¯·æ±‚3(function(è¯·æ±‚ç»“æœ3){
            è¯·æ±‚4(function(è¯·æ±‚ç»“æœ4){
                è¯·æ±‚5(function(è¯·æ±‚ç»“æœ5){
                    è¯·æ±‚6(function(è¯·æ±‚ç»“æœ6){
                        ...
                    })
                })
            })
        })
    })
})

new Promise(è¯·æ±‚1)
    .then(è¯·æ±‚2(è¯·æ±‚ç»“æœ1))
    .then(è¯·æ±‚3(è¯·æ±‚ç»“æœ2))
    .then(è¯·æ±‚4(è¯·æ±‚ç»“æœ3))
    .then(è¯·æ±‚5(è¯·æ±‚ç»“æœ4))
    .catch(å¤„ç†å¼‚å¸¸(å¼‚å¸¸ä¿¡æ¯))
```

**HOW**

å¸¸ç”¨APIï¼š

- `Promise.resolve(value)`

  è¿”å›ä¸€ä¸ªçŠ¶æ€ç”±ç»™å®šçš„`value`å†³å®šçš„`Promise`å¯¹è±¡ã€‚å¦‚æœè¯¥å€¼æ—¶`theable`ï¼ˆå³å¸¦æœ‰thenæ–¹æ³•çš„å¯¹è±¡ï¼‰ï¼Œè¿”å›çš„`Promise`å¯¹è±¡çš„æœ€ç»ˆçŠ¶æ€æ˜¯ç”±`then`æ–¹æ³•å†³å®šï¼›å¦åˆ™ï¼ˆè¯¥`value`ä¸ºç©ºã€åŸºæœ¬ç±»å‹æˆ–ä¸å¸¦`then`æ–¹æ³•çš„å¯¹è±¡ï¼‰è¿”å›çš„`Promise`å¯¹è±¡çŠ¶æ€ä¸º`fulfilled`ï¼Œå¹¶ä¸”å°†è¯¥`value	`ä¼ é€’ç»™å¯¹åº”çš„`then`æ–¹æ³•ã€‚é€šå¸¸ï¼Œå¦‚æœä¸çŸ¥é“ä¸€ä¸ªå€¼æ˜¯å¦æ˜¯`Promise`å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨`Promsie.resolve(value)`æ¥è¿”å›ä¸€ä¸ª`Promise`å¯¹è±¡ï¼Œè¿™æ ·å°±èƒ½å°†è¯¥`value`ä»¥`Promise`å¯¹è±¡å½¢å¼ä½¿ç”¨

- `Promise.reject(value)`

  è¿”å›ä¸€ä¸ªçŠ¶æ€ä¸ºå¤±è´¥çš„`Promise`å¯¹è±¡ï¼Œå¹¶å°†ç»™å®šçš„å¤±è´¥ä¿¡æ¯ä¼ é€’ç»™å¯¹åº”çš„å‡ºå¤„ç†æ–¹æ³•

- `Promise.race(interable)`

  å½“`interable`å‚æ•°é‡Œçš„ä»»æ„ä¸€ä¸ªå­`promise`è¢«æ‰§è¡Œå¤±è´¥æˆ–æˆåŠŸåï¼Œçˆ¶`promise`é©¬ä¸Šä¹Ÿä¼šç”¨å­`promise`çš„æˆåŠŸè¿”å›å€¼æˆ–å¤±è´¥è¯¦æƒ…ä½œä¸ºå‚æ•°è°ƒç”¨çˆ¶`promsie`ç»‘å®šçš„ç›¸åº”å¥æŸ„å¹¶è¿”å›è¯¥`promsie`å¯¹è±¡

- `Promise.all(interable)`

  è¿™ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„`promise`å¯¹è±¡ï¼Œè¯¥`promise`å¯¹è±¡åœ¨`interable`å‚æ•°å¯¹è±¡é‡Œæ‰€æœ‰çš„`promise`å¯¹è±¡éƒ½æˆåŠŸçš„æ—¶å€™æ‰ä¼šè§¦å‘æˆåŠŸï¼Œä¸€æ—¦æœ‰ä»»ä½•ä¸€ä¸ª`interable`é‡Œçš„`promise`å¯¹è±¡å¤±è´¥åˆ™ç«‹å³è§¦å‘è¯¥`promise`å¯¹è±¡çš„å¤±è´¥ã€‚è¿™ä¸ªæ–°çš„`promise`å¯¹è±¡åœ¨è§¦å‘æˆåŠŸçŠ¶æ€ä»¥åï¼Œä¼šæŠŠä¸€ä¸ªåŒ…å«`interable`é‡Œæ‰€æœ‰`promise`è¿”å›å€¼çš„æ•°ç»„ä½œä¸ºæˆåŠŸå›è°ƒçš„è¿”å›å€¼ï¼Œé¡ºåºè·Ÿ`interable`çš„é¡ºåºä¿æŒä¸€è‡´ï¼›å¦‚æœè¿™ä¸ªæ–°çš„`promise`å¯¹è±¡å‡ºå‘äº†å¤±è´¥çŠ¶æ€ï¼Œå®ƒä¼šæŠŠ`interable`é‡Œç¬¬ä¸€ä¸ªè§¦å‘å¤±è´¥çš„`promise`å¯¹è±¡çš„é”™è¯¯ä¿¡æ¯ä½œä¸ºå®ƒçš„å¤±è´¥é”™è¯¯ä¿¡æ¯ã€‚`Promise.all`æ–¹æ³•å¸¸ç”¨äºå¤„ç†å¤šä¸ª`promise`å¯¹è±¡çš„çŠ¶æ€é›†åˆ

``` javascript
const fs = require("fs")

fs.readFile("./index.html", { encoding: "utf8" }, (err, data) => {
  console.log(err, data);
})

function _readFile(path, options) {
  return new Promise((resolve, reject) => {
    fs.readFile("./index.html", options, (err, data) => {
      if(err)
        reject(err)
      else
        resolve(data)
    })
  })
}

(async () => {
  try {
    const data = await _readFile("./index.html", "utf8")
    console.log(data);
  } catch (error) {
    console.log(error);
  }
})()
```

## éå†å¯¹è±¡çš„å±æ€§å’Œæ•°ç»„å…ƒç´ çš„æ–¹æ³•

å¯¹è±¡ï¼š

- `for`å¾ªç¯ ğŸ‘

  ``` javascript
  for (let property in obj)
      console.log(property)
  ```

  ç¼ºç‚¹ï¼šä¼šéå†åˆ°å®ƒçš„ç»§æ‰¿å±æ€§ï¼Œåœ¨ä½¿ç”¨ä¹‹å‰éœ€è¦åŠ å…¥`obj.hasOwnProperty(property)`

- `Object.keys(obj).forEach()` ğŸ‘

  ``` javascript
  Object.keys(obj).forEach(property => {
      console.log(property)
  })
  ```

  `Object.keys`è¿”å›ä¸€ä¸ªæœ‰ç»™å®šå¯¹è±¡çš„è‡ªèº«å¯æšä¸¾å±æ€§ç»„æˆçš„æ•°ç»„

- `Object.getOwnPropertyNames(obj).forEach` ğŸ‘

  ``` javascript
  Object.getOwnPropertyNames(obj).forEach(property => {
      console.log(property)
  })
  ```

  `Object.getOwnPropertyNames`è¿”å›ä¸€ä¸ªç”±æŒ‡å®šå¯¹è±¡çš„æ‰€æœ‰è‡ªèº«å±æ€§çš„å±æ€§åï¼ˆåŒ…æ‹¬ä¸å¯æšä¸¾å±æ€§ä½†ä¸åŒ…æ‹¬`Symbol`å€¼ä½œä¸ºåç§°çš„å±æ€§ï¼‰ç»„æˆçš„æ•°ç»„

- `Reflect.ownKeys(target)` ğŸ‘

  åŸºæœ¬ç­‰åŒäº`Object.getOwnPeopertyNames` + `Object.getOwnPropertySymbols`

æ•°ç»„ï¼š**å„å–æ‰€éœ€**

- `for`å¾ªç¯

  æ™®é€šéå†æ–¹æ³•ï¼Œè¾ƒå¸¸ç”¨

- `arr.forEach`

  ç›¸è¾ƒäº`for`ï¼Œ`forEach`ä¸å¯æå‰ç»“æŸå¾ªç¯

- `arr.map/reduce`

## å¯å˜å¯¹è±¡å’Œä¸å¯å˜å¯¹è±¡

**å¯å˜å¯¹è±¡**åœ¨åˆ›å»ºä¹‹åæ˜¯å¯ä»¥è¢«æ”¹å˜çš„

**ä¸å¯å˜å¯¹è±¡**åœ¨åˆ›å»ºä¹‹åæ˜¯ä¸å¯ä»¥è¢«æ”¹å˜çš„

1. åœ¨`JavaScript`ä¸­ï¼Œ`string`å’Œ`number`ä»è®¾è®¡ä¹‹åˆå°±æ˜¯ä¸å¯å˜çš„ï¼ˆimmediateï¼‰
2. ä¸å¯å˜å¯¹è±¡æ˜¯ä¿æŒä¸€ä¸ªå¯¹è±¡çŠ¶æ€ä¸å˜ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯æ˜¯çš„å¼€å‘æ›´åŠ ç®€å•ã€å¯å›æº¯ã€æµ‹è¯•å‹å¥½ï¼Œå‡å°‘äº†ä»»ä½•å¯èƒ½çš„å‰¯ä½œç”¨ã€‚ä½†æ˜¯ï¼Œæ¯å½“æƒ³æ·»åŠ ç‚¹ä¸œè¥¿åˆ°ä¸€ä¸ªä¸å¯å˜å¯¹è±¡é‡Œæ—¶ï¼Œå®ƒä¸€å®šæ˜¯å…ˆæ‹·è´å·²å­˜åœ¨çš„å€¼åˆ°æ–°å®ä¾‹é‡Œï¼Œç„¶åå†ç»™æ–°å®ä¾‹æ·»åŠ å†…å®¹ï¼Œæœ€åè¿”å›æ–°å®ä¾‹ã€‚ç›¸æ¯”å¯å˜å¯¹è±¡ï¼Œè¿™åŠ¿å¿…ä¼šæœ‰æ›´å¤šå†…å­˜ã€è®¡ç®—é‡æ¶ˆè€—

åˆ›å»ºä¸€ä¸ªçº¯å‡½æ•°ï¼ˆpure functionï¼‰

``` javascript
const student = {
    school: "baidu",
    name: "tom",
    age: 21
}

function updateStudent(student, name, age) {
    return {
        ...student,
        name,
        age
    }
}
```

## åŒæ­¥å‡½æ•°å’Œå¼‚æ­¥å‡½æ•°

åŒæ­¥å‡½æ•°é˜»å¡ï¼Œå¼‚æ­¥å‡½æ•°ä¸é˜»å¡ã€‚åœ¨åŒæ­¥å‡½æ•°ä¸­ï¼Œè¯­å¥å®Œæˆåä¸‹ä¸€å¥æ‰æ‰§è¡Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¨‹åºå¯ä»¥æŒ‰ç…§è¯­å¥çš„é¡ºåºè¿›è¡Œç²¾ç¡®è¯„ä¼°ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªè¯­å¥éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œé‚£ä¹ˆç¨‹åºçš„æ‰§è¡Œä¼šåœæ»å¾ˆé•¿æ—¶é—´

å¼‚æ­¥å‡½æ•°é€šå¸¸æ¥å—å›è°ƒä½œä¸ºå‚æ•°ï¼Œåœ¨è°ƒç”¨å¼‚æ­¥å‡½æ•°åç«‹å³ç»§ç»­æ‰§è¡Œä¸‹ä¸€è¡Œã€‚å›è°ƒå‡½æ•°ä»…åœ¨å¼‚æ­¥æ“ä½œå®Œæˆä¸”è°ƒç”¨å †æ ˆä¸ºç©ºæ—¶è°ƒç”¨ï¼Œè¯¸å¦‚ä»webæœåŠ¡å™¨åŠ è½½æ•°æ®æˆ–æŸ¥è¯¢æ•°æ®åº“ç­‰é‡è´Ÿè½½æ“ä½œåº”è¯¥å¼‚æ­¥å®Œæˆï¼Œä»¥ä¾¿ä¸»çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–æ“ä½œè€Œä¸ä¼šå‡ºç°ä¸€ç›´é˜»å¡

åœ¨JavaScriptä¸­å¼‚æ­¥å‡½æ•°çš„è§£å†³æ–¹æ¡ˆé€šå¸¸æœ‰callbackã€Promiseã€async/await

## JavaScriptæ‰§è¡Œæœºåˆ¶

- **JavaScriptçš„æ‰§è¡Œä¸è¿è¡Œ**

  æ‰§è¡Œå’Œä¸è¿è¡Œä¸å¤ªç›¸åŒï¼Œåœ¨ä¸åŒç¯å¢ƒä¸‹ï¼Œæ¯”å¦‚Nodeã€æµè§ˆå™¨ä¸‹ï¼ŒJavaScriptçš„æ‰§è¡Œç»“æœæ˜¯ä¸ä¸€æ ·çš„ï¼›è€Œè¿è¡Œå¤§å¤šæ˜¯æŒ‡åŸºäºJavaScriptå¼•æ“ï¼Œå¦‚V8ï¼Œç»“æœæ˜¯ä¸€è‡´çš„ 

- **å…³äºJavaScript**

  ä¼—æ‰€å‘¨çŸ¥ï¼ŒJavaScriptæ˜¯ä¸€é—¨**å•çº¿ç¨‹**ã€**å¼‚æ­¥æ‰§è¡Œ**çš„è¯­è¨€ï¼Œè™½ç„¶åœ¨HTML5ä¸­æå‡ºäº†**web workers**ï¼ˆå¯ä»¥ç†è§£ä¸º**æµè§ˆå™¨**ä¸ºJavaScriptå¼€çš„â€œå¤–æŒ‚â€ï¼‰ï¼Œä½†JavaScriptæ˜¯å•çº¿ç¨‹è¿è¡Œçš„è¿™ä¸€æ ¸å¿ƒä»æœªæ”¹å˜ï¼Œæ‰€æœ‰å¤šçº¿ç¨‹éƒ½æ˜¯é€šè¿‡å•çº¿ç¨‹**æ¨¡æ‹Ÿ**å‡ºæ¥çš„

- **JavaScriptä¸­çš„å¼‚æ­¥** **event-loop**

  JavaScriptä¸­çš„å¼‚æ­¥ä¸»è¦é€šè¿‡**event loop**è¿›è¡Œæ¨¡æ‹Ÿå½“æˆ‘ä»¬æ‰§è¡ŒJavaScriptä»£ç çš„æ—¶å€™å…¶å®å°±æ˜¯å¾€æ‰§è¡Œæ ˆä¸­æ”¾å…¥å‡½æ•°ï¼Œé‚£ä¹ˆé‡åˆ°å¼‚æ­¥ä»£ç æ€ä¹ˆåŠï¼Ÿå…¶å®å½“é‡åˆ°å¼‚æ­¥ä»£ç æ—¶ï¼Œä¼šè¢«æŒ‚èµ·å¹¶åœ¨éœ€è¦æ‰§è¡Œçš„æ—¶å€™åŠ å…¥åˆ°**Task**ï¼ˆæœ‰å¤šç§Taskï¼‰é˜Ÿåˆ—ä¸­ã€‚ä¸€æ—¦æ‰§è¡Œæ ˆä¸ºç©ºï¼Œ**event loop**å°±ä¼šä»**Task**ä¸­æ‹¿å‡ºéœ€è¦æ‰§è¡Œçš„ä»£ç å¹¶æ”¾å…¥æ‰§è¡Œæ ˆä¸­æ‰§è¡Œï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šè¯´JavaScriptä¸­çš„å¼‚æ­¥è¿˜æ˜¯åŒæ­¥è¡Œä¸º

- **æµè§ˆå™¨ä¸­çš„event loop**

  æ¥è‡ªä¸åŒçš„**ä»»åŠ¡æº**çš„ä»»åŠ¡ä¼šè¢«åˆ†é…åˆ°ä¸åŒçš„Taské˜Ÿåˆ—ä¸­ï¼Œä»»åŠ¡æºå¯ä»¥åˆ†ä¸º**å¾®ä»»åŠ¡ï¼ˆmicro taskï¼‰**å’Œ**å®ä»»åŠ¡ï¼ˆmacro taskï¼‰**ã€‚åœ¨ES6è§„èŒƒä¸­ï¼Œå¾®ä»»åŠ¡è¢«ç§°ä¸ºjobsï¼Œå®ä»»åŠ¡è¢«ç§°ä¸ºtask

  å¾®ä»»åŠ¡åŒ…æ‹¬ï¼š`precess.nextTick`ã€`promise`ã€`Mutation Observer`

  å®ä»»åŠ¡åŒ…æ‹¬ï¼š`script`ã€`setTimeout`ã€`setInterval`ã€`setImmediate`ã€`I/O`ã€UI Rendering

  **å®ä»»åŠ¡ä¸­åŒ…å«äº†`script`ï¼Œå› æ­¤æµè§ˆå™¨ä¼šå…ˆæ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ï¼Œæ¥ä¸‹æ¥ç”±å¼‚æ­¥ä»£ç çš„è¯æ‰ä¼šå…ˆæ‰§è¡Œå¾®ä»»åŠ¡**

  **event loopæ‰§è¡Œé¡ºåº**ï¼š

  1. å…ˆæ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œè¿™å±äºå®ä»»åŠ¡
  2. å½“**æ‰§è¡Œå®Œæ‰€æœ‰åŒæ­¥ä»£ç **åæ‰§è¡Œæ ˆä¸ºç©ºï¼ŒæŸ¥è¯¢æ˜¯å¦æœ‰å¼‚æ­¥ä»£ç éœ€è¦æ‰§è¡Œ
  3. **æ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡**
  4. å½“æ‰§è¡Œå®Œæ‰€æœ‰å¾®ä»»åŠ¡ï¼Œå¦‚æœ‰å¿…è¦ä¼šæ¸²æŸ“é¡µé¢
  5. ç„¶åå¼€å§‹ä¸‹ä¸€è½®`event loop`ï¼Œæ‰§è¡Œå®ä»»åŠ¡ä¸­çš„å¼‚æ­¥ä»£ç ä¹Ÿå°±æ˜¯`setTimeout`ï¼ˆå®ä»»åŠ¡ï¼‰ä¸­çš„å›è°ƒå‡½æ•°

  ![æµè§ˆå™¨ä¸­çš„event loop](http://mrrsblog.oss-cn-shanghai.aliyuncs.com/browser_event_loop.png)

  ![æµè§ˆå™¨ä¸­çš„event loop](http://mrrsblog.oss-cn-shanghai.aliyuncs.com/browser_event_loop2.png)

  ``` javascript
  console.log(1);
  setTimeout(() => {
    console.log(2);
    Promise.resolve().then(() => {
      console.log(3);
    });
  });
  new Promise((resolve, reject) => {
    console.log(4);
    resolve(5);
  }).then(data => {
    console.log(data);
  });
  setTimeout(() => {
    console.log(6);
  });
  console.log(7);
  
  // 1 4 7 5 2 3 6
  ```

- **Node.jsä¸­çš„event loop**

  Node.jsä¸­çš„`event loop`åˆ†ä¸º6ä¸ªé˜¶æ®µï¼Œä»–ä»¬ä¼šæŒ‰ç…§é¡ºåºåå¤è¿è¡Œã€‚æ¯å½“è¿›å…¥æŸä¸€ä¸ªé˜¶æ®µçš„æ—¶å€™éƒ½ä¼šä»å¯¹åº”çš„å›è°ƒé˜Ÿåˆ—ä¸­å–å‡ºå‡½æ•°å»æ‰§è¡Œã€‚å½“**é˜Ÿåˆ—ä¸ºç©º**æˆ–è€…**æ‰§è¡Œçš„å›è°ƒå‡½æ•°æ•°é‡åˆ°è¾¾ç³»ç»Ÿè®¾å®šçš„é˜ˆå€¼**ï¼Œå°±ä¼šè¿›å…¥ä¸‹ä¸€é˜¶æ®µ

  ![Node.jsä¸­çš„event loop](http://mrrsblog.oss-cn-shanghai.aliyuncs.com/node_event_loop.png)

  1. **timers**

     **timers**é˜¶æ®µä¼šæ‰§è¡Œ`setTimeout`å’Œ`setinterval`å›è°ƒï¼Œå¹¶ä¸”æ˜¯ç”±**poll**é˜¶æ®µæ§åˆ¶çš„ã€‚åŒæ ·åœ¨`Node.js`ä¸­å®šæ—¶å™¨æŒ‡å®šçš„äº‹ä»¶ä¹Ÿä¸æ˜¯å‡†ç¡®æ—¶é—´ï¼Œåªæ˜¯å°½å¿«æ‰§è¡Œ

  2. **I/O**

     **I/O**é˜¶æ®µä¼šå¤„ç†ä¸€äº›ä¸Šä¸€è½®å¾ªç¯ä¸­å°‘è®¸æœªæ‰§è¡Œçš„**I/O**å›è°ƒ

  3. **idle,prepare**

  4. **poll**

     **poll**æ˜¯ä¸€ä¸ªè‡³å…³é‡è¦çš„é˜¶æ®µï¼Œåœ¨è¿™ä¸€é˜¶æ®µä¸­ï¼Œç³»ç»Ÿä¼šåšä¸¤ä»¶äº‹æƒ…

     1. å›åˆ°**timer**é˜¶æ®µæ‰§è¡Œå›è°ƒ

     2. æ‰§è¡Œ**I/O**å›è°ƒï¼Œå¹¶ä¸”åœ¨è¿›å…¥è¯¥é˜¶æ®µæ—¶å¦‚æœæ²¡æœ‰è®¾å®šäº†**timer**çš„è¯ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹ä¸¤ä»¶äº‹æƒ…

     - å¦‚æœ**poll**é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œä¼šéå†å›è°ƒé˜Ÿåˆ—å¹¶åŒæ­¥æ‰§è¡Œï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºæˆ–è€…è¾¾åˆ°ç³»ç»Ÿé™åˆ¶
     - å¦‚æœ**poll**é˜Ÿåˆ—ä¸ºç©º
       - å¦‚æœæœ‰`setImmediate`å›è°ƒéœ€è¦æ‰§è¡Œï¼Œ**poll**é˜¶æ®µä¼šåœæ­¢å¹¶ä¸”**è¿›å…¥åˆ°checké˜¶æ®µ**æ‰§è¡Œå›è°ƒ
       - å¦‚æœæ²¡æœ‰ï¼Œä¼šç­‰å¾…å›è°ƒè¢«åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­å¹¶ç«‹å³æ‰§è¡Œå›è°ƒï¼Œè¿™é‡ŒåŒæ ·ä¼šæœ‰ä¸ªè¶…æ—¶æ—¶é—´é˜²æ­¢ä¸€ç›´ç­‰å¾…ä¸‹å»

  5. **check**

     æ‰§è¡Œ`setImmediate`

  6. **close callbacks**

     æ‰§è¡Œcloseäº‹ä»¶

  ![Node.jsä¸­çš„event loop](http://mrrsblog.oss-cn-shanghai.aliyuncs.com/node_event_loop2.png)

## ES6çš„ç±»å’ŒES6çš„æ„é€ å‡½æ•°çš„åŒºåˆ«

åœ¨æ™®é€šä½¿ç”¨ä¸­æ²¡æœ‰åŒºåˆ«ï¼š

``` javascript
function Person(name) {
    this.name = name
}

class Person {
    constructor(name) {
        this.name = name
    }
}
```

ä¸»è¦åŒºåˆ«åœ¨äºç±»ç»§æ‰¿ä¸Šï¼š

``` javascript
function Student(name, id) {
    Person.call(this, name)
    this.id = id
}
Student.prototype = Object.create(Person.prototype)
Student.prototype.constructor = Student

class Student extends Person {
    consreuctor(name, id) {
        super(name)
        this.id = id
    }
}
```

## æ‰©å±•è¿ç®—ç¬¦å’Œå‰©ä½™å‚æ•°è¯­å¥çš„åŒºåˆ«

åœ¨å‡½æ•°æ³›å‹ç¼–ç æ—¶ï¼ŒES6çš„æ‰©å±•è¿ç®—ç¬¦éå¸¸æœ‰ç”¨å—ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥è½»æ¾åˆ›å»ºæ•°ç»„å’Œå¯¹è±¡çš„æ‹·è´ï¼Œè€Œæ— éœ€ä½¿ç”¨`Object.create`ã€`slice`æˆ–å…¶ä»–å‡½æ•°åº“ã€‚

``` javascript
function test(arr) {
    return [ ...arr, "test" ]
}

const result = test(["hello", "world"])
// ["hello", "world", "test"]

const person = {
    name: "tom",
    age: 21
}
const copyPerson = { ...person }
```

ES6çš„å‰©ä½™å‚æ•°è¯­å¥æä¾›äº†ä¸€ä¸ªç®€å†™ï¼Œå…è®¸æˆ‘ä»¬å°†ä¸å®šæ•°é‡çš„å‚æ•°è¡¨ç¤ºä¸ºä¸€ä¸ª**æ•°ç»„**ï¼Œå®ƒå°±åƒæ‰©å±•è¿ç®—ç¬¦è¯­æ³•çš„åé¢ï¼Œå°†æ•°æ®æ”¶é›†åˆ°æ•°ç»„ä¸­è€Œä¸æ˜¯è§£æ„æ•°ç»„ã€‚å‰©ä½™å‚æ•°è¯­å¥åœ¨å‡½æ•°å‚æ•°ã€æ•°ç»„å’Œå¯¹è±¡çš„è§£æ„èµ‹å€¼ä¸­æœ‰å¾ˆå¤§ä½œç”¨

``` javascript
function test(...numbers) {
    return numbers.map(x => x + 5)
}

const result1 = test(1, 2, 3, 4)
// [6, 7, 8, 9]
const result2 = test(5, 6, 7, 8, 9)
// [10, 11, 12, 13, 14]

const [ a, b, ...rest ] = [1, 2, 3, 4]
// 1 2 [ 3, 4 ]
```

## å†…ç½®ç±»å‹

JavaScriptä¸­åˆ†ä¸º**ä¸ƒç§**å†…ç½®ç±»å‹ï¼Œå…¶ä¸­å†…ç½®ç±»å‹åˆåˆ†ä¸ºä¸¤å¤§ç±»å‹ï¼š**åŸºæœ¬ç±»å‹**å’Œ**å¼•ç”¨ç±»å‹**ï¼ˆå¯¹è±¡ Objectï¼‰

åŸºæœ¬ç±»å‹ï¼š`null`ã€`undefined`ã€`boolean`ã€`number`ã€`string`ã€`symbol`

å…¶ä¸­JavaScriptçš„æ•°å­—ç±»å‹æ˜¯æµ®ç‚¹ç±»å‹çš„ï¼Œæ²¡æœ‰æ•´å½¢ã€‚å¹¶ä¸”æµ®ç‚¹ç±»å‹åŸºäº IEEE 754 æ ‡å‡†å®ç°ï¼Œåœ¨ä½¿ç”¨ä¸­ä¼šé‡åˆ°æŸäº› [Bug ](#2)`NaN`ä¹Ÿå±äº`number`ç±»å‹å¹¶ä¸”`NaN`å¹¶ä¸ç­‰äºè‡ªèº«

å¯¹äºåŸºæœ¬ç±»å‹æ¥è¯´ï¼Œå¦‚æœä½¿ç”¨å­—é¢é‡çš„æ–¹å¼ï¼Œé‚£ä¸ªè¿™ä¸ªå˜é‡åªæ˜¯ä¸ªå­—é¢é‡ï¼Œåªæœ‰åœ¨å¿…è¦çš„æ—¶å€™æ‰ä¼šè½¬æ¢æˆå¯¹åº”çš„ç±»å‹

``` javascript
let a = 111 // è¿™åªæ˜¯å­—é¢é‡ï¼Œä¸æ˜¯numberç±»å‹
a.toString() // ä½¿ç”¨çš„æ—¶å€™æ‰ä¼šè½¬æ¢ä¸ºå¯¹è±¡ç±»å‹
```

å¼•ç”¨ç±»å‹åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šé‡åˆ°æ·±æ‹·è´å’Œæµ…æ‹·è´é—®é¢˜

## Typeof

`typeof`å¯¹äºåŸºæœ¬ç±»å‹ï¼Œé™¤äº†`null`éƒ½å¯ä»¥æ˜¾ç¤ºæ­£ç¡®çš„ç±»å‹

``` javascript
typeof 1 // number
typeof '1' // string
typeof undefined // undefined
typeof true // boolean
typeof Symbol() // symbol
```

`typeof`å¯¹äºå¯¹è±¡ï¼Œé™¤äº†å‡½æ•°éƒ½ä¼šæ˜¾ç¤º`object`

``` javascript
typeof [] // object
typeof {} // object
typeof console.log // function

typeof null // object
```

å…³äºä¸ºä»€ä¹ˆ`typeof null == object`ï¼šåœ¨JavaScriptçš„æœ€åˆç‰ˆæœ¬ä¸­ï¼Œä½¿ç”¨çš„æ˜¯32ä¸ºç³»ç»Ÿï¼Œä¸ºäº†æ€§èƒ½è€ƒè™‘ä½¿ç”¨ä½ä½å­˜å‚¨äº†å˜é‡çš„ç±»å‹ä¿¡æ¯ã€‚`000`å¼€å¤´çš„ä»£è¡¨æ˜¯å¯¹è±¡ï¼Œç„¶è€Œ`null`è¡¨ç¤ºä¸ºå…¨é›¶ï¼Œæ‰€ä»¥å°†å®ƒé”™è¯¯çš„åˆ¤æ–­ä¸º`object`

å¦‚æœæƒ³å¾—åˆ°ä¸€ä¸ªæ­£ç¡®çš„æ•°æ®ç±»å‹ï¼Œä½¿ç”¨`Object.prototype.toString.call(xxx)`

``` javascript
Object.prototype.toString.call([1, 2, 3])
```

## instanceof

`instance`å¯ä»¥æ­£ç¡®çš„åˆ¤æ–­å¯¹è±¡çš„ç±»å‹ï¼Œå› ä¸ºå†…éƒ¨æœºåˆ¶æ˜¯é€šè¿‡åˆ¤æ–­å¯¹è±¡çš„åŸå‹é“¾ä¸­æ˜¯ä¸æ˜¯èƒ½æ­£ç¡®çš„æ‰¾åˆ°ç±»å‹çš„`prototype`

```javascript
function instanceof(left, right) {
    let prototype = right.prototype
    left = left.__proto__
    while(true) {
        if (left === null)
            return false
        if (prototypr === left)
            return true
        left = left.__proto__
    }
}
```

## new

åœ¨è°ƒç”¨`new`çš„è¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿä»¥ä¸‹å››ä»¶äº‹æƒ…

1. æ–°ç”Ÿæˆäº†ä¸€ä¸ªå¯¹è±¡
2. ç»‘å®šåˆ°åŸå‹
3. ç»‘å®š`this`
4. è¿”å›æ–°å¯¹è±¡

``` javascript
function create() {
    let obj = new Object()
    let Con = [].shift.call(arguments)
    obj.__proto__ = Con.prototype
    let result = Con.apply(obj, arguments)
    return typeof result === 'object' ? result : obj
}
```