---
title: "å¾®å‰ç«¯-æŠ€æœ¯è°ƒç ”"
tags: "å¾®å‰ç«¯"
categories: "å¾®å‰ç«¯"
description: ""
createDate: "2022-04-28 22:12:20"
updateDate: "2022-05-12 22:57:34"
---

å¾®å‰ç«¯æ˜¯è¿‘ä¸¤å¹´æ¯”è¾ƒç«çƒ­çš„è¯é¢˜ï¼Œä»å›½å¤–çš„ single-spa åˆ°é˜¿é‡Œçš„ qiankunï¼Œä»äº¬ä¸œçš„ micro-app åˆ°æ¬¢èšæ—¶ä»£çš„ emp ï¼Œå„å®¶å¤§å‚ä½¿å°½æµ‘èº«è§£æ•°æ¨å‡ºè‡ªå®¶çš„å¾®å‰ç«¯æ¡†æ¶ï¼Œé‚£ä¹ˆå¾®å‰ç«¯åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢

## ä»€ä¹ˆæ˜¯å¾®å‰ç«¯

ç½‘ä¸Šçœ‹åˆ°ä¸€å¥è¯å¯¹å…¶æ€»ç»“çš„é­è¾Ÿå…¥é‡Œ

> â€œå¾®å‰ç«¯æ˜¯ä¸€ç§æ¶æ„é£æ ¼ï¼Œå…¶ä¸­ä¼—å¤šç‹¬ç«‹äº¤ä»˜çš„å‰ç«¯åº”ç”¨ç»„åˆæˆä¸€ä¸ªå¤§å‹æ•´ä½“ã€‚â€

å¾®å‰ç«¯çš„æ¦‚å¿µæœ€æ—©åœ¨ 2016 å¹´åº•è¢«[æå‡º](https://www.thoughtworks.com/radar/techniques/micro-frontends)ï¼Œ**å¾®å‰ç«¯ä¸æ˜¯å•çº¯çš„å‰ç«¯æ¡†æ¶æˆ–è€…å·¥å…·ï¼Œè€Œæ˜¯ä¸€å¥—æ¶æ„ä½“ç³»**ï¼Œå®ƒå°†å¾®æœåŠ¡çš„æ¦‚å¿µæ‰©å±•åˆ°å‰ç«¯ä¸–ç•Œã€‚åœ¨è¯¥æŠ€æœ¯æ¶æ„ä¸‹ï¼Œæ–°çš„/æ”¹é€ å¥½ä¹‹åçš„å‰ç«¯åº”ç”¨å¯ç”±å¤šä¸ªå­åº”ç”¨æ„æˆï¼Œè¿™äº›å­åº”ç”¨é—´ç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹éƒ¨ç½²ã€ç‹¬ç«‹è¿è¡Œæ—¶ã€æŠ€æœ¯æ ˆæ— å…³

å¾®å‰ç«¯æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š

1. æŠ€æœ¯æ ˆæ— å…³

2. ç‹¬ç«‹å¼€å‘/éƒ¨ç½²

3. å¢é‡å‡çº§

æ—¢ç„¶å¾®å‰ç«¯è¿™ä¹ˆå¥½ï¼Œä¸ºä»€ä¹ˆç›´åˆ° 16 å¹´æ‰è¢«æå‡ºæ¥å‘¢

å…¶å®æ—©åœ¨ä¸Šå¤æ—¶ä»£ï¼Œ`iframe`å°±å¯ç§°ä¸ºå¾®å‰ç«¯ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œå› ä¸º`iframe`å¯ä»¥åšåˆ°å®Œç¾éš”ç¦» javascript/css ï¼Œå¹¶ä¸”å¯é€‚ç”¨ url å¿«é€Ÿæ¥å…¥ã€‚é‚£æ—¢ç„¶è¿™ä¹ˆç®€å•ï¼Œä¸ºå•¥æ²¡æœ‰æµè¡Œèµ·æ¥å‘¢ï¼ˆåœ¨å¾®å‰ç«¯é¢†åŸŸï¼‰ï¼Ÿå› ä¸º`iframe`ç¼ºç‚¹åŒæ ·æ˜æ˜¾ï¼šéš”ç¦»è¿‡äºç®€å•ç²—æš´ï¼Œå¯¼è‡´åº”ç”¨é—´æ•°æ®äº¤äº’å›°éš¾ï¼›æ•´ä¸ªåº”ç”¨å…¨é‡åŠ è½½ï¼Œæ€§èƒ½è¾ƒå·®ï¼›å¼¹çª—ç±»ä¸šåŠ¡æ— æ³•æ­£å¸¸æ–½å±•ã€‚ã€‚ã€‚

## ä¸ºä»€ä¹ˆè¦åšå¾®å‰ç«¯

å¾®å‰ç«¯æ—¢å¯å°†å¤šä¸ªåº”ç”¨/é¡¹ç›®æ•´åˆåˆ°ä¸€èµ·ï¼Œåˆå¯å‡å°å„åº”ç”¨é—´çš„è€¦åˆæ€§ï¼Œæé«˜é¡¹ç›®çš„å¯æ‰©å±•æ€§

## å®ç°å¾®å‰ç«¯æœ‰å“ªäº›æ–¹æ¡ˆ

ä»é›†æˆæ–¹å¼å‡ºå‘å¯ä»¥å¤§è‡´åˆ†ä¸ºæ„å»ºæ—¶é›†æˆã€è¿è¡Œæ—¶é›†æˆ

### æ„å»ºæ—¶é›†æˆ

æœ€å¸¸è§çš„æ˜¯å°†å­åº”ç”¨ç‹¬ç«‹å¼€å‘ä¸ºä¸€ä¸ªå•ç‹¬çš„å¯å‘å¸ƒçš„ Javascript åŒ…ï¼Œåœ¨ä¸»åº”ç”¨ä¸­å¼•ç”¨å¹¶åŠ è½½ã€‚ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•æ„å‘³ç€æˆ‘ä»¬å¿…é¡»é‡æ–°ç¼–è¯‘å¹¶å‘å¸ƒæ¯ä¸ªå¾®å‰ç«¯ï¼Œæ‰èƒ½å‘å¸ƒå¯¹äº§å“ä»»ä½•å•ä¸ªéƒ¨åˆ†çš„æ›´æ”¹

### è¿è¡Œæ—¶é›†æˆ

å’Œæ„å»ºæ—¶é›†æˆç›¸åï¼Œåœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½å„åº”ç”¨

æœ€ç®€å•çš„äº‹é€šè¿‡ nginx æ¥åˆ†å‘

```html
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <title>Feed me</title>
  </head>
  <body>
    <h1>Feed me</h1>
    <!--# include file="$PAGE.html" -->
  </body>
</html>
```

```sh
server {
    listen 8080;
    server_name localhost;

    root /usr/share/nginx/html;
    index index.html;
    ssi on;

    # Redirect / to /browse
    rewrite ^/$ http://localhost:8080/browse redirect;

    # Decide which HTML fragment to insert based on the URL
    location /browse {
      set $PAGE 'browse';
    }
    location /order {
      set $PAGE 'order';
    }
    location /profile {
      set $PAGE 'profile'
    }

    # All locations should render through index.html
    error_page 404 /index.html;
}
```

è¿™ç§æ–¹å¼ä¹Ÿå¯å‹‰å¼ºç§°ä¸º*å¾®å‰ç«¯*ï¼Œå› ä¸ºæˆ‘ä»¬å°†æ¯ä¸ªä¸šåŠ¡éƒ½æ‹†åˆ†åˆ°ä¸€ä¸ªç‹¬ç«‹çš„åº”ç”¨ä¸­ï¼Œå¯ä»¥äº¤ç”±ç‹¬ç«‹çš„å›¢é˜Ÿç»´æŠ¤ã€‚é™¤äº†è¿™ç§æœåŠ¡ç«¯é›†æˆï¼Œåœ¨å®¢æˆ·ç«¯ä¹Ÿå¯ä»¥é€šè¿‡ä¸€å®šçš„æ‰‹æ®µæ‹†åˆ†-é›†æˆ

```html
<html>
  <head>
    <title>Feed me!</title>
  </head>
  <body>
    <h1>Welcome to Feed me!</h1>

    <!-- These scripts don't render anything immediately -->
    <!-- Instead they attach entry-point functions to `window` -->
    <script src="https://browse.example.com/bundle.js"></script>
    <script src="https://order.example.com/bundle.js"></script>
    <script src="https://profile.example.com/bundle.js"></script>

    <div id="micro-frontend-root"></div>

    <script type="text/javascript">
      // These global functions are attached to window by the above scripts
      const microFrontendsByRoute = {
        "/": window.renderBrowseRestaurants,
        "/order-food": window.renderOrderFood,
        "/user-profile": window.renderUserProfile,
      };
      const renderFunction = microFrontendsByRoute[window.location.pathname];

      // Having determined the entry-point function, we now call it,
      // giving it the ID of the element where it should render itself
      renderFunction("micro-frontend-root");
    </script>
  </body>
</html>
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†æ¯ä¸ªåº”ç”¨æ‰“åŒ…æˆä¸€ä¸ª javascript æ–‡ä»¶ï¼Œåœ¨åŒ¹é…åˆ° URL åæ‰§è¡Œå¯¹åº”çš„ä»£ç ï¼Œæ¸²æŸ“é¡µé¢ã€‚

é™¤äº†ä½¿ç”¨ javascript ï¼Œè¿˜å¯ä½¿ç”¨å¼€ç¯‡æåˆ°çš„ iframe é›†æˆï¼Œä½† iframe ç¼ºç‚¹è¿‡äºæ˜æ˜¾å°±ä¸è®¨è®ºã€‚æ­¤å¤–ï¼Œè¿˜å¯ä½¿ç”¨ web components æ¥å®ç°ï¼Œå…¶ä¹Ÿå±äº javascript å› æ­¤ä¸å¦åˆ—

```html
<html>
  <head>
    <title>Feed me!</title>
  </head>
  <body>
    <h1>Welcome to Feed me!</h1>

    <!-- These scripts don't render anything immediately -->
    <!-- Instead they each define a custom element type -->
    <script src="https://browse.example.com/bundle.js"></script>
    <script src="https://order.example.com/bundle.js"></script>
    <script src="https://profile.example.com/bundle.js"></script>

    <div id="micro-frontend-root"></div>

    <script type="text/javascript">
      // These element types are defined by the above scripts
      const webComponentsByRoute = {
        "/": "micro-frontend-browse-restaurants",
        "/order-food": "micro-frontend-order-food",
        "/user-profile": "micro-frontend-user-profile",
      };
      const webComponentType = webComponentsByRoute[window.location.pathname];

      // Having determined the right web component custom element type,
      // we now create an instance of it and attach it to the document
      const root = document.getElementById("micro-frontend-root");
      const webComponent = document.createElement(webComponentType);
      root.appendChild(webComponent);
    </script>
  </body>
</html>
```

é™¤äº†è¿™ä¸¤ç§åˆ†ç±»ï¼Œè¿˜å¯ä»æ‹†åˆ†ç²’åº¦æ¥åˆ†ç±»

### åŸºäºè·¯ç”±åˆ†å‘

ä¸Šé¢ä»‹ç»çš„åŸºæœ¬éƒ½æ˜¯ä¸€ä¸ªé¡µé¢ä¸€ä¸ªåº”ç”¨ï¼Œé‚£ä¹ˆè¿˜æœ‰æ²¡æœ‰ç²’åº¦æ›´ç»†ä¸€ç‚¹çš„ï¼šæƒ³åœ¨ä¸€ä¸ªé¡µé¢åŠ è½½å¤šä¸ªåº”ç”¨ï¼ŸğŸ¤”

### å‰ç«¯å¾®æœåŠ¡åŒ–

æ¯ä¸ªå‰ç«¯åº”ç”¨éƒ½æ˜¯ç‹¬ç«‹çš„ã€è‡ªä¸»è¿è¡Œçš„ï¼Œæœ€åé€šè¿‡æ¨¡å—åŒ–çš„æ–¹å¼ç»„åˆå‡ºå®Œæ•´çš„å‰ç«¯åº”ç”¨

æ¯”å¦‚å€ŸåŠ©ä¸Šé¢çš„ Web Components å®ç°

```html
<html>
  <head>
    <title>Feed me!</title>
  </head>
  <body>
    <h1>Welcome to Feed me!</h1>

    <!-- These scripts don't render anything immediately -->
    <!-- Instead they each define a custom element type -->
    <script src="https://browse.example.com/bundle.js"></script>
    <script src="https://order.example.com/bundle.js"></script>
    <script src="https://profile.example.com/bundle.js"></script>

    <div id="micro-frontend-root">
      <micro-frontend-browse-restaurants />
      <micro-frontend-order-food />
      <micro-frontend-user-profile />
    </div>
  </body>
</html>
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åŠ è½½çš„ js èµ„æºå¯ä»¥æ˜¯ä»»ä½•å€ŸåŠ©æ¡†æ¶æ„å»ºåç”Ÿæˆçš„ web component ç»„ä»¶æ–‡ä»¶

## æ€»ç»“

å¾®å‰ç«¯æ˜¯ä¸€ç§æ¶æ„é£æ ¼ï¼Œå…¶ä¸­ä¼—å¤šç‹¬ç«‹äº¤ä»˜çš„å‰ç«¯åº”ç”¨ç»„åˆæˆä¸€ä¸ªå¤§å‹æ•´ä½“ã€‚

å¾®å‰ç«¯æŠ€æœ¯æ–¹æ¡ˆå¯åˆ†ä¸ºè¿è¡Œæ—¶é›†æˆ/æ„å»ºæ—¶é›†æˆï¼Œæˆ–è€…æŒ‰ç…§æ‹†åˆ†ç²’åº¦åˆ’åˆ†ä¸ºè·¯ç”±åˆ†å‘å¼å’Œå¾®æœåŠ¡åŒ–

## å‚è€ƒ

[è¯¦è§£å¾®å‰ç«¯](https://www.icode9.com/content-4-946879.html)
