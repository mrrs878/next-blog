{"pageProps":{"post":{"title":"webpack复习-loader","tags":["webpack","loader"],"categories":"2024复习","description":"## loader\n\n用来处理非 `javascript` 、 `json` 文件\n\n## normal loader VS pitch loader\n\n`normal loader` 就是 `loader` 本身\n\n`pitch loader` 就是`loader`上一个名为 `pitch` 的属性，也是个函数\n\n```js\nfunction styleLoader(data) {\n  ret","createDate":"2024-04-17 20:18:27","updateDate":"2024-04-18 20:04:36","body":"\n      <h2>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">loader</span>\n        <span class=\"suffix\"></span>\n      </h2>\n    <p>用来处理非 <code>javascript</code> 、 <code>json</code> 文件</p>\n\n      <h2>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">normal loader VS pitch loader</span>\n        <span class=\"suffix\"></span>\n      </h2>\n    <p><code>normal loader</code> 就是 <code>loader</code> 本身</p>\n<p><code>pitch loader</code> 就是<code>loader</code>上一个名为 <code>pitch</code> 的属性，也是个函数</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">styleLoader</span>(<span class=\"hljs-params\">data</span>) {\n  <span class=\"hljs-keyword\">return</span> data;\n}\n\nstyleLoader.<span class=\"hljs-property\">pitch</span> = <span class=\"hljs-function\">(<span class=\"hljs-params\">remainingRequest, previousRequest, data</span>) =&gt;</span> {\n  <span class=\"hljs-comment\">// remainingRequest 表示剩余需要处理的loader的绝对路径和资源文件以!分割组成的字符串</span>\n  <span class=\"hljs-comment\">// previousRequest 它表示pitch阶段已经迭代过的loader按照!分割组成的字符串</span>\n  <span class=\"hljs-comment\">// data 处理normalLoader与pitchLoader的交互</span>\n  <span class=\"hljs-comment\">/**\n   *\n   * {\n   *    test: /\\.css$/,\n   *    use: [&quot;style-loader&quot;, &quot;css-loader&quot;],\n   * },\n   *\n   * remainingRequest: xxx/node_modules/.pnpm/css-loader@7.1.1_webpack@5.91.0/node_modules/css-loader/dist/cjs.js!xxx/src/index.css\n   */</span>\n  <span class=\"hljs-comment\">// 当返回值</span>\n};\n</code></pre>\n\n      <h2>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">pitch loader 的执行顺序</span>\n        <span class=\"suffix\"></span>\n      </h2>\n    <p>所有的 <code>pitch loader</code> 均在 <code>normal loader</code> 之前执行，如下所示</p>\n<p><img src=\"/img/pitch-loader-1.png\" alt=\"loader执行顺序\"></p>\n<p>但当某一个 <code>pitch loader</code> 的<strong>返回值不为空</strong>时，即发生 <code>loader</code> 的<strong>熔断</strong>效应，即<strong>立即中断后续 loader 的执行，并从该 pitch loader 对应的 normal loader 开始执行</strong></p>\n<p><img src=\"/img/pitch-loader-2.png\" alt=\"loader的熔断效应\"></p>\n\n      <h2>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">为什么需要 pitch loader</span>\n        <span class=\"suffix\"></span>\n      </h2>\n    <p>实现一些特殊（取巧）逻辑</p>\n<p>正常情况下， <code>loader</code> 的执行顺序为从右至左串型执行，且上一个 <code>loader</code> 的返回值为下一个 <code>loader</code> 的入参，假如要设计这么一个 <code>cache-loader</code> ，其作用是缓存上一次 <code>loader</code> 构建的结果，因此我们需要将 <code>cache-loader</code> 放在最左边，保证其最后执行。按照正常的执行顺序，每次构建时其余 <code>loader</code> 都会重新执行，这样就其不到作用。这时候，我们就可以给 <code>cache-loader</code> 增加 <code>pitch</code> 方法，在 <code>pitch</code> 阶段直接根据条件返回缓存的结果直接 <strong>熔断</strong> 其余 <code>loader</code> 的执行</p>\n\n      <h2>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">参考</span>\n        <span class=\"suffix\"></span>\n      </h2>\n    <p><a href=\"https://juejin.cn/post/7036379350710616078\">多角度解析 Webpack5 之 Loader 核心原理</a></p>\n<p><a href=\"https://juejin.cn/post/7037696103973650463\">你不知道的「pitch loader」应用场景</a></p>\n"}},"__N_SSG":true}