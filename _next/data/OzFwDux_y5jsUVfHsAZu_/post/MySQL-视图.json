{"pageProps":{"post":{"title":"MySQL-视图","tags":["MySQL","视图"],"categories":"MySQL","description":"# MySQL-视图\n## 什么是视图\n- 视图是由查询结果形成的一张**虚拟表**，可以当作一张表使用，但与持久表(permanent table)不同的是，视图中的数据**没有实际的物理存储**。\n\n## 视图的作用\n- 视图在一定程度上起到一个**安全层**的作用，可以进行**权限控制**\n- **简化查询**语句\n- 对于某张很大的表，可以将其分为多个视图，从而**加快查询**\n\n##","createDate":"2018-11-13 16:56:59","updateDate":"10/1/2021, 3:34:43 AM","body":"\n      <h1>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">MySQL-视图</span>\n        <span class=\"suffix\"></span>\n      </h1>\n    \n      <h2>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">什么是视图</span>\n        <span class=\"suffix\"></span>\n      </h2>\n    <ul>\n<li>视图是由查询结果形成的一张<strong>虚拟表</strong>，可以当作一张表使用，但与持久表(permanent table)不同的是，视图中的数据<strong>没有实际的物理存储</strong>。</li>\n</ul>\n\n      <h2>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">视图的作用</span>\n        <span class=\"suffix\"></span>\n      </h2>\n    <ul>\n<li>视图在一定程度上起到一个<strong>安全层</strong>的作用，可以进行<strong>权限控制</strong></li>\n<li><strong>简化查询</strong>语句</li>\n<li>对于某张很大的表，可以将其分为多个视图，从而<strong>加快查询</strong></li>\n</ul>\n\n      <h2>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">视图的使用条件</span>\n        <span class=\"suffix\"></span>\n      </h2>\n    <ul>\n<li>如果某个查询结果出现的非常频繁，就是要经常那这个查询结果来做<strong>子查询</strong>，使用视图会更加方便</li>\n</ul>\n\n      <h2>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">视图的基本操作</span>\n        <span class=\"suffix\"></span>\n      </h2>\n    <ul>\n<li><strong>创建视图</strong>：\n``` SQL\nCREATE\n[OR REPLACE]\n[ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}]\n[DEFINER = { user | CURRENT_USER }]\n[SQL SECURITY { DEFINER | INVOKER }]\nVIEW view_name [(column_list)]\nAS select_statement\n[WITH [CASCADED | LOCAL] CHECK OPTION]</li>\n</ul>\n<p>CREATE OR REPLACE VIEW view_name AS SELECT * FROM table_name</p>\n<pre><code>- **调取视图**\n``` SQL\nSELECT * FROM view_name\n</code></pre>\n<ul>\n<li><strong>修改视图</strong>\n``` SQL\nALTER\n[ALGORITHM = {UNDEFINED | MERGE | TEMPTABLE}]\n[DEFINER = { user | CURRENT_USER }]\n[SQL SECURITY { DEFINER | INVOKER }]\nVIEW view_name [(column_list)]\nAS select_statement\n[WITH [CASCADED | LOCAL] CHECK OPTION]</li>\n</ul>\n<p>ALTER OR REPLACE VIEW view_name AS SELECT * FROM table_name</p>\n<pre><code>- **删除视图**\n``` SQL\nDROP VIEW IF EXISTS view_name\n</code></pre>\n<ul>\n<li><strong>查看视图</strong><pre><code class=\"hljs language-SQL\"><span class=\"hljs-keyword\">SHOW</span> TABLES;\n</code></pre>\n</li>\n<li><strong>查看视图的定义</strong><pre><code class=\"hljs language-SQL\"><span class=\"hljs-keyword\">SHOW</span> <span class=\"hljs-keyword\">TABLE</span> STATUS <span class=\"hljs-keyword\">FROM</span> table_name <span class=\"hljs-keyword\">LIKE</span> <span class=\"hljs-string\">&#x27;view_name&#x27;</span>\n</code></pre>\n\n      <h2>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">视图的算法--存在两种执行的算法</span>\n        <span class=\"suffix\"></span>\n      </h2>\n    </li>\n<li>MERGE：<strong>合并模式</strong>，先将我们视图的SQL语句与外部查询视图的SQL语句，混合在一起，最终执行，也就是可以<strong>更新</strong>真实表中的数据。</li>\n<li>TEMPTABLE：<strong>临时表模式</strong>，每当查询的时候，将视图所使用的SELECT语句生成一个结果的临时表，再在当前的临时表内进行查询。</li>\n<li>UNDEFINED： 让MySQL选择所要使用的算法。如果可能，它<strong>倾向于MERGE</strong>而不是TEMPTABLE，这是因为MERGE通常更有效，而且如果使用了临时表，视图是不可更新。</li>\n</ul>\n\n      <h2>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">视图与表的关系</span>\n        <span class=\"suffix\"></span>\n      </h2>\n    <ul>\n<li>虽然视图是基于表的一个虚拟表，但是用户可以对某些视图进行更新操作，其本质就是通过视图的定义来更新基表。一般称进行更新操作的视图为可更新视图(updatable view)。视图定义中的<strong>WITH CHECK OPTION</strong>就是针对于可更新表的。</li>\n</ul>\n\n      <h2>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">WITH CHECK OPTION测试代码</span>\n        <span class=\"suffix\"></span>\n      </h2>\n    <pre><code class=\"hljs language-SQL\"># 创建视图（<span class=\"hljs-keyword\">WITHOUT</span> <span class=\"hljs-keyword\">CHECK</span> OPTION）\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">OR</span> REPLACE <span class=\"hljs-keyword\">VIEW</span> user_info_v <span class=\"hljs-keyword\">AS</span> <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> user_info <span class=\"hljs-keyword\">WHERE</span> id <span class=\"hljs-operator\">&lt;</span> <span class=\"hljs-number\">10</span>\n# 查看视图（基表 <span class=\"hljs-operator\">+</span> 视图）\n<span class=\"hljs-keyword\">SHOW</span> TABLES\n# 只查看基表\n<span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> information_schema.TABLES <span class=\"hljs-keyword\">WHERE</span> table_type <span class=\"hljs-operator\">=</span> <span class=\"hljs-string\">&#x27;BASE TABLE&#x27;</span> <span class=\"hljs-keyword\">AND</span> table_schema <span class=\"hljs-operator\">=</span> database()\\G\n<span class=\"hljs-keyword\">INSERT</span> <span class=\"hljs-keyword\">INTO</span> user_info_v <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-number\">12</span>, <span class=\"hljs-string\">&#x27;lisi&#x27;</span>, <span class=\"hljs-string\">&#x27;5678&#x27;</span>\n<span class=\"hljs-keyword\">INSERT</span> <span class=\"hljs-keyword\">INTO</span> user_info_v <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-number\">2</span>, <span class=\"hljs-string\">&#x27;wangwu&#x27;</span>, <span class=\"hljs-string\">&#x27;9012&#x27;</span>\n<span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> user_info\n<span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> user_info_v\n\n# 删除视图\n<span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">VIEW</span> IF <span class=\"hljs-keyword\">EXISTS</span> user_info_v;\n\n# 创建视图（<span class=\"hljs-keyword\">WITH</span> <span class=\"hljs-keyword\">CHECK</span> OPTION）\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">OR</span> REPLACE <span class=\"hljs-keyword\">VIEW</span> user_info_v <span class=\"hljs-keyword\">AS</span> <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> user_info <span class=\"hljs-keyword\">WHERE</span> id <span class=\"hljs-operator\">&lt;</span> <span class=\"hljs-number\">10</span> <span class=\"hljs-keyword\">WITH</span> <span class=\"hljs-keyword\">CHECK</span> OPTION\n<span class=\"hljs-keyword\">INSERT</span> <span class=\"hljs-keyword\">INTO</span> user_info_v <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-number\">13</span>, <span class=\"hljs-string\">&#x27;zhaoliu&#x27;</span>, <span class=\"hljs-string\">&#x27;3456&#x27;</span>\n</code></pre>\n<p><img src=\"https://t1.picb.cc/uploads/2018/11/13/JSO1Dr.png\" alt=\"enter image description here\">\n<img src=\"http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-13/37805165.jpg\" alt=\"enter image description here\">\n<img src=\"http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-13/67280010.jpg\" alt=\"enter image description here\">\n<img src=\"http://hellomrrs-imgs.oss-cn-shanghai.aliyuncs.com/18-11-13/47500056.jpg\" alt=\"enter image description here\"></p>\n\n      <h2>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">视图的作用测试代码</span>\n        <span class=\"suffix\"></span>\n      </h2>\n    <pre><code class=\"hljs language-SQL\">DELIMITER <span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span>\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">PROCEDURE</span> view_test(_cnt <span class=\"hljs-type\">INT</span> UNSIGNED)\n<span class=\"hljs-keyword\">BEGIN</span>\n    <span class=\"hljs-keyword\">SET</span> <span class=\"hljs-variable\">@cnt</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span>;\n    WHILE <span class=\"hljs-variable\">@cnt</span> <span class=\"hljs-operator\">&lt;</span> _cnt DO\n        <span class=\"hljs-keyword\">INSERT</span> <span class=\"hljs-keyword\">INTO</span> user_info(user_name, user_pwd) <span class=\"hljs-keyword\">values</span>(REPEAT(<span class=\"hljs-type\">CHAR</span>(<span class=\"hljs-number\">97</span><span class=\"hljs-operator\">+</span>RAND()<span class=\"hljs-operator\">*</span><span class=\"hljs-number\">26</span>), <span class=\"hljs-number\">20</span>), REPEAT(<span class=\"hljs-type\">CHAR</span>(<span class=\"hljs-number\">97</span><span class=\"hljs-operator\">+</span>RAND()<span class=\"hljs-operator\">*</span><span class=\"hljs-number\">26</span>), <span class=\"hljs-number\">20</span>));\n        <span class=\"hljs-keyword\">SET</span> <span class=\"hljs-variable\">@cnt</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-variable\">@cnt</span> <span class=\"hljs-operator\">+</span> <span class=\"hljs-number\">1</span>;\n    <span class=\"hljs-keyword\">END</span> WHILE;\n<span class=\"hljs-keyword\">END</span>;\n<span class=\"hljs-operator\">/</span><span class=\"hljs-operator\">/</span>\nDELIMITER ;\n\n<span class=\"hljs-keyword\">call</span> view_test(<span class=\"hljs-number\">10000</span>);\n<span class=\"hljs-keyword\">call</span> view_test(<span class=\"hljs-number\">50000</span>);\n<span class=\"hljs-keyword\">call</span> view_test(<span class=\"hljs-number\">50000</span>);\n\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">OR</span> REPLACE <span class=\"hljs-keyword\">VIEW</span> view_func_test0 <span class=\"hljs-keyword\">AS</span> <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> user_info <span class=\"hljs-keyword\">WHERE</span> id <span class=\"hljs-operator\">%</span> <span class=\"hljs-number\">4</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">WITH</span> <span class=\"hljs-keyword\">CHECK</span> OPTION;\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">OR</span> REPLACE <span class=\"hljs-keyword\">VIEW</span> view_func_test1 <span class=\"hljs-keyword\">AS</span> <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> user_info <span class=\"hljs-keyword\">WHERE</span> id <span class=\"hljs-operator\">%</span> <span class=\"hljs-number\">4</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">WITH</span> <span class=\"hljs-keyword\">CHECK</span> OPTION;\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">OR</span> REPLACE <span class=\"hljs-keyword\">VIEW</span> view_func_test2 <span class=\"hljs-keyword\">AS</span> <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> user_info <span class=\"hljs-keyword\">WHERE</span> id <span class=\"hljs-operator\">%</span> <span class=\"hljs-number\">4</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">2</span> <span class=\"hljs-keyword\">WITH</span> <span class=\"hljs-keyword\">CHECK</span> OPTION;\n<span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">OR</span> REPLACE <span class=\"hljs-keyword\">VIEW</span> view_func_test3 <span class=\"hljs-keyword\">AS</span> <span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> user_info <span class=\"hljs-keyword\">WHERE</span> id <span class=\"hljs-operator\">%</span> <span class=\"hljs-number\">4</span> <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">3</span> <span class=\"hljs-keyword\">WITH</span> <span class=\"hljs-keyword\">CHECK</span> OPTION;\n</code></pre>\n<p><img src=\"https://t1.picb.cc/uploads/2018/11/13/JSWxYv.png\" alt=\"enter image description here\"></p>\n"}},"__N_SSG":true}