{"pageProps":{"post":{"title":"React.jså­¦ä¹ -useEffect vs useLayoutEffect","tags":["React.jså­¦ä¹ ","useEffect","useLayoutEffect"],"categories":"React.js","description":"å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¸éœ€è¦æ˜ç¡®åŒºåˆ† `useEffect` å’Œ `useLayoutEffect`\n\nï¼ˆè‡³å°‘æˆ‘è¿˜æ²¡é‡åˆ°è¿‡ ğŸ˜‚ï¼Œä¸è¿‡æœ‰å¿…è¦äº†è§£ä¸€ä¸‹ï¼Œæ²¡å‡†å“ªå¤©å°±é‡åˆ°äº†ï¼‰\n\nä¸¤è€…å”¯ä¸€çš„åŒºåˆ«åœ¨äºæ‰§è¡Œæ—¶æœºçš„ä¸åŒ\n\n## useEffect\n\nä¸€èˆ¬çœ‹æ¥ï¼Œå¯¹äº `useEffect` ï¼Œä¸ºäº†é˜²æ­¢æµè§ˆå™¨æ¸²æŸ“å¡é¡¿ï¼Œå…¶å›è°ƒå‡½æ•°ä¼šåœ¨æµè§ˆå™¨ `paint` ä¹‹åæ‰§è¡Œï¼Œè¿™çœ‹èµ·æ¥å¾ˆæ­£å¸¸ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªæ­£å¸¸çš„ç»„ä»¶æ¸²æŸ“æµç¨‹ï¼š\n\n1. åš","createDate":"2022-05-10 21:49:31","updateDate":"2022-05-16 22:23:14","body":"<p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¸éœ€è¦æ˜ç¡®åŒºåˆ† <code>useEffect</code> å’Œ <code>useLayoutEffect</code></p>\n<p>ï¼ˆè‡³å°‘æˆ‘è¿˜æ²¡é‡åˆ°è¿‡ ğŸ˜‚ï¼Œä¸è¿‡æœ‰å¿…è¦äº†è§£ä¸€ä¸‹ï¼Œæ²¡å‡†å“ªå¤©å°±é‡åˆ°äº†ï¼‰</p>\n<p>ä¸¤è€…å”¯ä¸€çš„åŒºåˆ«åœ¨äºæ‰§è¡Œæ—¶æœºçš„ä¸åŒ</p>\n\n      <h2>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">useEffect</span>\n        <span class=\"suffix\"></span>\n      </h2>\n    <p>ä¸€èˆ¬çœ‹æ¥ï¼Œå¯¹äº <code>useEffect</code> ï¼Œä¸ºäº†é˜²æ­¢æµè§ˆå™¨æ¸²æŸ“å¡é¡¿ï¼Œå…¶å›è°ƒå‡½æ•°ä¼šåœ¨æµè§ˆå™¨ <code>paint</code> ä¹‹åæ‰§è¡Œï¼Œè¿™çœ‹èµ·æ¥å¾ˆæ­£å¸¸ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªæ­£å¸¸çš„ç»„ä»¶æ¸²æŸ“æµç¨‹ï¼š</p>\n<ol>\n<li><p>åšä¸€äº›å‡†å¤‡å·¥ä½œï¼ˆæ¸²æŸ“ <code>VDOM</code> ã€è°ƒåº¦ <code>effects</code> ç­‰ï¼‰</p>\n</li>\n<li><p>React å°†æ§åˆ¶æƒäº¤ç”±æµè§ˆå™¨ä»¥ <code>paint</code></p>\n</li>\n<li><p>æ‰§è¡Œ <code>useEffect</code> å›è°ƒ</p>\n</li>\n</ol>\n<p>ç¡®å®ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹æ˜¯è¿™æ ·ï¼Œåªä¸è¿‡å‡¡äº‹éƒ½æœ‰ä¾‹å¤–ï¼Œä¸”çœ‹å®˜ç½‘çš„æè¿°:</p>\n<blockquote>\n<p>è™½ç„¶ <code>useEffect</code> ä¼šåœ¨æµè§ˆå™¨ç»˜åˆ¶åå»¶è¿Ÿæ‰§è¡Œï¼Œä½†ä¼šä¿è¯åœ¨ä»»ä½•æ–°çš„æ¸²æŸ“å‰æ‰§è¡Œã€‚åœ¨å¼€å§‹æ–°çš„æ›´æ–°å‰ï¼ŒReact æ€»ä¼šå…ˆæ¸…é™¤ä¸Šä¸€è½®æ¸²æŸ“çš„ <code>effect</code> ã€‚</p>\n</blockquote>\n<p>å®˜ç½‘çš„ä»‹ç»<strong>ä¼šä¿è¯åœ¨ä»»ä½•æ–°çš„æ¸²æŸ“å‰æ‰§è¡Œ</strong>ï¼Œå¹¶æ²¡æœ‰è¯´ä¸€å®šä¼šåœ¨æµè§ˆå™¨ <code>paint</code> ä¹‹åæ‰§è¡Œï¼Œå› æ­¤æ˜¯ä¸æ˜¯æœ‰ä¸€äº›åœºæ™¯ <code>effect</code> ä¼šåœ¨ <code>paint</code> ä¹‹å‰æ‰§è¡Œï¼ŸğŸ¤”</p>\n<p>å¦‚æœåœ¨ <code>useEffect</code> çš„å›è°ƒè§¦å‘ä¹‹å‰ï¼ŒReact ç»„ä»¶åˆè¿›è¡Œäº†ä¸€æ¬¡çŠ¶æ€æ›´æ–°ï¼ŒReact ä¼šå…ˆå°†ä¹‹å‰çš„ Passive Effect éƒ½å¤„ç†æ‰ã€‚ä¾‹å¦‚åœ¨ <code>useLayoutEffect</code> ä¸­æ›´æ–°çŠ¶æ€ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>useEffect</code>çš„å›è°ƒ ä¼šåœ¨ paint ä¹‹å‰æ‰§è¡Œ</p>\n<p><img src=\"https://blog.thoughtspile.tech/images/forced-le-flush-chart-5dc51705d5854315a6fa5e0be1464f7d.png\" alt=\"useLayoutEffect-useEffect\"></p>\n\n      <h2>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">useLayoutEffect</span>\n        <span class=\"suffix\"></span>\n      </h2>\n    <p>å’Œ <code>useEffect</code> çš„å”¯ä¸€åŒºåˆ«åœ¨äº<strong>æ‰§è¡Œæ—¶æœºä¸åŒ</strong>ï¼Œ <code>useLayoutEffect</code> ä¸€å®šä¼šä¿è¯å›è°ƒå‡½æ•°ä¼šåœ¨ paint ä¹‹å‰æ‰§è¡Œï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªæ­£å¸¸çš„ç»„ä»¶æ¸²æŸ“æµç¨‹ï¼š</p>\n<ol>\n<li><p>åšä¸€äº›å‡†å¤‡å·¥ä½œï¼ˆæ¸²æŸ“ <code>VDOM</code> ã€è°ƒåº¦ <code>effects</code> ç­‰ï¼‰</p>\n</li>\n<li><p>æ‰§è¡Œ <code>useLayoutEffect</code> å›è°ƒ</p>\n</li>\n<li><p>React å°†æ§åˆ¶æƒäº¤ç”±æµè§ˆå™¨ä»¥ <code>paint</code></p>\n</li>\n<li><p>æ‰§è¡Œ <code>useEffect</code> å›è°ƒ</p>\n</li>\n</ol>\n<p>è¿™ä¸ªåŒºåˆ«çš„ä½“ç°åœºæ™¯åœ¨äºä½¿ç”¨ useEffect æ›´æ–°æ•°æ®æ—¶ï¼Œç•Œé¢ä¼šé—ªçƒä¸€ä¸‹</p>\n<pre><code class=\"hljs language-tsx\"><span class=\"hljs-keyword\">const</span> { useState, useEffect, useLayoutEffect } = <span class=\"hljs-title class_\">React</span>;\n\n<span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">App</span> = (<span class=\"hljs-params\"></span>) =&gt; {\n  <span class=\"hljs-keyword\">const</span> [value, setValue] = <span class=\"hljs-title function_\">useState</span>(-<span class=\"hljs-number\">1</span>);\n\n  <span class=\"hljs-title function_\">useEffect</span>(<span class=\"hljs-function\">() =&gt;</span> {\n    <span class=\"hljs-keyword\">let</span> i = <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-keyword\">while</span> (i &lt;= <span class=\"hljs-number\">900000000</span>) {\n      i++;\n    }\n    <span class=\"hljs-keyword\">if</span> (value === <span class=\"hljs-number\">0</span>) {\n      <span class=\"hljs-keyword\">const</span> tmp = <span class=\"hljs-title class_\">Math</span>.<span class=\"hljs-title function_\">random</span>() * <span class=\"hljs-number\">100</span>;\n      <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&quot;setValue&quot;</span>, tmp);\n      <span class=\"hljs-title function_\">setValue</span>(<span class=\"hljs-function\">() =&gt;</span> tmp);\n    }\n  }, [value]);\n\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&quot;render&quot;</span>, value, <span class=\"hljs-title class_\">Date</span>.<span class=\"hljs-title function_\">now</span>());\n\n  <span class=\"hljs-keyword\">return</span> <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">onClick</span>=<span class=\"hljs-string\">{()</span> =&gt;</span> setValue(0)}&gt;{value}<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span></span>;\n};\n</code></pre>\n<p>å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªæ˜æ˜¾çš„é—ªçƒ</p>\n<p><img src=\"https://mrrsblog.oss-cn-shanghai.aliyuncs.com/useEffect-%20blink.gif\" alt=\"useEffect-blink\"></p>\n<p>æ”¹ç”¨ <code>useLayoutEffect</code> åå°±ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µäº†</p>\n"}},"__N_SSG":true}