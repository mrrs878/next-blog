{"pageProps":{"post":{"title":"Docker-进阶","tags":["Docker优化"],"categories":"Docker","description":"# 打包优化\n\n- 缓存依赖\n\n  1. 先 `COPY` 该命令的依赖文件，而不是所有文件\n  2. 执行该命令\n\n  如：\n\n  ```shell\n  FROM node\n  \n  RUN rm -rf /app\n  RUN mkdir /app\n  WORKDIR /app\n  \n  # 1. 先 COPY 该命令的依赖文件，而不是所有文件\n  COPY package.json yar","createDate":"2020-08-17 14:16:00","updateDate":"2020-10-16 12:59:40","body":"\n      <h1>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">打包优化</span>\n        <span class=\"suffix\"></span>\n      </h1>\n    <ul>\n<li><p>缓存依赖</p>\n<ol>\n<li>先 <code>COPY</code> 该命令的依赖文件，而不是所有文件</li>\n<li>执行该命令</li>\n</ol>\n<p>如：</p>\n<pre><code class=\"hljs language-shell\">FROM node\n\nRUN rm -rf /app\nRUN mkdir /app\nWORKDIR /app\n<span class=\"hljs-meta\">\n# </span><span class=\"language-bash\">1. 先 COPY 该命令的依赖文件，而不是所有文件</span>\nCOPY package.json yarn.lock ./\n<span class=\"hljs-meta\"># </span><span class=\"language-bash\">2. 执行该命令</span>\nRUN yarn install\n\nCOPY . .\nRUN yarn build\n\nEXPOSE 3000\n\nCMD [ &quot;node&quot;, &quot;dist/main&quot; ]\n</code></pre>\n<p>效果：</p>\n<p><img src=\"https://mrrsblog.oss-cn-shanghai.aliyuncs.com/docker_build_0.png\" alt=\"Docker build优化\"></p>\n</li>\n</ul>\n\n      <h1>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">删除不用的镜像</span>\n        <span class=\"suffix\"></span>\n      </h1>\n    <ul>\n<li>删除悬空的镜像， <code>docker image prune -a -f</code></li>\n<li>删除悬空的容器，<code>docker container prune -f</code></li>\n</ul>\n"}},"__N_SSG":true}