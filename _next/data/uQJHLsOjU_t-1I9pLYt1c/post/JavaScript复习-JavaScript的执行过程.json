{"pageProps":{"post":{"title":"JavaScript复习-JavaScript的执行过程","tags":["JavaScript的执行过程"],"categories":"2021复习","description":"JavaScript代码在执行时，首先创建一个**全局可执行上下文（`GlobalContext`）**，每当执行到一个函数调用时都会创建一个**可执行上下文（`ExecutionContext`）EC**。当然程序可能存在很多函数调用，那么就会创建很多EC，所以JavaScript引擎创建了**执行上下文栈（`ExecutionConetxtStack`）ECS**来管理执行上下文。当函数调","createDate":"2021-05-28 02:22:06","updateDate":"2021-05-28 16:36:52","body":"<p>JavaScript代码在执行时，首先创建一个<strong>全局可执行上下文（<code>GlobalContext</code>）</strong>，每当执行到一个函数调用时都会创建一个<strong>可执行上下文（<code>ExecutionContext</code>）EC</strong>。当然程序可能存在很多函数调用，那么就会创建很多EC，所以JavaScript引擎创建了<strong>执行上下文栈（<code>ExecutionConetxtStack</code>）ECS</strong>来管理执行上下文。当函数调用完成，JavaScript会退出这个执行环境并把这个环境销毁，回到上一个执行环境...。这个过程反复执行，直到执行栈中的代码全部执行完毕。</p>\n<p>执行上下文的创建阶段主要负责三件事：</p>\n<ol>\n<li><code>this</code></li>\n<li>Lexical Environment</li>\n<li>Variable Environment</li>\n</ol>\n<h2 id=\"词法环境\">词法环境</h2>\n<p>词法环境（Lexical Environment）：作用于词法分析阶段。包含两部分：</p>\n<ol>\n<li>Environment Record（环境记录）是一个以全部局部变量为属性的对象（以及其他如 this 值的信息）。</li>\n<li>对 outer lexical environment（外部词法环境）的引用，通常关联词法上的外面一层代码（花括号外一层）。</li>\n</ol>\n<p>词法环境是在代码定义的时候决定的，跟代码在哪⾥调⽤没有关系</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// 全局执⾏上下⽂</span>\n<span class=\"hljs-title class_\">GlobalExectionContext</span> = {\n  <span class=\"hljs-comment\">// 词法环境</span>\n  <span class=\"hljs-title class_\">LexicalEnvironment</span>: {\n    <span class=\"hljs-comment\">// 环境记录</span>\n    <span class=\"hljs-title class_\">EnvironmentRecord</span>: {\n      <span class=\"hljs-title class_\">Type</span>: <span class=\"hljs-string\">&quot;Object&quot;</span>, <span class=\"hljs-comment\">// 全局环境</span>\n      <span class=\"hljs-comment\">// ... 标识符绑定在这⾥</span>\n      <span class=\"hljs-attr\">outer</span>: &lt;<span class=\"hljs-literal\">null</span>&gt;, <span class=\"hljs-comment\">// 对外部环境的引⽤</span>\n    }\n  }\n}\n<span class=\"hljs-comment\">// 函数执⾏上下⽂</span>\n<span class=\"hljs-title class_\">FunctionExectionContext</span> = {\n  <span class=\"hljs-title class_\">LexicalEnvironment</span>: {\n    <span class=\"hljs-title class_\">EnvironmentRecord</span>: {\n      <span class=\"hljs-title class_\">Type</span>: <span class=\"hljs-string\">&quot;Declarative&quot;</span>,<span class=\"hljs-comment\">// 函数环境</span>\n      <span class=\"hljs-comment\">// ... 标识符绑定在这⾥</span>\n      <span class=\"hljs-comment\">// 对全局环境或外部函数环境的引⽤</span>\n      <span class=\"hljs-attr\">outer</span>: <span class=\"language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Global</span> <span class=\"hljs-attr\">or</span> <span class=\"hljs-attr\">outer</span> <span class=\"hljs-attr\">function</span> <span class=\"hljs-attr\">environment</span> <span class=\"hljs-attr\">reference</span>&gt;</span>,\n    }\n  }\n}</span>\n</code></pre>\n<h2 id=\"词法环境与闭包\">词法环境与闭包</h2>\n<blockquote>\n<p>一个函数和对其周围状态（lexical environment，词法环境）的引用捆绑在一起（或者说函数被引用包围），这样的组合就是闭包（closure） --MDN</p>\n</blockquote>\n<h2 id=\"变量环境\">变量环境</h2>\n<p>为了继续去适配早期JavaScript的<code>var</code>等，ES6增加了<strong>变量环境（Variable Environment）</strong>。变量环境也是一个词法环境，其环境记录器包含有变量声明语句</p>\n<p>在ES6中，词法环境和变量环境的区别在于前者用于存储函数声明和变量(<code>let</code>和<code>const</code>)绑定，而后者仅用于存储变量(<code>var</code>)绑定</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">let</span> a = <span class=\"hljs-number\">20</span>;\n<span class=\"hljs-keyword\">const</span> b = <span class=\"hljs-number\">30</span>;\n<span class=\"hljs-keyword\">var</span> c;\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">multiply</span>(<span class=\"hljs-params\">e, f</span>){\n  <span class=\"hljs-keyword\">var</span> g = <span class=\"hljs-number\">20</span>;\n  <span class=\"hljs-keyword\">return</span> e*f*g;\n}\nc = <span class=\"hljs-title function_\">multiply</span>(<span class=\"hljs-number\">20</span>, <span class=\"hljs-number\">30</span>);\n</code></pre>\n<p>词法构成</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// 全局执⾏上下⽂</span>\n<span class=\"hljs-title class_\">GlobalExectionContext</span> = {\n  <span class=\"hljs-title class_\">ThisBinding</span>: &lt; <span class=\"hljs-title class_\">Global</span> <span class=\"hljs-title class_\">Object</span> &gt; ,\n  <span class=\"hljs-comment\">// 词法环境</span>\n  <span class=\"hljs-title class_\">LexicalEnvironment</span>: {\n    <span class=\"hljs-title class_\">EnvironmentRecord</span>: {\n      <span class=\"hljs-title class_\">Type</span>: <span class=\"hljs-string\">&quot;Object&quot;</span>,\n      <span class=\"hljs-comment\">// 标识符绑定，let、const、函数声明</span>\n      <span class=\"hljs-attr\">a</span>: &lt; uninitialized &gt; ,\n      <span class=\"hljs-attr\">b</span>: &lt; uninitialized &gt; ,\n      <span class=\"hljs-attr\">multiply</span>: &lt; func &gt;\n    }\n    <span class=\"hljs-attr\">outer</span>: &lt; <span class=\"hljs-literal\">null</span> &gt;\n  },\n  <span class=\"hljs-comment\">// 变量环境</span>\n  <span class=\"hljs-title class_\">VariableEnvironment</span>: {\n    <span class=\"hljs-title class_\">EnvironmentRecord</span>: {\n      <span class=\"hljs-title class_\">Type</span>: <span class=\"hljs-string\">&quot;Object&quot;</span>,\n      <span class=\"hljs-comment\">// 标识符绑定，var 声明</span>\n      <span class=\"hljs-attr\">c</span>: <span class=\"hljs-literal\">undefined</span>,\n    }\n    <span class=\"hljs-attr\">outer</span>: &lt; <span class=\"hljs-literal\">null</span> &gt;\n  }\n}\n\n<span class=\"hljs-comment\">// 函数执⾏上下⽂</span>\n<span class=\"hljs-title class_\">FunctionExectionContext</span> = {\n  <span class=\"hljs-title class_\">ThisBinding</span>: &lt; <span class=\"hljs-title class_\">Global</span> <span class=\"hljs-title class_\">Object</span> &gt; ,\n  <span class=\"hljs-title class_\">LexicalEnvironment</span>: {\n    <span class=\"hljs-title class_\">EnvironmentRecord</span>: {\n      <span class=\"hljs-title class_\">Type</span>: <span class=\"hljs-string\">&quot;Declarative&quot;</span>,\n      <span class=\"hljs-comment\">// 标识符绑定</span>\n      <span class=\"hljs-title class_\">Arguments</span>: {\n        <span class=\"hljs-number\">0</span>: <span class=\"hljs-number\">20</span>,\n        <span class=\"hljs-number\">1</span>: <span class=\"hljs-number\">30</span>,\n        <span class=\"hljs-attr\">length</span>: <span class=\"hljs-number\">2</span>\n      },\n    },\n    <span class=\"hljs-attr\">outer</span>: &lt; <span class=\"hljs-title class_\">GlobalLexicalEnvironment</span> &gt;\n  },\n  <span class=\"hljs-title class_\">VariableEnvironment</span>: {\n    <span class=\"hljs-title class_\">EnvironmentRecord</span>: {\n      <span class=\"hljs-title class_\">Type</span>: <span class=\"hljs-string\">&quot;Declarative&quot;</span>,\n      <span class=\"hljs-comment\">// 在这⾥绑定标识符</span>\n      <span class=\"hljs-attr\">g</span>: <span class=\"hljs-literal\">undefined</span>\n    },\n    <span class=\"hljs-attr\">outer</span>: &lt; <span class=\"hljs-title class_\">GlobalLexicalEnvironment</span> &gt;\n  }\n}\n</code></pre>\n<h2 id=\"参考\">参考</h2>\n<p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures\">MDN-闭包</a></p>\n<p><a href=\"https://hondrytravis.github.io/docs/typescript/javascript_workflow/\">JS | 执行调度过程</a></p>\n"}},"__N_SSG":true}