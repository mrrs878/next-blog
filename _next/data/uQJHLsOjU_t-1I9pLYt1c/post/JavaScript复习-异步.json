{"pageProps":{"post":{"title":"JavaScriptå¤ä¹ -å¼‚æ­¥","tags":["JavaScript","Promise","Generator","Promise"],"categories":"2021å¤ä¹ ","description":"JavaScriptä¸ºå¼‚æ­¥éé˜»å¡ï¼ŒES6ä¹‹å‰ä¸»è¦é å›è°ƒå‡½æ•°æ¥å®ç°å¼‚æ­¥ï¼Œä½†ç”±äºå›è°ƒå‡½æ•°å®¹æ˜“å‡ºç°å›è°ƒåœ°ç‹±ç­‰é—®é¢˜ï¼Œäºæ˜¯ES6+æä¾›äº†äº†`Generator`ã€`Promise`ã€`async/await`è¿™äº›APIæ¥é™ä½å¼‚æ­¥ç¼–ç¨‹çš„éš¾åº¦ä¸å¤æ‚åº¦ã€‚\n\n## å›è°ƒå‡½æ•°\n\nå›è°ƒå‡½æ•°å®¹æ˜“å‡ºç°å›è°ƒåœ°ç‹±ï¼Œå¯è¯»æ€§å·®\n\n``` js\nfunction ajax(url, options, onSuccess) {","createDate":"2021-05-12 10:36:56","updateDate":"2021-06-24 18:47:28","body":"<p>JavaScriptä¸ºå¼‚æ­¥éé˜»å¡ï¼ŒES6ä¹‹å‰ä¸»è¦é å›è°ƒå‡½æ•°æ¥å®ç°å¼‚æ­¥ï¼Œä½†ç”±äºå›è°ƒå‡½æ•°å®¹æ˜“å‡ºç°å›è°ƒåœ°ç‹±ç­‰é—®é¢˜ï¼Œäºæ˜¯ES6+æä¾›äº†äº†<code>Generator</code>ã€<code>Promise</code>ã€<code>async/await</code>è¿™äº›APIæ¥é™ä½å¼‚æ­¥ç¼–ç¨‹çš„éš¾åº¦ä¸å¤æ‚åº¦ã€‚</p>\n<h2 id=\"å›è°ƒå‡½æ•°\">å›è°ƒå‡½æ•°</h2>\n<p>å›è°ƒå‡½æ•°å®¹æ˜“å‡ºç°å›è°ƒåœ°ç‹±ï¼Œå¯è¯»æ€§å·®</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">ajax</span>(<span class=\"hljs-params\">url, options, onSuccess</span>) {\n    <span class=\"hljs-comment\">// ...</span>\n}\n\n<span class=\"hljs-title function_\">ajax</span>(<span class=\"hljs-string\">&#x27;/api/xxx&#x27;</span>, {}, <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) {\n    <span class=\"hljs-title function_\">ajax</span>(<span class=\"hljs-string\">&#x27;/api/yyy&#x27;</span>, {}, <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) {\n        <span class=\"hljs-title function_\">ajax</span>(<span class=\"hljs-string\">&#x27;/api/zzz&#x27;</span>, (), <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) {\n        })\n    })\n})\n</code></pre>\n<h3 id=\"generator\">Generator</h3>\n<p>å½¢å¼ä¸Šï¼Œ<code>generator</code>å‡½æ•°æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œå°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€ã€‚æ‰§è¡Œ<code>generator</code>å‡½æ•°ä¼šè¿”å›ä¸€ä¸ª<strong>éå†å™¨å¯¹è±¡</strong></p>\n<p>è¯­æ³•ä¸Šï¼Œ<code>generator</code>å‡½æ•°æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ã€‚<code>function</code>å…³é”®å­—ä¸å‡½æ•°åä¹‹é—´æœ‰ä¸€ä¸ª<code>*</code>ï¼›å‡½æ•°ä½“å†…ä½¿ç”¨<code>yield</code>è¡¨è¾¾å¼å®šä¹‰ä¸åŒçš„å†…éƒ¨çŠ¶æ€</p>\n<p>ä¸æ™®é€šå‡½æ•°ä¸åŒï¼Œ<code>generator</code>å‡½æ•°è¢«è°ƒç”¨å<strong>å¹¶ä¸æ‰§è¡Œ</strong>ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªæŒ‡å‘å†…éƒ¨çŠ¶æ€çš„æŒ‡é’ˆå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯<strong>éå†å™¨å¯¹è±¡</strong>ã€‚ä¸‹ä¸€æ­¥ï¼Œ<strong>å¿…é¡»è°ƒç”¨éå†å™¨å¯¹è±¡çš„<code>next</code>æ–¹æ³•</strong>ä½¿å¾—æŒ‡é’ˆç§»å‘ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡è°ƒç”¨<code>next</code>æ–¹æ³•ï¼Œå†…éƒ¨æŒ‡é’ˆå°±ä»å‡½æ•°å¤´éƒ¨æˆ–ä¸Šä¸€æ¬¡åœä¸‹æ¥çš„åœ°æ–¹å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª<code>yield</code>æˆ–<code>return</code></p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">function</span>* <span class=\"hljs-title function_\">gen</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-keyword\">const</span> str1 = <span class=\"hljs-keyword\">yield</span> <span class=\"hljs-string\">&quot;hello&quot;</span>\n  <span class=\"hljs-comment\">// str1 = 222</span>\n  <span class=\"hljs-keyword\">const</span> str2 = <span class=\"hljs-keyword\">yield</span> <span class=\"hljs-string\">&quot;world&quot;</span>\n  <span class=\"hljs-comment\">// str2 = 333</span>\n  <span class=\"hljs-keyword\">return</span> str2\n}\n\n<span class=\"hljs-keyword\">const</span> iter = <span class=\"hljs-title function_\">gen</span>()\n<span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(iter.<span class=\"hljs-title function_\">next</span>())\n<span class=\"hljs-comment\">// { value: &quot;hello&quot;, done: false }</span>\n<span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(iter.<span class=\"hljs-title function_\">next</span>(<span class=\"hljs-number\">222</span>))\n<span class=\"hljs-comment\">// { value: &quot;world&quot;, done: false }</span>\n<span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(iter.<span class=\"hljs-title function_\">next</span>(<span class=\"hljs-number\">333</span>))\n<span class=\"hljs-comment\">// { value: 333, done: false }</span>\n</code></pre>\n<p>ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œ<code>generator</code>å‡½æ•°å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ç¬¬ä¸€ä¸ª<code>yield</code>è¡¨è¾¾å¼ä¸ºæ­¢ã€‚<code>next</code>æ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„<code>value</code>å€¼å°±æ˜¯å½“å‰<code>yield</code>è¡¨è¾¾å¼çš„å€¼ï¼Œ<code>done</code>çš„å€¼ä¸º<code>false</code></p>\n<p>ç¬¬äºŒæ¬¡è°ƒç”¨ï¼Œ<code>generator</code>ä»ä¸Šæ¬¡<code>yield</code>è¡¨è¾¾å¼åœä¸‹æ¥çš„åœ°æ–¹ä¸€ç›´æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ª<code>yield</code>è¡¨è¾¾å¼ ğŸ‘† â€¦â€¦</p>\n<p>ç¬¬ä¸‰æ¬¡è°ƒç”¨ï¼Œ<code>generator</code>å‡½æ•°ä»ä¸Šæ¬¡<code>yield</code>è¡¨è¾¾å¼åœä¸‹æ¥çš„åœ°æ–¹ä¸€ç›´æ‰§è¡Œåˆ°<code>return</code>è¯­å¥ï¼Œ<code>next</code>è¿”å›çš„<code>value</code>å€¼å°±æ˜¯<code>return</code>åé¢è¡¨è¾¾å¼çš„å€¼ï¼Œ<code>done</code>ä¸º<code>true</code></p>\n<p><code>yield</code>è¡¨è¾¾å¼æœ¬èº«æ²¡æœ‰è¿”å›å€¼ï¼ˆæˆ–è€…è¯´æ€»æ˜¯è¿”å›<code>undefined</code>ï¼‰ã€‚<code>next</code>æ–¹æ³•å¯ä»¥å¸¦ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°ä¼šè¢«å½“ä½œ<strong>ä¸Šä¸€ä¸ª</strong><code>yield</code>è¡¨è¾¾å¼çš„è¿”å›å€¼</p>\n<h2 id=\"promise\">Promise</h2>\n<p>ES6æä¾›çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹æ–¹æ¡ˆ</p>\n<p>ä¸€ä¸ª<code>Promise</code>å¯¹è±¡å¿…ç„¶å¤„äºä»¥ä¸‹ä¸‰ç§çŠ¶æ€ï¼š</p>\n<ul>\n<li>pendingï¼Œåˆå§‹çŠ¶æ€</li>\n<li>fulfilledï¼ŒæˆåŠŸ</li>\n<li>rejectedï¼Œå¤±è´¥</li>\n</ul>\n<p><code>pending</code>çŠ¶æ€çš„<code>Promise</code>å¯¹è±¡å¯ä»¥è½¬æ¢ä¸º<code>fulfilled</code>æˆ–<code>rejected</code>çŠ¶æ€ï¼Œè€Œä¸”æ­¤è¿‡ç¨‹æ˜¯ä¸å¯é€†çš„ã€‚å½“çŠ¶æ€å˜æ›´æ—¶ï¼Œ<code>then()</code>æ–¹æ³•æ³¨å†Œçš„å›è°ƒå°±ä¼šè¢«è°ƒç”¨</p>\n<p><code>then()</code> æˆ–è€… <code>catch()</code> çš„å‚æ•°æœŸæœ›æ˜¯å‡½æ•°ï¼Œä¼ â¼Šâ¾®å‡½æ•°åˆ™ä¼šå‘â½£å€¼é€ä¼ <code>(value =&gt; value)</code></p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">resolve</span>(<span class=\"hljs-number\">1</span>)\n .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-number\">2</span>) <span class=\"hljs-comment\">// .then(1 =&gt; 1)</span>\n .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">resolve</span>(<span class=\"hljs-number\">3</span>)) <span class=\"hljs-comment\">// .then(1 =&gt; 1)</span>\n .<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-property\">log</span>)\n<span class=\"hljs-comment\">// 1</span>\n</code></pre>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-params\">url, options = {}</span>) {\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> {\n    <span class=\"hljs-keyword\">const</span> xhr = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">XMLHttpRequest</span>();\n    xhr.<span class=\"hljs-title function_\">open</span>(options.<span class=\"hljs-property\">method</span> || <span class=\"hljs-string\">&#x27;GET&#x27;</span>, url);\n    <span class=\"hljs-keyword\">const</span> headers = { <span class=\"hljs-string\">&#x27;Content-Type&#x27;</span>: <span class=\"hljs-string\">&#x27;application/json&#x27;</span>, ...options.<span class=\"hljs-property\">headers</span> || {} };\n    <span class=\"hljs-title class_\">Reflect</span>.<span class=\"hljs-title function_\">ownKeys</span>(headers)\n      .<span class=\"hljs-title function_\">forEach</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">header</span>) =&gt;</span> xhr.<span class=\"hljs-title function_\">setRequestHeader</span>(header, headers[header]));\n    xhr.<span class=\"hljs-title function_\">send</span>(options.<span class=\"hljs-property\">method</span> === <span class=\"hljs-string\">&#x27;POST&#x27;</span> ? <span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">stringify</span>(options.<span class=\"hljs-property\">data</span> || {}) : <span class=\"hljs-literal\">null</span>);\n    xhr.<span class=\"hljs-property\">onerror</span> = <span class=\"hljs-function\">(<span class=\"hljs-params\">e</span>) =&gt;</span> <span class=\"hljs-title function_\">reject</span>(e);\n    xhr.<span class=\"hljs-property\">onreadystatechange</span> = <span class=\"hljs-function\">() =&gt;</span> {\n      <span class=\"hljs-keyword\">if</span> (xhr.<span class=\"hljs-property\">readyState</span> === <span class=\"hljs-title class_\">XMLHttpRequest</span>.<span class=\"hljs-property\">DONE</span>\n        &amp;&amp; [<span class=\"hljs-number\">200</span>, <span class=\"hljs-number\">201</span>, <span class=\"hljs-number\">301</span>, <span class=\"hljs-number\">302</span>, <span class=\"hljs-number\">304</span>].<span class=\"hljs-title function_\">includes</span>(xhr.<span class=\"hljs-property\">status</span>)) {\n        <span class=\"hljs-title function_\">resolve</span>(<span class=\"hljs-title class_\">JSON</span>.<span class=\"hljs-title function_\">parse</span>(xhr.<span class=\"hljs-property\">responseText</span>));\n      }\n    };\n  });\n}\n<span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">&#x27;http://localhost:3004/get&#x27;</span>).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">res</span>) =&gt;</span> {\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res);\n}).<span class=\"hljs-title function_\">catch</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">e</span>) =&gt;</span> {\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">error</span>(e);\n})\n</code></pre>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve,reject</span>)=&gt;</span>{\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&quot;1&quot;</span>)\n    <span class=\"hljs-title function_\">resolve</span>();\n}).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">()=&gt;</span>{\n    <span class=\"hljs-comment\">// å¤–éƒ¨ç¬¬1ä¸ªthen</span>\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&quot;2&quot;</span>)\n    <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve,reject</span>)=&gt;</span>{\n        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&quot;3&quot;</span>)\n        <span class=\"hljs-title function_\">resolve</span>();\n    }).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">()=&gt;</span>{\n        <span class=\"hljs-comment\">// å†…éƒ¨ç¬¬1ä¸ªthen</span>\n        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&quot;4&quot;</span>)\n    }).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">() =&gt;</span> {\n        <span class=\"hljs-comment\">// å†…éƒ¨ç¬¬2ä¸ªthen</span>\n        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&quot;5&quot;</span>)\n    })\n}).<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">res</span>)=&gt;</span>{\n    <span class=\"hljs-comment\">// å¤–éƒ¨ç¬¬2ä¸ªthen</span>\n    <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&quot;6&quot;</span>)\n})\n</code></pre>\n<p>ç®€å•æ¥è®²å°±æ˜¯thenå›è°ƒçš„æ³¨å†Œéœ€è¦ä¸Šä¸€ä¸ªthené‡Œé¢çš„åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•</p>\n<p>æ‹¿ä¸Šé¢çš„ä»£ç æ¥è®²ï¼Œå½“å¤–éƒ¨ç¬¬1ä¸ªthené‡Œçš„resovle()æ‰§è¡Œå®Œæ¯•åï¼Œè¯¥Promiseçš„çŠ¶æ€å·²ç»æ›´æ”¹ï¼Œä¼šå°†å†…éƒ¨ç¬¬1ä¸ªthenå›è°ƒæ·»åŠ ï¼ˆæ³¨å†Œï¼‰åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼›å†…éƒ¨ç¬¬2ä¸ªthenç”±äºä¸Šä¸€ä¸ªthenå›è°ƒæ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œå› æ­¤ä¸ä¼šæ³¨å†Œã€‚æ­¤æ—¶å¤–éƒ¨ç¬¬1ä¸ªthené‡Œçš„åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œä¼šæ³¨å†Œå¤–éƒ¨ç¬¬2ä¸ªthenå›è°ƒ</p>\n<p>æ•´ç†ä¸€ä¸‹ï¼šthenå›è°ƒæ³¨å†Œçš„é¡ºåºæ˜¯ï¼šå¤–éƒ¨ç¬¬1ä¸ªthen --&gt; å†…éƒ¨ç¬¬1ä¸ªthen --&gt; å¤–éƒ¨ç¬¬2ä¸ªthen --&gt; å†…éƒ¨ç¬¬2ä¸ªthen</p>\n<p>ps: å¦‚æœå°†å¤–éƒ¨ç¬¬1ä¸ªthené‡Œçš„new Promise(xxx)æ”¹ä¸ºreturn new Promise(xxx)çš„è¯å†…éƒ¨ç¬¬2ä¸ªthençš„æ³¨å†Œå°†æ—©äº* å¤–éƒ¨ç¬¬2ä¸ªthen*</p>\n<h2 id=\"asyncawait\">async/await</h2>\n<p>ç›®å‰æ¥è®²ï¼Œæœ€ä¸ºä¼˜ç§€çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹æ–¹æ¡ˆï¼Œä¸ES2017æå‡º</p>\n<p>å®ç°ä¸Šæ˜¯<code>Generator</code>+<code>Promise</code>çš„è¯­æ³•ç³–</p>\n<p>é€šè¿‡åœ¨<code>onFulFilled()</code>é‡Œè°ƒç”¨<code>next()</code>ã€åœ¨<code>next()</code>é‡Œè°ƒç”¨<code>onFulfilled()</code>å½¢æˆä¸€ä¸ªè‡ªæ‰§è¡Œå™¨ï¼Œåªæœ‰å½“å…¨éƒ¨ä»£ç æ‰§è¡Œå®Œæ¯•åæ‰ä¼šç»ˆæ­¢</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">async</span> <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">fn</span>(<span class=\"hljs-params\"></span>) {\n    <span class=\"hljs-keyword\">try</span> {\n        <span class=\"hljs-keyword\">const</span> res = <span class=\"hljs-keyword\">await</span> <span class=\"hljs-title function_\">fetch</span>(<span class=\"hljs-string\">&#x27;http://localhost:3004/get&#x27;</span>);\n        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(res);\n    } <span class=\"hljs-keyword\">catch</span> (e) {\n        <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">error</span>(e);\n    }\n}\n</code></pre>\n<p><code>async/await</code>åŸç†: <strong>è‡ªåŠ¨æ‰§è¡Œgeneratorå‡½æ•°</strong></p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">const</span> <span class=\"hljs-title function_\">getData</span> = (<span class=\"hljs-params\"></span>) =&gt;\n  <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve</span>) =&gt;</span> <span class=\"hljs-built_in\">setTimeout</span>(<span class=\"hljs-function\">() =&gt;</span> <span class=\"hljs-title function_\">resolve</span>(<span class=\"hljs-string\">&quot;data&quot;</span>), <span class=\"hljs-number\">1000</span>));\n\n<span class=\"hljs-keyword\">function</span>* <span class=\"hljs-title function_\">testG</span>(<span class=\"hljs-params\"></span>) {\n  <span class=\"hljs-comment\">// awaitè¢«ç¼–è¯‘æˆäº†yield</span>\n  <span class=\"hljs-keyword\">const</span> data = <span class=\"hljs-keyword\">yield</span> <span class=\"hljs-title function_\">getData</span>();\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&quot;data: &quot;</span>, data);\n  <span class=\"hljs-keyword\">const</span> data2 = <span class=\"hljs-keyword\">yield</span> <span class=\"hljs-title function_\">getData</span>();\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(<span class=\"hljs-string\">&quot;data2: &quot;</span>, data2);\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;success&quot;</span>;\n}\n\n<span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">asyncToGenerator</span>(<span class=\"hljs-params\">generatorFunc</span>) {\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">...args</span>) {\n    <span class=\"hljs-keyword\">const</span> gen = generatorFunc.<span class=\"hljs-title function_\">apply</span>(<span class=\"hljs-variable language_\">this</span>, args);\n\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Promise</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">resolve, reject</span>) =&gt;</span> {\n      <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">step</span>(<span class=\"hljs-params\">key, arg</span>) {\n        <span class=\"hljs-keyword\">let</span> generatorResult;\n        <span class=\"hljs-keyword\">try</span> {\n          generatorResult = gen[key](arg);\n        } <span class=\"hljs-keyword\">catch</span> (error) {\n          <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">reject</span>(error);\n        }\n\n        <span class=\"hljs-keyword\">const</span> { value, done } = generatorResult;\n\n        <span class=\"hljs-keyword\">if</span> (done) {\n          <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title function_\">resolve</span>(value);\n        } <span class=\"hljs-keyword\">else</span> {\n          <span class=\"hljs-keyword\">return</span> <span class=\"hljs-title class_\">Promise</span>.<span class=\"hljs-title function_\">resolve</span>(value).<span class=\"hljs-title function_\">then</span>(\n            <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">onResolve</span>(<span class=\"hljs-params\">val</span>) {\n              <span class=\"hljs-title function_\">step</span>(<span class=\"hljs-string\">&quot;next&quot;</span>, val);\n            },\n            <span class=\"hljs-keyword\">function</span> <span class=\"hljs-title function_\">onReject</span>(<span class=\"hljs-params\">err</span>) {\n              <span class=\"hljs-title function_\">step</span>(<span class=\"hljs-string\">&quot;throw&quot;</span>, err);\n            }\n          );\n        }\n      }\n      <span class=\"hljs-title function_\">step</span>(<span class=\"hljs-string\">&quot;next&quot;</span>);\n    });\n  };\n}\n\n<span class=\"hljs-keyword\">const</span> testGAsync = <span class=\"hljs-title function_\">asyncToGenerator</span>(testG);\n<span class=\"hljs-title function_\">testGAsync</span>().<span class=\"hljs-title function_\">then</span>(<span class=\"hljs-function\">(<span class=\"hljs-params\">result</span>) =&gt;</span> {\n  <span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(result);\n});\n</code></pre>\n<h2 id=\"å‚è€ƒ\">å‚è€ƒ</h2>\n<p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise\">MDN-Promise</a></p>\n<p><a href=\"https://github.com/imtaotao/co-share\">co-share</a></p>\n"}},"__N_SSG":true}