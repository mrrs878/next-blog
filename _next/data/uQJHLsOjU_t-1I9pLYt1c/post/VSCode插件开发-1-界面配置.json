{"pageProps":{"post":{"title":"VSCode插件开发-1-界面配置","tags":["VSCode插件"],"categories":"VSCode插件","description":"## 简介\n\nVSCode插件界面与package.json中的字段对应如图\n\n![插件界面与package.json中的字段对应](https://mrrsblog.oss-cn-shanghai.aliyuncs.com/vscodeExtensionView.png)\n\n其中：\n\n- activityBar是左侧边栏中的插件图标\n\n- '公交线路'(sidebar)相当于一级菜单，可通过","createDate":"2021-03-23 15:34:17","updateDate":"2021-03-26 11:28:12","body":"<h2 id=\"简介\">简介</h2>\n<p>VSCode插件界面与package.json中的字段对应如图</p>\n<p><img src=\"https://mrrsblog.oss-cn-shanghai.aliyuncs.com/vscodeExtensionView.png\" alt=\"插件界面与package.json中的字段对应\"></p>\n<p>其中：</p>\n<ul>\n<li><p>activityBar是左侧边栏中的插件图标</p>\n</li>\n<li><p>&#39;公交线路&#39;(sidebar)相当于一级菜单，可通过packa.json中的<code>views.sidebar</code>配置</p>\n</li>\n<li><p>&#39;浦东25路/1117路&#39;相当于二级菜单，通过代码创建</p>\n<pre><code class=\"hljs language-js\">vscode.<span class=\"hljs-property\">window</span>.<span class=\"hljs-title function_\">registerTreeDataProvider</span>(<span class=\"hljs-string\">&#x27;sidebar_id&#x27;</span>, <span class=\"hljs-title class_\">TreeDataProvider</span>);\n</code></pre>\n</li>\n<li><p>菜单项中的图标在<code>commands</code>和<code>menus</code>中配置，<code>view/title</code>对应的是一级菜单；<code>view/item/context</code>对应的是二级菜单</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-comment\">// 1. 先添加command</span>\n<span class=\"hljs-string\">&quot;commands&quot;</span>: [\n    {\n        <span class=\"hljs-string\">&quot;command&quot;</span>: <span class=\"hljs-string\">&quot;realTimeBus.refreshLines&quot;</span>,\n        <span class=\"hljs-string\">&quot;icon&quot;</span>: <span class=\"hljs-string\">&quot;$(refresh)&quot;</span>,\n        <span class=\"hljs-string\">&quot;title&quot;</span>: <span class=\"hljs-string\">&quot;刷新线路&quot;</span>\n    },\n    {\n        <span class=\"hljs-string\">&quot;command&quot;</span>: <span class=\"hljs-string\">&quot;realTimeBus.addLine&quot;</span>,\n        <span class=\"hljs-string\">&quot;icon&quot;</span>: <span class=\"hljs-string\">&quot;$(add)&quot;</span>,\n        <span class=\"hljs-string\">&quot;title&quot;</span>: <span class=\"hljs-string\">&quot;添加线路&quot;</span>\n    },\n    {\n        <span class=\"hljs-string\">&quot;command&quot;</span>: <span class=\"hljs-string\">&quot;realTimeBus.removeLine&quot;</span>,\n        <span class=\"hljs-string\">&quot;icon&quot;</span>: <span class=\"hljs-string\">&quot;$(remove)&quot;</span>,\n        <span class=\"hljs-string\">&quot;title&quot;</span>: <span class=\"hljs-string\">&quot;删除线路&quot;</span>\n    },\n]\n\n<span class=\"hljs-comment\">// 2. 设置图标位置</span>\n<span class=\"hljs-string\">&quot;menus&quot;</span>: {\n  <span class=\"hljs-string\">&quot;view/title&quot;</span>: [\n    {\n      <span class=\"hljs-string\">&quot;command&quot;</span>: <span class=\"hljs-string\">&quot;realTimeBus.refreshLines&quot;</span>,\n      <span class=\"hljs-string\">&quot;group&quot;</span>: <span class=\"hljs-string\">&quot;navigation&quot;</span>,  <span class=\"hljs-comment\">// 和文字一行显示</span>\n      <span class=\"hljs-string\">&quot;when&quot;</span>: <span class=\"hljs-string\">&quot;view == realTimeBusLine&quot;</span>\n    }\n  ],\n  <span class=\"hljs-string\">&quot;view/item/context&quot;</span>: [\n    {\n      <span class=\"hljs-string\">&quot;command&quot;</span>: <span class=\"hljs-string\">&quot;realTimeBus.revertLine&quot;</span>,\n      <span class=\"hljs-string\">&quot;group&quot;</span>: <span class=\"hljs-string\">&quot;inline&quot;</span>,  <span class=\"hljs-comment\">// 和文字一行显示</span>\n      <span class=\"hljs-string\">&quot;when&quot;</span>: <span class=\"hljs-string\">&quot;view == realTimeBusLine &amp;&amp; viewItem == BusLineItem&quot;</span>\n    }\n  ]\n}\n\n<span class=\"hljs-comment\">// 配置viewItem == BusLineItem后command回调函数可以接收到被点击的菜单项</span>\ncommands.<span class=\"hljs-title function_\">registerCommand</span>(<span class=\"hljs-string\">&#x27;realTimeBus.revertLine&#x27;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">params</span>) =&gt;</span> {\n<span class=\"hljs-title class_\">BusLineProvider</span>.<span class=\"hljs-title function_\">revertLine</span>(params);\n});\n</code></pre>\n</li>\n</ul>\n<h2 id=\"treeview\">treeView</h2>\n<p>一级菜单可在<code>package.json</code>中配置，二级菜单需要使用<code>TreeDataProvider</code></p>\n<pre><code class=\"hljs language-ts\"><span class=\"hljs-keyword\">export</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">BusLineProvider</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">TreeDataProvider</span>&lt;<span class=\"hljs-title class_\">BusLineTreeItem</span>|<span class=\"hljs-title class_\">BusStopTreeItem</span>&gt;{\n  <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-attr\">instance</span>: <span class=\"hljs-title class_\">BusLineProvider</span>;\n\n  <span class=\"hljs-keyword\">private</span> <span class=\"hljs-attr\">_onDidChangeTreeData</span>: <span class=\"hljs-title class_\">EventEmitter</span>&lt;<span class=\"hljs-title class_\">BusLineTreeItem</span> | <span class=\"hljs-literal\">undefined</span> | <span class=\"hljs-built_in\">void</span>&gt; \n    = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">EventEmitter</span>&lt;<span class=\"hljs-title class_\">BusLineTreeItem</span> | <span class=\"hljs-literal\">undefined</span> | <span class=\"hljs-built_in\">void</span>&gt;();\n    <span class=\"hljs-keyword\">readonly</span> <span class=\"hljs-attr\">onDidChangeTreeData</span>: <span class=\"hljs-title class_\">Event</span>&lt;<span class=\"hljs-title class_\">BusLineTreeItem</span> | <span class=\"hljs-literal\">undefined</span> | <span class=\"hljs-built_in\">void</span>&gt;\n    = <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">_onDidChangeTreeData</span>.<span class=\"hljs-property\">event</span>;\n  \n  <span class=\"hljs-title function_\">getTreeItem</span>(<span class=\"hljs-params\">element: BusLineTreeItem</span>) {\n    <span class=\"hljs-keyword\">return</span> element;\n  }\n\n  <span class=\"hljs-comment\">// 核心方法</span>\n  <span class=\"hljs-keyword\">async</span> <span class=\"hljs-title function_\">getChildren</span>(<span class=\"hljs-params\">item: BusLineTreeItem|BusStopTreeItem</span>) {\n    <span class=\"hljs-keyword\">return</span> [];\n  }\n  \n  <span class=\"hljs-keyword\">static</span> <span class=\"hljs-title function_\">getInstance</span>(): <span class=\"hljs-title class_\">BusLineProvider</span> {\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">instance</span> || (<span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">instance</span> = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">BusLineProvider</span>());\n  }\n  \n  <span class=\"hljs-keyword\">static</span> <span class=\"hljs-title function_\">refreshLines</span>(<span class=\"hljs-params\">action: () =&gt; <span class=\"hljs-built_in\">void</span> = () =&gt; {}</span>) {\n    <span class=\"hljs-variable language_\">this</span>.<span class=\"hljs-property\">instance</span>.<span class=\"hljs-property\">_onDidChangeTreeData</span>.<span class=\"hljs-title function_\">fire</span>();\n  }\n}\n</code></pre>\n<p>创建后注册即可<code>vscode.window.registerTreeDataProvider(&#39;realTimeBusLine&#39;, BusLineProvider.getInstance());</code></p>\n<p>关键在于<code>getChildren</code>方法</p>\n<p><code>getChildren</code>会在以下情形调用:</p>\n<ol>\n<li><p>调用<code>vscode.window.registerTreeDataProvider</code>注册TreeDataProvider时</p>\n</li>\n<li><p>调用<code>this.instance._onDidChangeTreeData.fire()</code>时</p>\n</li>\n<li><p>点击可折叠<code>TreeItem</code></p>\n</li>\n</ol>\n<h2 id=\"可折叠菜单\">可折叠菜单</h2>\n<p>设置<code>TreeItem</code>的<code>collapse</code>属性为<code>TreeItemCollapsibleState.Collapsed</code></p>\n<p>点击该菜单时会调用<code>getChildren</code>，该菜单也回作为参数传递给<code>getChildren</code></p>\n"}},"__N_SSG":true}