{"pageProps":{"post":{"title":"前端架构&软实力-babel","tags":["babel","访问者模式","有限状态机"],"categories":"前端架构&软实力","description":"探究 Babel 内部的一些实现机制\n\n## tokenizer/parse-有限状态机\n\n// TODO\n\n## traverse-访问者模式\n\nVisitor（访问者模式）属于行为型模式\n\n意图：**表示一个作用于某对象结构中的各元素的操作。它使你可以在不改变各元素的类的前提下定义作用于这些元素的新操作。**\n\n访问者，顾名思义，就是对象访问的一种设计模式，我们可以在不改变要访问对象的前提下","createDate":"2022-08-22 20:11:45","updateDate":"2022-08-24 20:33:45","body":"<p>探究 Babel 内部的一些实现机制</p>\n\n      <h2>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">tokenizer/parse-有限状态机</span>\n        <span class=\"suffix\"></span>\n      </h2>\n    <p>// TODO</p>\n\n      <h2>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">traverse-访问者模式</span>\n        <span class=\"suffix\"></span>\n      </h2>\n    <p>Visitor（访问者模式）属于行为型模式</p>\n<p>意图：<strong>表示一个作用于某对象结构中的各元素的操作。它使你可以在不改变各元素的类的前提下定义作用于这些元素的新操作。</strong></p>\n<p>访问者，顾名思义，就是对象访问的一种设计模式，我们可以在不改变要访问对象的前提下，对访问对象的操作做拓展：<strong>它将对象的操作权移交给了 Visitor。</strong></p>\n<p>Babel 在 traverse 阶段用到了访问者模式，该阶段 Babel 的主要工作包括：</p>\n<ol>\n<li><p>对 ast 进行深度优先遍历</p>\n</li>\n<li><p>对节点进行添加、更新和移除等操作</p>\n</li>\n</ol>\n<pre><code class=\"hljs language-ts\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title class_\">Phone</span> {\n  <span class=\"hljs-title function_\">accept</span>(<span class=\"hljs-attr\">visitor</span>: <span class=\"hljs-title class_\">Visitor</span>): <span class=\"hljs-title class_\">PhoneInfo</span>;\n}\n\n<span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title class_\">PhoneInfo</span> {\n  <span class=\"hljs-attr\">os</span>: <span class=\"hljs-built_in\">string</span>;\n  <span class=\"hljs-attr\">chip</span>: <span class=\"hljs-built_in\">string</span>;\n  <span class=\"hljs-title class_\">GPUType</span>?: <span class=\"hljs-built_in\">string</span>;\n  port?: <span class=\"hljs-built_in\">string</span>;\n  screen?: <span class=\"hljs-built_in\">string</span>;\n}\n\n<span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title class_\">Visitor</span> {\n  <span class=\"hljs-title function_\">visit</span>(<span class=\"hljs-attr\">phone</span>: <span class=\"hljs-title class_\">Mate40</span>): <span class=\"hljs-title class_\">PhoneInfo</span>;\n  <span class=\"hljs-title function_\">visit</span>(<span class=\"hljs-attr\">phone</span>: <span class=\"hljs-title class_\">IPhone13</span>): <span class=\"hljs-title class_\">PhoneInfo</span>;\n}\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Mate40</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">Phone</span> {\n  <span class=\"hljs-title function_\">accept</span>(<span class=\"hljs-attr\">visitor</span>: <span class=\"hljs-title class_\">Visitor</span>): <span class=\"hljs-title class_\">PhoneInfo</span> {\n    <span class=\"hljs-keyword\">return</span> visitor.<span class=\"hljs-title function_\">visit</span>(<span class=\"hljs-variable language_\">this</span>);\n  }\n}\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">IPhone13</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">Phone</span> {\n  <span class=\"hljs-title function_\">accept</span>(<span class=\"hljs-attr\">visitor</span>: <span class=\"hljs-title class_\">Visitor</span>): <span class=\"hljs-title class_\">PhoneInfo</span> {\n    <span class=\"hljs-keyword\">return</span> visitor.<span class=\"hljs-title function_\">visit</span>(<span class=\"hljs-variable language_\">this</span>);\n  }\n}\n\n<span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">PhoneVisitor</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">Visitor</span> {\n  <span class=\"hljs-title function_\">visit</span>(<span class=\"hljs-attr\">phone</span>: <span class=\"hljs-title class_\">Mate40</span>): <span class=\"hljs-title class_\">PhoneInfo</span>;\n  <span class=\"hljs-title function_\">visit</span>(<span class=\"hljs-attr\">phone</span>: <span class=\"hljs-title class_\">IPhone13</span>): <span class=\"hljs-title class_\">PhoneInfo</span>;\n  <span class=\"hljs-title function_\">visit</span>(<span class=\"hljs-attr\">phone</span>: unknown): <span class=\"hljs-title class_\">PhoneInfo</span> {\n    <span class=\"hljs-keyword\">if</span> (phone <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">Mate40</span>) {\n      <span class=\"hljs-keyword\">return</span> {\n        <span class=\"hljs-attr\">os</span>: <span class=\"hljs-string\">&#x27;HarmonyOS&#x27;</span>,\n        <span class=\"hljs-attr\">chip</span>: <span class=\"hljs-string\">&#x27;Kirin 9000&#x27;</span>,\n        <span class=\"hljs-title class_\">GPUType</span>: <span class=\"hljs-string\">&#x27;Mali-G78&#x27;</span>,\n        <span class=\"hljs-attr\">port</span>: <span class=\"hljs-string\">&#x27;type-c&#x27;</span>,\n      };\n    }\n    <span class=\"hljs-keyword\">if</span> (phone <span class=\"hljs-keyword\">instanceof</span> <span class=\"hljs-title class_\">IPhone13</span>) {\n      <span class=\"hljs-keyword\">return</span> {\n        <span class=\"hljs-attr\">os</span>: <span class=\"hljs-string\">&#x27;ios&#x27;</span>,\n        <span class=\"hljs-attr\">chip</span>: <span class=\"hljs-string\">&#x27;A15仿生芯片&#x27;</span>,\n        <span class=\"hljs-attr\">screen</span>: <span class=\"hljs-string\">&#x27;电容屏&#x27;</span>,\n      };\n    }\n    <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Error</span>(<span class=\"hljs-string\">&#x27;不识别的phone&#x27;</span>);\n  }\n}\n\n<span class=\"hljs-keyword\">const</span> mate40 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Mate40</span>();\n<span class=\"hljs-keyword\">const</span> visitor = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">PhoneVisitor</span>();\n<span class=\"hljs-variable language_\">console</span>.<span class=\"hljs-title function_\">log</span>(mate40.<span class=\"hljs-title function_\">accept</span>(visitor));\n\n<span class=\"hljs-keyword\">export</span> {};\n</code></pre>\n\n      <h2>\n        <span class=\"prefix\"></span>\n        <span class=\"content\">参考</span>\n        <span class=\"suffix\"></span>\n      </h2>\n    <p><a href=\"https://www.codetd.com/article/13756799\">由 Babel 理解前端编译原理</a></p>\n"}},"__N_SSG":true}