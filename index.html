<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Mr.RS的个人博客-首页</title><meta name="next-head-count" content="3"/><link rel="preload" href="/next-blog/_next/static/css/c254d3655a5edcea.css" as="style"/><link rel="stylesheet" href="/next-blog/_next/static/css/c254d3655a5edcea.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/next-blog/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/next-blog/_next/static/chunks/webpack-cf185e4b59cdddcf.js" defer=""></script><script src="/next-blog/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/next-blog/_next/static/chunks/main-1c9e93b8392c1bc9.js" defer=""></script><script src="/next-blog/_next/static/chunks/pages/_app-ca6aae25bc99a05f.js" defer=""></script><script src="/next-blog/_next/static/chunks/899-eb6fa700a9fcd5c8.js" defer=""></script><script src="/next-blog/_next/static/chunks/pages/index-c4a1d0c688b897c3.js" defer=""></script><script src="/next-blog/_next/static/G8SRe3ccBbz7hzZBCxuYD/_buildManifest.js" defer=""></script><script src="/next-blog/_next/static/G8SRe3ccBbz7hzZBCxuYD/_ssgManifest.js" defer=""></script><script src="/next-blog/_next/static/G8SRe3ccBbz7hzZBCxuYD/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><header class="fixed top-0 py-4 left-0 right-0 h-auto px-10 shadow bg-white z-50"><nav><ul class="flex w-auto"><li class="mr-4 hover:text-yellow"><a href="/next-blog">首页</a></li><li class="mx-4 hover:text-yellow"><a href="/next-blog">分类</a></li><li class="ml-4 hover:text-yellow"><a href="/next-blog">归档</a></li></ul></nav></header><main class="mt-20 mb-4 mx-auto justify-center w-2/3"><ul class="flex flex-col space-y-12"><li><a href="/next-blog/post/undefined"></a></li><li><a href="/next-blog/post/undefined"></a></li><li><a href="/next-blog/post/undefined"></a></li><li><a href="/next-blog/post/undefined"></a></li><li><a href="/next-blog/post/undefined"></a></li></ul><div class="mt-4 mb-4"><button type="button" class="text-yellow cursor-pointer">更多文章......</button></div></main><footer class="flex flex-col items-center justify-center leading-8 text-sm w-full py-2 border-t text-skin-muted"><p>Designed &amp; developed by<a class="ml-1 text-yellow" target="_blank" href="https://github.com/mrrs878" rel="noreferrer">Mr.RS</a></p><div class="flex items-center justify-center"><span>本网站由 </span><a class="cdn-logo-c" href="https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referral"><img class="call-me" src="https://blog.mrrs.top/img/cdn_logo.png" style="width:40px" alt=""/></a><span>提供CDN加速/云存储服务</span></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"posts":[{"title":"生成自定义（unicode、字形）字体","tags":["反爬虫","字体","安全"],"categories":"反爬虫","description":"原理(流程)：基于[opentype.js](https://opentype.js.org/)从源字体中提取出特定的字符，按照一定的规则对字符的字形做出变换，输出一套新的字体\n\n变换规则：根据`strength`和`distance`调整`glyph.path.command`的坐标点\n\n基于[opentype.js](https://opentype.js.org)\n\n``` js\nimp","createDate":"2022-01-08 09:38:17","updateDate":"2022-01-08 18:05:37","body":"\u003cp\u003e原理(流程)：基于\u003ca href=\"https://opentype.js.org/\"\u003eopentype.js\u003c/a\u003e从源字体中提取出特定的字符，按照一定的规则对字符的字形做出变换，输出一套新的字体\u003c/p\u003e\n\u003cp\u003e变换规则：根据\u003ccode\u003estrength\u003c/code\u003e和\u003ccode\u003edistance\u003c/code\u003e调整\u003ccode\u003eglyph.path.command\u003c/code\u003e的坐标点\u003c/p\u003e\n\u003cp\u003e基于\u003ca href=\"https://opentype.js.org\"\u003eopentype.js\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e opentype \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;opentype.js\u0026#x27;\u003c/span\u003e; \n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { clone } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;ramda\u0026#x27;\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e fs \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;fs\u0026quot;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eChance\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;chance\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e snapX = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e snapY = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e snapDistance = \u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// 随机数生成器\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e chance = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eChance\u003c/span\u003e();\n\n\u003cspan class=\"hljs-comment\"\u003e// 调整path点\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esnap\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ev, distance, strength\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (v * (\u003cspan class=\"hljs-number\"\u003e1.0\u003c/span\u003e - strength)) + (strength * \u003cspan class=\"hljs-title class_\"\u003eMath\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eround\u003c/span\u003e(v / distance) * distance);\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// 对每个字符的字形做调整\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003edoSnap\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003esourcePath, options\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { snapStrength, snapDistance, snapPathCmdCnt } = options;\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e path = \u003cspan class=\"hljs-title function_\"\u003eclone\u003c/span\u003e(sourcePath);\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!path?.\u003cspan class=\"hljs-property\"\u003ecommands\u003c/span\u003e) \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e path;\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e cursorLeft = chance.\u003cspan class=\"hljs-title function_\"\u003einteger\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003emin\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003emax\u003c/span\u003e: path.\u003cspan class=\"hljs-property\"\u003ecommands\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elength\u003c/span\u003e - snapPathCmdCnt });\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e cursorRight = chance.\u003cspan class=\"hljs-title function_\"\u003einteger\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003emin\u003c/span\u003e: cursorLeft, \u003cspan class=\"hljs-attr\"\u003emax\u003c/span\u003e: cursorLeft + snapPathCmdCnt });\n\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e i = cursorLeft; i \u0026lt; cursorRight; i += \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e cmd = path?.\u003cspan class=\"hljs-property\"\u003ecommands\u003c/span\u003e?.[i];\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (cmd.\u003cspan class=\"hljs-property\"\u003etype\u003c/span\u003e !== \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Z\u0026#x27;\u003c/span\u003e) {\n            cmd.\u003cspan class=\"hljs-property\"\u003ex\u003c/span\u003e = \u003cspan class=\"hljs-title function_\"\u003esnap\u003c/span\u003e(cmd.\u003cspan class=\"hljs-property\"\u003ex\u003c/span\u003e + snapX, snapDistance, snapStrength) - snapX;\n            cmd.\u003cspan class=\"hljs-property\"\u003ey\u003c/span\u003e = \u003cspan class=\"hljs-title function_\"\u003esnap\u003c/span\u003e(cmd.\u003cspan class=\"hljs-property\"\u003ey\u003c/span\u003e + snapY, snapDistance, snapStrength) - snapY;\n        }\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (cmd.\u003cspan class=\"hljs-property\"\u003etype\u003c/span\u003e === \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Q\u0026#x27;\u003c/span\u003e || cmd.\u003cspan class=\"hljs-property\"\u003etype\u003c/span\u003e === \u003cspan class=\"hljs-string\"\u003e\u0026#x27;C\u0026#x27;\u003c/span\u003e) {\n            cmd.\u003cspan class=\"hljs-property\"\u003ex1\u003c/span\u003e = \u003cspan class=\"hljs-title function_\"\u003esnap\u003c/span\u003e(cmd.\u003cspan class=\"hljs-property\"\u003ex1\u003c/span\u003e + snapX, snapDistance, snapStrength) - snapX;\n            cmd.\u003cspan class=\"hljs-property\"\u003ey1\u003c/span\u003e = \u003cspan class=\"hljs-title function_\"\u003esnap\u003c/span\u003e(cmd.\u003cspan class=\"hljs-property\"\u003ey1\u003c/span\u003e + snapY, snapDistance, snapStrength) - snapY;\n        }\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (cmd.\u003cspan class=\"hljs-property\"\u003etype\u003c/span\u003e === \u003cspan class=\"hljs-string\"\u003e\u0026#x27;C\u0026#x27;\u003c/span\u003e) {\n            cmd.\u003cspan class=\"hljs-property\"\u003ex2\u003c/span\u003e = \u003cspan class=\"hljs-title function_\"\u003esnap\u003c/span\u003e(cmd.\u003cspan class=\"hljs-property\"\u003ex2\u003c/span\u003e + snapX, snapDistance, snapStrength) - snapX;\n            cmd.\u003cspan class=\"hljs-property\"\u003ey2\u003c/span\u003e = \u003cspan class=\"hljs-title function_\"\u003esnap\u003c/span\u003e(cmd.\u003cspan class=\"hljs-property\"\u003ey2\u003c/span\u003e + snapY, snapDistance, snapStrength) - snapY;\n        }\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e path;\n}\n\n\u003cspan class=\"hljs-comment\"\u003e/**\n * \u003cspan class=\"hljs-doctag\"\u003e@description\u003c/span\u003e: TTF变码，基于一种字体，生成另一种新字体\n * \u003cspan class=\"hljs-doctag\"\u003e@param\u003c/span\u003e {\u003cspan class=\"hljs-type\"\u003estring\u003c/span\u003e} sourceFontPath 源字体\n * \u003cspan class=\"hljs-doctag\"\u003e@param\u003c/span\u003e {\u003cspan class=\"hljs-type\"\u003estring\u003c/span\u003e} words 要转换的字\n * \u003cspan class=\"hljs-doctag\"\u003e@param\u003c/span\u003e {\u003cspan class=\"hljs-type\"\u003estring|Array\u0026lt;string\u0026gt;\u003c/span\u003e} newFontPath 转换后的字体\n * \u003cspan class=\"hljs-doctag\"\u003e@param\u003c/span\u003e {\u003cspan class=\"hljs-type\"\u003eSnapConfiguration\u003c/span\u003e} snapConfig 字形变化配置\n * \u003cspan class=\"hljs-doctag\"\u003e@return\u003c/span\u003e {\u003cspan class=\"hljs-type\"\u003eobject\u003c/span\u003e} 转换规则(映射表)\n */\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egenerateFont\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003esourceFontPath, words, newFontPath, snapConfig\u003c/span\u003e) {\n    \u003cspan class=\"hljs-comment\"\u003e// 保存字符和unicode的映射关系\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e result = {};\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e sourceFont = opentype.\u003cspan class=\"hljs-title function_\"\u003eloadSync\u003c/span\u003e(sourceFontPath);\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e notdefGlyph = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e opentype.\u003cspan class=\"hljs-title class_\"\u003eGlyph\u003c/span\u003e({\n        \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;.notdef\u0026#x27;\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003eadvanceWidth\u003c/span\u003e: sourceFont.\u003cspan class=\"hljs-title function_\"\u003egetAdvanceWidth\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;.\u0026#x27;\u003c/span\u003e),\n        \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e opentype.\u003cspan class=\"hljs-title class_\"\u003ePath\u003c/span\u003e(),\n    });\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e snapStrength = chance.\u003cspan class=\"hljs-title function_\"\u003einteger\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003emin\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003emax\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e });\n\n    \u003cspan class=\"hljs-comment\"\u003e// 生成新的字形\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// sourceFont.stringToGlyphs(words) 提取出要转换的字符的字形\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e subGlyphs = sourceFont.\u003cspan class=\"hljs-title function_\"\u003estringToGlyphs\u003c/span\u003e(words).\u003cspan class=\"hljs-title function_\"\u003emap\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eglyph, index\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e word = words[index];\n        \u003cspan class=\"hljs-comment\"\u003e// 针对反爬虫需求，每个字符需要生成新的unicode\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e unicode = chance.\u003cspan class=\"hljs-title function_\"\u003einteger\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003emin\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e255\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003emax\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e65536\u003c/span\u003e });\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { consistent, isSnap, snapPathCmdCnt } = snapConfig;\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e path = glyph.\u003cspan class=\"hljs-property\"\u003epath\u003c/span\u003e;\n        \n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (isSnap) {\n            \u003cspan class=\"hljs-comment\"\u003e// 每个字符共用一套字形变换配置or相互独立\u003c/span\u003e\n            \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e snapConfiguration = consistent\n                ?   {   \n                        snapDistance,\n                        snapStrength,\n                        snapPathCmdCnt,\n                    }\n                :   { \n                        snapPathCmdCnt,\n                        snapDistance,\n                        \u003cspan class=\"hljs-attr\"\u003esnapStrength\u003c/span\u003e: chance.\u003cspan class=\"hljs-title function_\"\u003einteger\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003emin\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003emax\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e10\u003c/span\u003e }),\n                    }\n            path = \u003cspan class=\"hljs-title function_\"\u003edoSnap\u003c/span\u003e(glyph.\u003cspan class=\"hljs-property\"\u003epath\u003c/span\u003e, snapConfiguration);\n        }\n        \n        \u003cspan class=\"hljs-comment\"\u003e// 保存映射关系\u003c/span\u003e\n        result[word] = \u003cspan class=\"hljs-string\"\u003e`\u0026amp;#x\u003cspan class=\"hljs-subst\"\u003e${\u003cspan class=\"hljs-built_in\"\u003eNumber\u003c/span\u003e(unicode).toString(\u003cspan class=\"hljs-number\"\u003e16\u003c/span\u003e)}\u003c/span\u003e;`\u003c/span\u003e;\n\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e opentype.\u003cspan class=\"hljs-title class_\"\u003eGlyph\u003c/span\u003e({\n            \u003cspan class=\"hljs-attr\"\u003eindex\u003c/span\u003e: index + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n            unicode,\n            \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: word,\n            path,\n            \u003cspan class=\"hljs-attr\"\u003eadvanceWidth\u003c/span\u003e: glyph.\u003cspan class=\"hljs-property\"\u003eadvanceWidth\u003c/span\u003e,\n        });\n    });\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { unitsPerEm, ascender, descender } = sourceFont;\n\n    \u003cspan class=\"hljs-comment\"\u003e// 生成新的字体文件\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e res = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e opentype.\u003cspan class=\"hljs-title class_\"\u003eFont\u003c/span\u003e({\n        \u003cspan class=\"hljs-attr\"\u003efamilyName\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;yqn-font\u0026#x27;\u003c/span\u003e,\n        \u003cspan class=\"hljs-attr\"\u003estyleName\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Medium\u0026#x27;\u003c/span\u003e,\n        unitsPerEm,\n        ascender,\n        descender,\n        \u003cspan class=\"hljs-attr\"\u003eglyphs\u003c/span\u003e: [notdefGlyph, ...subGlyphs],\n    });\n\n    \u003cspan class=\"hljs-comment\"\u003e// 可能需要保存多份字体文件（不同格式，做浏览器兼容）\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e outputPath = [newFontPath].\u003cspan class=\"hljs-title function_\"\u003eflat\u003c/span\u003e();\n    outputPath?.\u003cspan class=\"hljs-title function_\"\u003emap\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003epath\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n        res.\u003cspan class=\"hljs-title function_\"\u003edownload\u003c/span\u003e(path);\n    });\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e result;\n}\n\n\u003cspan class=\"hljs-comment\"\u003e// 输出映射关系到单独的文件中\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esaveRule\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003erule\u003c/span\u003e) {\n    fs.\u003cspan class=\"hljs-title function_\"\u003ewriteFileSync\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;rule.json\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-title class_\"\u003eJSON\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estringify\u003c/span\u003e(rule, \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e));\n}\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e { generateFont, saveRule };\n\u003c/code\u003e\u003c/pre\u003e\n"},{"title":"CSS学习-clip path","tags":["clip:path()"],"categories":"CSS","description":"## WHAT\n\n一个CSS属性\n\n使用裁剪方式创建元素的可显示区域。区域内的部分显示，区域外的隐藏\n\n起初是SVG里的，后挪用到CSS\n\n``` css\n/* Keyword values */\nclip-path: none;\n\n/* \u003cclip-source\u003e values */\nclip-path: url(resources.svg);\n\n/* \u003cbasic-shape\u003e value","createDate":"2021-12-30 13:52:25","updateDate":"2021-12-30 21:53:08","body":"\u003ch2 id=\"what\"\u003eWHAT\u003c/h2\u003e\n\u003cp\u003e一个CSS属性\u003c/p\u003e\n\u003cp\u003e使用裁剪方式创建元素的可显示区域。区域内的部分显示，区域外的隐藏\u003c/p\u003e\n\u003cp\u003e起初是SVG里的，后挪用到CSS\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-css\"\u003e\u003cspan class=\"hljs-comment\"\u003e/* Keyword values */\u003c/span\u003e\n\u003cspan class=\"hljs-attribute\"\u003eclip-path\u003c/span\u003e: none;\n\n\u003cspan class=\"hljs-comment\"\u003e/* \u0026lt;clip-source\u0026gt; values */\u003c/span\u003e\n\u003cspan class=\"hljs-attribute\"\u003eclip-path\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eurl\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003eresources.svg\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e/* \u0026lt;basic-shape\u0026gt; values */\u003c/span\u003e\n\u003cspan class=\"hljs-attribute\"\u003eclip-path\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003einset\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e100px\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e50px\u003c/span\u003e);\n\u003cspan class=\"hljs-attribute\"\u003eclip-path\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003ecircle\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e50px\u003c/span\u003e at \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e100px\u003c/span\u003e);\n\u003cspan class=\"hljs-attribute\"\u003eclip-path\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003epolygon\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e50%\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0%\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e50%\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e50%\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0%\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e50%\u003c/span\u003e);\n\u003cspan class=\"hljs-attribute\"\u003eclip-path\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003epath\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;M0.5,1 C0.5,1,0,0.7,0,0.3 A0.25,0.25,1,1,1,0.5,0.3 A0.25,0.25,1,1,1,1,0.3 C1,0.7,0.5,1,0.5,1 Z\u0026#x27;\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"why\"\u003eWHY\u003c/h2\u003e\n\u003cp\u003e方便创建一些不规则的图形，如切角、内切圆角、箭头等\u003c/p\u003e\n\u003ch2 id=\"how\"\u003eHOW\u003c/h2\u003e\n\u003cp\u003eDEMO使用\u003ccode\u003eclip-path: path()\u003c/code\u003e来创建\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003epath\u003c/code\u003e类似于svg的\u003ccode\u003epath\u003c/code\u003e标签，使用一系列 命令+参数 的序列来创建形状\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://mrrsblog.oss-cn-shanghai.aliyuncs.com/path.png\" alt=\"SVG-PATH\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://yqnn.github.io/svg-path-editor/\"\u003e可视化编辑\u003c/a\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-html\"\u003e\u003cspan class=\"hljs-meta\"\u003e\u0026lt;!DOCTYPE \u003cspan class=\"hljs-keyword\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elang\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;en\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003echarset\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;UTF-8\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehttp-equiv\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;X-UA-Compatible\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;IE=edge\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;viewport\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;width=device-width, initial-scale=1.0\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003eDocument\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003estyle\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"language-css\"\u003e\n    \u003cspan class=\"hljs-selector-class\"\u003e.img\u003c/span\u003e {\n      \u003cspan class=\"hljs-attribute\"\u003eheight\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e140px\u003c/span\u003e;\n      \u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e280px\u003c/span\u003e;\n      \u003cspan class=\"hljs-attribute\"\u003ebackground\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003elinear-gradient\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e90deg\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e#be0f2d\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e#cb364a\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e#f5abb7\u003c/span\u003e);\n    }\n\n    \u003cspan class=\"hljs-selector-class\"\u003e.popover\u003c/span\u003e {\n      \u003cspan class=\"hljs-attribute\"\u003eclip-path\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003epolygon\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0%\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0%\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e0%\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e75%\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e75%\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e75%\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e50%\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e100%\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e25%\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e75%\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e0%\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e75%\u003c/span\u003e);\n    }\n\n    \u003cspan class=\"hljs-selector-class\"\u003e.message\u003c/span\u003e {\n      \u003cspan class=\"hljs-attribute\"\u003eclip-path\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003epath\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;M 20 0 L 260 0 A 20 20 90 0 1 280 20 L 280 100 A 20 20 90 0 1 260 120 L 220 120 L 240 140 L 180 120 L 20 120 A 20 20 90 0 1 0 100 L 0 20 A 20 20 90 0 1 20 0\u0026#x27;\u003c/span\u003e);\n    }\n\n    \u003cspan class=\"hljs-selector-class\"\u003e.coupon\u003c/span\u003e {\n      \u003cspan class=\"hljs-attribute\"\u003eclip-path\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003epath\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;M 20 0 L 260 0 A 20 20 0 0 0 280 20 L 280 120 A 20 20 0 0 0 260 140 L 20 140 A 20 20 0 0 0 0 120 L 0 20 A 20 20 0 0 0 20 0\u0026#x27;\u003c/span\u003e);\n    }\n\n    \u003cspan class=\"hljs-selector-class\"\u003e.notching\u003c/span\u003e {\n      \u003cspan class=\"hljs-attribute\"\u003eclip-path\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003epath\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;M 40 0 L 280 0 L 280 100 L 240 140 L 0 140 L 0 40 L 40 0\u0026#x27;\u003c/span\u003e);\n    }\n\n    \u003cspan class=\"hljs-selector-class\"\u003e.outside-circle\u003c/span\u003e {\n      \u003cspan class=\"hljs-attribute\"\u003eclip-path\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003epath\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;M 40 0 L 240 0 A 20 20 90 0 1 260 20 L 260 120 A 20 20 90 0 0 280 140 L 0 140 A 20 20 90 0 0 20 120 L 20 20 A 20 20 90 0 1 40 0\u0026#x27;\u003c/span\u003e);\n    }\n  \u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003estyle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;https://bennettfeely.com/clippy/pics/pittsburgh.jpg\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ealt\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;img popover\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrcset\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebr\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebr\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;https://bennettfeely.com/clippy/pics/pittsburgh.jpg\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ealt\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;img message\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrcset\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebr\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebr\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;https://bennettfeely.com/clippy/pics/pittsburgh.jpg\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ealt\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;img coupon\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrcset\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebr\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebr\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;https://bennettfeely.com/clippy/pics/pittsburgh.jpg\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ealt\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;img notching\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrcset\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebr\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebr\u003c/span\u003e /\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;https://bennettfeely.com/clippy/pics/pittsburgh.jpg\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ealt\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eclass\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;img outside-circle\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrcset\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"https://mrrsblog.oss-cn-shanghai.aliyuncs.com/clip-path.png\" alt=\"clip-path\"\u003e\u003c/p\u003e\n"},{"title":"React.js学习-hooks原理简析","tags":["hooks"],"categories":"React.js","description":"让我们从实现两个简单的hook入手来探究hooks原理\n\n\u003e [示例代码](https://github.com/mrrs878/review)\n\n## useState\n\n`useState`用于在函数式组件中声明并保存一个变量，`useState`的使用是这样的：\n\n``` ts\nconst [count, setCount] = useState(0);\n\nconsole.log(cou","createDate":"2021-12-23 11:25:20","updateDate":"2021-12-23 21:56:54","body":"\u003cp\u003e让我们从实现两个简单的hook入手来探究hooks原理\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/mrrs878/review\"\u003e示例代码\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"usestate\"\u003euseState\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003euseState\u003c/code\u003e用于在函数式组件中声明并保存一个变量，\u003ccode\u003euseState\u003c/code\u003e的使用是这样的：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [count, setCount] = \u003cspan class=\"hljs-title function_\"\u003euseState\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n\n\u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(count);\n\n\u003cspan class=\"hljs-title function_\"\u003esetCount\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n\n\u003cspan class=\"hljs-title function_\"\u003esetCount\u003c/span\u003e((pre) + pre + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e有几个特点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e接受一个函数或值作为变量的初始值\u003c/li\u003e\n\u003cli\u003e返回一个数组(元组)，第一个参数是变量值，第二个参数是一个函数，可用来更新变量值\u003c/li\u003e\n\u003cli\u003e返回的更新函数支持传入一个函数，改函数的参数是当前的变量值\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e据此，可以实现一版简单的\u003ccode\u003euseState\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003euseState\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003einitialState\u003c/span\u003e) {\n    \u003cspan class=\"hljs-comment\"\u003e// 没有考虑传入一个函数的情况\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e state = initialState;\n    \n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esetState\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003enewState\u003c/span\u003e) =\u0026gt; {\n        state = newState;\n    }\n    \n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e [state, setState];\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e但在使用的时候会发现，当调用\u003ccode\u003esetCount\u003c/code\u003e的时候，\u003ccode\u003ecount\u003c/code\u003e 并不会变化，这是因为我们没有存储\u003ccode\u003estate\u003c/code\u003e，导致每次渲染组件的时候，\u003ccode\u003estate\u003c/code\u003e都会重新设置\u003c/p\u003e\n\u003cp\u003e为解决这个问题，会自然而然地想到，把\u003ccode\u003estate\u003c/code\u003e提取出来，存在\u003ccode\u003euseState\u003c/code\u003e外面：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e _state;\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003euseState\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003einitialState\u003c/span\u003e) {\n  _state = _state || initialState;\n\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esetState\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003enewState\u003c/span\u003e) =\u0026gt; {\n    _state = \u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e newState === \u003cspan class=\"hljs-string\"\u003e\u0026#x27;function\u0026#x27;\u003c/span\u003e ? \u003cspan class=\"hljs-title function_\"\u003enewState\u003c/span\u003e(_state) : newState;\n  };\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e [\n    _state,\n    setState,\n  ];\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e测试用例\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { renderHook, act } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;@testing-library/react-hooks\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { useState } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;./useState_simple\u0026#x27;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-title function_\"\u003edescribe\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;useState_simple\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003eit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;useState should be defined\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(useState).\u003cspan class=\"hljs-title function_\"\u003etoBeDefined\u003c/span\u003e();\n  });\n\n  \u003cspan class=\"hljs-title function_\"\u003eit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;When the update function is called, the data is updated normally\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { result, rerender } = \u003cspan class=\"hljs-title function_\"\u003erenderHook\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003euseState\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e));\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [, setState] = result.\u003cspan class=\"hljs-property\"\u003ecurrent\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-title function_\"\u003eact\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n      \u003cspan class=\"hljs-title function_\"\u003esetState\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e);\n      \u003cspan class=\"hljs-title function_\"\u003ererender\u003c/span\u003e();\n    });\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [state] = result.\u003cspan class=\"hljs-property\"\u003ecurrent\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(state).\u003cspan class=\"hljs-title function_\"\u003etoBe\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e);\n  });\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e至此，实现了一个简单的\u003ccode\u003euseState\u003c/code\u003e，后边会进一步完善\u003c/p\u003e\n\u003ch2 id=\"useeffect\"\u003euseEffect\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003euseEffect\u003c/code\u003e的使用是这样的\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-title function_\"\u003euseEffect\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// do something\u003c/span\u003e\n});\n\n\u003cspan class=\"hljs-title function_\"\u003euseEffect\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// do something\u003c/span\u003e\n}, [])\n\n\u003cspan class=\"hljs-title function_\"\u003euseEffect\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-comment\"\u003e// do something\u003c/span\u003e\n}, [deps])\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003euseEffect\u003c/code\u003e的使用有几个特点：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e有两个参数\u003ccode\u003ecallback\u003c/code\u003e和\u003ccode\u003edeps\u003c/code\u003e数组\u003c/li\u003e\n\u003cli\u003e如果\u003ccode\u003edeps\u003c/code\u003e不存在，那么\u003ccode\u003ecallback\u003c/code\u003e在每次\u003ccode\u003erender\u003c/code\u003e时都会执行\u003c/li\u003e\n\u003cli\u003e如果\u003ccode\u003edeps\u003c/code\u003e存在，只有当它发生了变化，\u003ccode\u003ecallback\u003c/code\u003e才会执行\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e根据使用方法和特点，可以做一个简单地实现：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-tsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e _deps;\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003euseEffect\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecallback, deps\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e hasNoDeps = !deps;\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e hasChangeDeps = _deps\n    ? !deps?.\u003cspan class=\"hljs-title function_\"\u003eevery\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003edep, index\u003c/span\u003e) =\u0026gt;\u003c/span\u003e _deps[index] === dep)\n    : \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (hasNoDeps || hasChangeDeps) {\n    \u003cspan class=\"hljs-title function_\"\u003ecallback\u003c/span\u003e();\n    _deps = deps;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e测试用例\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { renderHook, act } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;@testing-library/react-hooks\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { useEffect } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;./useEffect_simple\u0026#x27;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-title function_\"\u003edescribe\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;useEffect_simple\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003eit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;useEffect should be defined\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(useEffect).\u003cspan class=\"hljs-title function_\"\u003etoBeDefined\u003c/span\u003e();\n  });\n\n  \u003cspan class=\"hljs-title function_\"\u003eit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;When deps is empty, every rendering callback should be executed\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e callback = jest.\u003cspan class=\"hljs-title function_\"\u003efn\u003c/span\u003e();\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { rerender } = \u003cspan class=\"hljs-title function_\"\u003erenderHook\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003euseEffect\u003c/span\u003e(callback));\n\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(callback).\u003cspan class=\"hljs-title function_\"\u003etoBeCalledTimes\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-title function_\"\u003eact\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n      \u003cspan class=\"hljs-title function_\"\u003ererender\u003c/span\u003e();\n    });\n\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(callback).\u003cspan class=\"hljs-title function_\"\u003etoBeCalledTimes\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e);\n  });\n\n  \u003cspan class=\"hljs-title function_\"\u003eit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;When deps is an empty array, render multiple times but callback should only be called once\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e callback = jest.\u003cspan class=\"hljs-title function_\"\u003efn\u003c/span\u003e();\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { rerender } = \u003cspan class=\"hljs-title function_\"\u003erenderHook\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003euseEffect\u003c/span\u003e(callback, []));\n\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(callback).\u003cspan class=\"hljs-title function_\"\u003etoBeCalledTimes\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-title function_\"\u003eact\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n      \u003cspan class=\"hljs-title function_\"\u003ererender\u003c/span\u003e();\n    });\n\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(callback).\u003cspan class=\"hljs-title function_\"\u003etoBeCalledTimes\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n  });\n\n  \u003cspan class=\"hljs-title function_\"\u003eit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;When deps is changed, callback should be called\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e callback = jest.\u003cspan class=\"hljs-title function_\"\u003efn\u003c/span\u003e();\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { rerender } = \u003cspan class=\"hljs-title function_\"\u003erenderHook\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003e{ name }\u003c/span\u003e) =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003euseEffect\u003c/span\u003e(callback, [name]), {\n      \u003cspan class=\"hljs-attr\"\u003einitialProps\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;tom\u0026#x27;\u003c/span\u003e,\n      },\n    });\n\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(callback).\u003cspan class=\"hljs-title function_\"\u003etoBeCalledTimes\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-title function_\"\u003eact\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n      \u003cspan class=\"hljs-title function_\"\u003ererender\u003c/span\u003e({\n        \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;jerry\u0026#x27;\u003c/span\u003e,\n      });\n    });\n\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(callback).\u003cspan class=\"hljs-title function_\"\u003etoBeCalledTimes\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e);\n  });\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e到这里，我们又实现了一个可以工作的丐版\u003ccode\u003euseEffect\u003c/code\u003e，hook貌似没有那么难\u003c/p\u003e\n\u003ch2 id=\"优化\"\u003e优化\u003c/h2\u003e\n\u003cp\u003e我们上边实现的两个简单的hook存在一个致命缺点，在一个组件内只能使用一次，对此，我们可以将\u003ccode\u003e_state\u003c/code\u003e和\u003ccode\u003e_deps\u003c/code\u003e保存至一个全局数组\u003ccode\u003ememoizedState \u003c/code\u003e中，并用一个变量存储当前\u003ccode\u003ememoizedState\u003c/code\u003e下标\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e memoizedStates = []; \u003cspan class=\"hljs-comment\"\u003e// hooks存放在这个数组\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e cursor = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e; \u003cspan class=\"hljs-comment\"\u003e// 当前memoizedState下标\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003euseState\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003einitialState\u003c/span\u003e) {\n  memoizedStates[cursor] = memoizedStates[cursor] || initialState;\n\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e currentCursor = cursor;\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003esetState\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003enewState\u003c/span\u003e) =\u0026gt; {\n    memoizedStates[currentCursor] = \u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e newState === \u003cspan class=\"hljs-string\"\u003e\u0026#x27;function\u0026#x27;\u003c/span\u003e\n      ? \u003cspan class=\"hljs-title function_\"\u003enewState\u003c/span\u003e(memoizedStates[currentCursor])\n      : newState;\n  };\n\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e res = [memoizedStates[cursor], setState];\n  cursor += \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e res;\n}\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003euseEffect\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecallback, deps\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e hasNoDeps = deps === \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e;\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e preDeps = memoizedStates[cursor];\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e hasChangedDeps = preDeps\n    ? !deps.\u003cspan class=\"hljs-title function_\"\u003eevery\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003edep, index\u003c/span\u003e) =\u0026gt;\u003c/span\u003e dep === preDeps[index])\n    : \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (hasNoDeps || hasChangedDeps) {\n    \u003cspan class=\"hljs-title function_\"\u003ecallback\u003c/span\u003e();\n    memoizedStates[cursor] = deps;\n  }\n\n  cursor += \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n}\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eresetCursor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  cursor = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n}\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eresetMemoizedStates\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  memoizedStates = [];\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eNot Magic, just Arrays\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e测试用例\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { act, renderHook } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;@testing-library/react-hooks\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e {\n  resetCursor, useEffect, useState, resetMemoizedStates,\n} \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;./useState_useEffect\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-title function_\"\u003edescribe\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;useState_simple\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003eit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;useState should be defined\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(useState).\u003cspan class=\"hljs-title function_\"\u003etoBeDefined\u003c/span\u003e();\n  });\n\n  \u003cspan class=\"hljs-title function_\"\u003eit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;When the update function is called, the data is updated normally\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eusePeople\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) =\u0026gt; {\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [age, setAge] = \u003cspan class=\"hljs-title function_\"\u003euseState\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [name, setName] = \u003cspan class=\"hljs-title function_\"\u003euseState\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;tom\u0026#x27;\u003c/span\u003e);\n\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e [age, setAge, name, setName];\n    };\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { result, rerender } = \u003cspan class=\"hljs-title function_\"\u003erenderHook\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eusePeople\u003c/span\u003e());\n\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(result.\u003cspan class=\"hljs-property\"\u003ecurrent\u003c/span\u003e[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]).\u003cspan class=\"hljs-title function_\"\u003etoBe\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(result.\u003cspan class=\"hljs-property\"\u003ecurrent\u003c/span\u003e[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e]).\u003cspan class=\"hljs-title function_\"\u003etoBe\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;tom\u0026#x27;\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-title function_\"\u003eact\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n      result.\u003cspan class=\"hljs-property\"\u003ecurrent\u003c/span\u003e[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e](\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003epre\u003c/span\u003e) =\u0026gt;\u003c/span\u003e pre + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n      \u003cspan class=\"hljs-title function_\"\u003eresetCursor\u003c/span\u003e();\n      \u003cspan class=\"hljs-title function_\"\u003ererender\u003c/span\u003e();\n    });\n\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(result.\u003cspan class=\"hljs-property\"\u003ecurrent\u003c/span\u003e[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]).\u003cspan class=\"hljs-title function_\"\u003etoBe\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e);\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(result.\u003cspan class=\"hljs-property\"\u003ecurrent\u003c/span\u003e[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e]).\u003cspan class=\"hljs-title function_\"\u003etoBe\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;tom\u0026#x27;\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-title function_\"\u003eact\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n      result.\u003cspan class=\"hljs-property\"\u003ecurrent\u003c/span\u003e[\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e](\u003cspan class=\"hljs-string\"\u003e\u0026#x27;tom\u0026amp;jerry\u0026#x27;\u003c/span\u003e);\n      \u003cspan class=\"hljs-title function_\"\u003eresetCursor\u003c/span\u003e();\n      \u003cspan class=\"hljs-title function_\"\u003ererender\u003c/span\u003e();\n    });\n\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(result.\u003cspan class=\"hljs-property\"\u003ecurrent\u003c/span\u003e[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e]).\u003cspan class=\"hljs-title function_\"\u003etoBe\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e);\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(result.\u003cspan class=\"hljs-property\"\u003ecurrent\u003c/span\u003e[\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e]).\u003cspan class=\"hljs-title function_\"\u003etoBe\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;tom\u0026amp;jerry\u0026#x27;\u003c/span\u003e);\n  });\n});\n\n\u003cspan class=\"hljs-title function_\"\u003edescribe\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;useEffect_simple\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-title function_\"\u003ebeforeEach\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-title function_\"\u003eresetCursor\u003c/span\u003e();\n    \u003cspan class=\"hljs-title function_\"\u003eresetMemoizedStates\u003c/span\u003e();\n  });\n\n  \u003cspan class=\"hljs-title function_\"\u003eit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;useEffect should be defined\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(useEffect).\u003cspan class=\"hljs-title function_\"\u003etoBeDefined\u003c/span\u003e();\n  });\n\n  \u003cspan class=\"hljs-title function_\"\u003eit\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Different DEPs, Callback calls should also be differentcalls should also be different\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e callbackWithNoDeps = jest.\u003cspan class=\"hljs-title function_\"\u003efn\u003c/span\u003e();\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e callbackWithEmptyDeps = jest.\u003cspan class=\"hljs-title function_\"\u003efn\u003c/span\u003e();\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e callbackWithChangingDeps = jest.\u003cspan class=\"hljs-title function_\"\u003efn\u003c/span\u003e();\n\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e name = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;tom\u0026#x27;\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003euseProple\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) =\u0026gt; {\n      \u003cspan class=\"hljs-title function_\"\u003euseEffect\u003c/span\u003e(callbackWithNoDeps);\n      \u003cspan class=\"hljs-title function_\"\u003euseEffect\u003c/span\u003e(callbackWithEmptyDeps, []);\n      \u003cspan class=\"hljs-title function_\"\u003euseEffect\u003c/span\u003e(callbackWithChangingDeps, [name]);\n    };\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { rerender } = \u003cspan class=\"hljs-title function_\"\u003erenderHook\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003euseProple\u003c/span\u003e());\n\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(callbackWithNoDeps).\u003cspan class=\"hljs-title function_\"\u003etoBeCalledTimes\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(callbackWithEmptyDeps).\u003cspan class=\"hljs-title function_\"\u003etoBeCalledTimes\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(callbackWithChangingDeps).\u003cspan class=\"hljs-title function_\"\u003etoBeCalledTimes\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-title function_\"\u003eact\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n      name = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;tom\u0026amp;jerry\u0026#x27;\u003c/span\u003e;\n      \u003cspan class=\"hljs-title function_\"\u003eresetCursor\u003c/span\u003e();\n      \u003cspan class=\"hljs-title function_\"\u003ererender\u003c/span\u003e();\n    });\n\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(callbackWithNoDeps).\u003cspan class=\"hljs-title function_\"\u003etoBeCalledTimes\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e);\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(callbackWithEmptyDeps).\u003cspan class=\"hljs-title function_\"\u003etoBeCalledTimes\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(callbackWithChangingDeps).\u003cspan class=\"hljs-title function_\"\u003etoBeCalledTimes\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-title function_\"\u003eact\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n      \u003cspan class=\"hljs-title function_\"\u003eresetCursor\u003c/span\u003e();\n      \u003cspan class=\"hljs-title function_\"\u003ererender\u003c/span\u003e();\n    });\n\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(callbackWithNoDeps).\u003cspan class=\"hljs-title function_\"\u003etoBeCalledTimes\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e);\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(callbackWithEmptyDeps).\u003cspan class=\"hljs-title function_\"\u003etoBeCalledTimes\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n    \u003cspan class=\"hljs-title function_\"\u003eexpect\u003c/span\u003e(callbackWithChangingDeps).\u003cspan class=\"hljs-title function_\"\u003etoBeCalledTimes\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e);\n  });\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"真正的react实现\"\u003e真正的React实现\u003c/h2\u003e\n\u003cp\u003e虽然我们用数组基本实现了一个可用的Hooks，了解了Hooks的原理，但在React中，实现方式却有一些差异的。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eReact中是通过类似单链表的形式来代替数组的。通过\u003ccode\u003enext\u003c/code\u003e按顺序串联所有的\u003ccode\u003ehook\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ememoizedState\u003c/code\u003e，\u003ccode\u003ecursor\u003c/code\u003e是存在哪里的？如何和每个函数组件一一对应的？\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e我们知道，React会生成一棵组件树（或Fiber单链表），树中每个节点对应了一个组件，hooks的数据就作为组件的一个信息，存储在这些节点上，\u003cstrong\u003e伴随组件一起出生，一起死亡\u003c/strong\u003e。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eHooks\u003c/span\u003e = {\n    \u003cspan class=\"hljs-comment\"\u003e// others\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ememoizedState\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003eany\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// useState中 保存 state 信息 ｜ useEffect 中 保存着 effect 对象 ｜ useMemo 中 保存的是缓存的值和 deps ｜ useRef 中保存的是 ref 对象\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003enext\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eHook\u003c/span\u003e | \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// link 到下一个 hooks，通过 next 串联每一个hooks\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"解惑\"\u003e解惑\u003c/h2\u003e\n\u003cp\u003eQ. 为什么只能在函数最外层调用Hook，不要在循环、条件判断或者子函数中调用？\u003c/p\u003e\n\u003cp\u003eA. \u003ccode\u003ememoizedState\u003c/code\u003e是按hook定义的顺序来放置数据的，如果hook顺序变化，\u003ccode\u003ememoizedState\u003c/code\u003e并不会感知到\u003c/p\u003e\n\u003cp\u003eQ. 为什么\u003ccode\u003euseEffect\u003c/code\u003e第二个参数是空数组，在组件更新时回调只会执行一次？\u003c/p\u003e\n\u003cp\u003eA. 因为依赖一直不变化，\u003ccode\u003ecallback\u003c/code\u003e不会二次执行\u003c/p\u003e\n\u003cp\u003eQ. 自定义的Hook是如何影响使用它的函数组件的？\u003c/p\u003e\n\u003cp\u003eA. 共享同一个\u003ccode\u003ememoizedState\u003c/code\u003e，共享同一个顺序\u003c/p\u003e\n\u003cp\u003eQ. Capture Value 特性是如何产生的？\u003c/p\u003e\n\u003cp\u003eA. 每一次\u003ccode\u003ererender\u003c/code\u003e的时候，都是重新去执行函数组件了，对于之前已经执行过的函数组件，并不会做任何操作。即\u003cstrong\u003e每次渲染（执行），都有它自己的xxx\u003c/strong\u003e\u003c/p\u003e\n"},{"title":"SVG学习-stroke-dashoffset和stroke-dasharray","tags":["SVG"],"categories":"前端架构\u0026软实力","description":"## 起因\n\n周末玩游戏的时候发现游戏内有一个按钮的交互挺有趣，类似于这种效果\n\n![button-svg](https://mrrsblog.oss-cn-shanghai.aliyuncs.com/button-svg.gif)\n\n点击后边框有一个进度条，鼠标长按进度会增加，抬起后回到起始位置\n\n咦，有点意思\n\n![因垂斯汀](https://mrrsblog.oss-cn-shangha","createDate":"2021-11-24 13:35:30","updateDate":"2021-11-25 21:54:36","body":"\u003ch2 id=\"起因\"\u003e起因\u003c/h2\u003e\n\u003cp\u003e周末玩游戏的时候发现游戏内有一个按钮的交互挺有趣，类似于这种效果\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://mrrsblog.oss-cn-shanghai.aliyuncs.com/button-svg.gif\" alt=\"button-svg\"\u003e\u003c/p\u003e\n\u003cp\u003e点击后边框有一个进度条，鼠标长按进度会增加，抬起后回到起始位置\u003c/p\u003e\n\u003cp\u003e咦，有点意思\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://mrrsblog.oss-cn-shanghai.aliyuncs.com/interesting.gif\" alt=\"因垂斯汀\"\u003e\u003c/p\u003e\n\u003cp\u003e于是就想着能不能使用前端的一些技术实现🤔\u003c/p\u003e\n\u003cp\u003e于是开始一系列的尝试（此处省略若干字），发现触及到知识盲区了😭，根本无从下手\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://mrrsblog.oss-cn-shanghai.aliyuncs.com/interesting2.png\" alt=\"知识盲区\"\u003e\u003c/p\u003e\n\u003ch2 id=\"转机\"\u003e转机\u003c/h2\u003e\n\u003cp\u003e突然不知道怎么就想到SVG了，想着要不试试？没准能行，然后一顿搜索，眼前一亮\u003c/p\u003e\n\u003cp\u003e有大佬使用\u003ccode\u003estroke\u003c/code\u003e和\u003ccode\u003estroke-dashoffset\u003c/code\u003e及\u003ccode\u003estroke-dasharray\u003c/code\u003e做出进度条，同时又想到SVG可以和JavaScript交互，貌似可以实现我的需求\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://mrrsblog.oss-cn-shanghai.aliyuncs.com/interesting3.png\" alt=\"奇怪的知识增加了\"\u003e\u003c/p\u003e\n\u003ch2 id=\"stork-dashoffset和stork-dasharray\"\u003estork-dashoffset和stork-dasharray\u003c/h2\u003e\n\u003cp\u003e那么\u003ccode\u003estroke\u003c/code\u003e和\u003ccode\u003estroke-dashoffset\u003c/code\u003e以及\u003ccode\u003estroke-dasharray\u003c/code\u003e是何方神圣腻？🤔\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003estroke\u003c/code\u003e: 描边，接受一个颜色值。可作用于大部分SVG元素\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003estroke-dasharray\u003c/code\u003e: 用于创建虚线描边\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// 表示：虚线长10，间距10，然后重复 虚线长10，间距10\u003c/span\u003e\nstroke-dasharray = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;10\u0026#x27;\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// 表示：虚线长10，间距5，然后重复 虚线长10，间距5\u003c/span\u003e\nstroke-dasharray = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;10, 5\u0026#x27;\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e// 当然还有更复杂的设置这里就不细讲了\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003estroke-dashoffset\u003c/code\u003e：字如其意，表示stroke的偏移。这个属性是相对于起始点的偏移，\u003cstrong\u003e正数\u003c/strong\u003e偏移x值的时候，相当于往\u003cstrong\u003e左\u003c/strong\u003e移动了x个长度单位，\u003cstrong\u003e负数\u003c/strong\u003e偏移x的时候，相当于往\u003cstrong\u003e右\u003c/strong\u003e移动了x个长度单位\u003c/p\u003e\n\u003cp\u003e需要注意的是，不管偏移的方向是哪边，要记得dasharray 是循环的，也就是 虚线-间隔-虚线-间隔。\n\u003ccode\u003estroke-dashoffset\u003c/code\u003e要搭配\u003ccode\u003estroke-dasharray\u003c/code\u003e才能看得出来效果，非虚线的话，是无法看出偏移的。\u003c/p\u003e\n\u003cp\u003e概念有点抽象，来看一个MDN的例子，图中红线段是偏移的距离\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://mrrsblog.oss-cn-shanghai.aliyuncs.com/stroke-dashoffset.png\" alt=\"stroke-dashoffset\"\u003e\u003c/p\u003e\n\u003cp\u003e上图效果分别是：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e没有虚线\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003estroke-dasharray=\u0026quot;3 1\u0026quot;\u003c/code\u003e ，虚线没有设置偏移，也就是stroke-dashoffset值为0\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003estroke-dashoffset=\u0026quot;3\u0026quot;\u003c/code\u003e，偏移正数，虚线整体左移了3个单位，图中3后面的红线段，就是起始线段，线段之后是1个单位的间隔，我们可见区域从这个间隔开始，然后循环 3-1,3-1的虚线-间隔-虚线-间隔\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003estroke-dashoffset=\u0026quot;-3\u0026quot;\u003c/code\u003e，偏移负数，虚线整体右移动了3个单位，由于dasharray 是循环的，前面偏移的位置会有dasharray 填充上\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003estroke-dashoffset=\u0026quot;1\u0026quot;\u003c/code\u003e，偏移正数，虚线整体左移了1个单位，最终呈现出来的效果跟 线段4 一样\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cstrong\u003e利用这两个属性，我们可以做出好看的动画效果\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cp\u003e设置\u003ccode\u003estroke-dasharray\u003c/code\u003e为\u003cem\u003e图形边长\u003c/em\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e设置\u003ccode\u003estroke-dashoffset\u003c/code\u003e为\u003cem\u003e图形边长\u003c/em\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e动态减少\u003ccode\u003estroke-dashoffset\u003c/code\u003e到0\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e简析：第一步后就有一个长度为图形边长的\u003cem\u003e长条\u003c/em\u003e，第二步由于设置了\u003ccode\u003estroke-dashoffset\u003c/code\u003e也为图形边长，因此\u003cem\u003e长条\u003c/em\u003e会被推到不可见的位置，再通过第三步中动态减少\u003ccode\u003estroke-dashoffset\u003c/code\u003e，第一步中绘制的\u003cem\u003e长条\u003c/em\u003e就会慢慢\u003cem\u003e增长\u003c/em\u003e并显示出来\u003c/p\u003e\n\u003ch2 id=\"再次挑战\"\u003e再次挑战\u003c/h2\u003e\n\u003cp\u003e刚开始是想使用\u003ccode\u003erect\u003c/code\u003e来做的，但发现游戏中的按钮是有一定的圆角的，\u003ccode\u003erect\u003c/code\u003e在设置圆角之后再添加\u003ccode\u003estorke\u003c/code\u003e有点丑，遂放弃，改用\u003ccode\u003epath\u003c/code\u003e实现\u003c/p\u003e\n\u003cp\u003e观察原图，实现思路如下：\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cp\u003e边框可以使用\u003ccode\u003epath\u003c/code\u003e绘制出来\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e边框背景也使用\u003ccode\u003epath\u003c/code\u003e绘制（同一套\u003ccode\u003ed\u003c/code\u003e属性），设置一下\u003ccode\u003eopacity\u003c/code\u003e即可\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e背景色使用SVG的\u003ccode\u003efill\u003c/code\u003e填充出来\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e文字使用\u003ccode\u003etext\u003c/code\u003e绘制\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e实现代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-html\"\u003e\u003cspan class=\"hljs-meta\"\u003e\u0026lt;!DOCTYPE \u003cspan class=\"hljs-keyword\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003elang\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;en\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003echarset\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;UTF-8\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ehttp-equiv\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;X-UA-Compatible\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;IE=edge\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;viewport\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003econtent\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;width=device-width, initial-scale=1.0\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003eSVG\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003estyle\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"language-css\"\u003e\n        \u003cspan class=\"hljs-selector-id\"\u003e#svg\u003c/span\u003e\u003cspan class=\"hljs-selector-pseudo\"\u003e:active\u003c/span\u003e {\n            \u003cspan class=\"hljs-attribute\"\u003eopacity\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0.9\u003c/span\u003e;\n        }\n        \u003cspan class=\"hljs-selector-id\"\u003e#path\u003c/span\u003e, \u003cspan class=\"hljs-selector-id\"\u003e#background\u003c/span\u003e {\n            stroke-\u003cspan class=\"hljs-attribute\"\u003ewidth\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e;\n            stroke: \u003cspan class=\"hljs-number\"\u003e#f00\u003c/span\u003e;\n            \u003cspan class=\"hljs-attribute\"\u003ecursor\u003c/span\u003e: pointer;\n            \n            \u003cspan class=\"hljs-comment\"\u003e/** \n             * 修正位置，设置水平垂直居中\n             */\u003c/span\u003e\n            \u003cspan class=\"hljs-attribute\"\u003etransform\u003c/span\u003e: \u003cspan class=\"hljs-built_in\"\u003etranslate\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e5px\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e5px\u003c/span\u003e);\n        }\n        \u003cspan class=\"hljs-selector-id\"\u003e#background\u003c/span\u003e {\n            \u003cspan class=\"hljs-attribute\"\u003eopacity\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e0.2\u003c/span\u003e;\n        }\n        \u003cspan class=\"hljs-selector-id\"\u003e#text\u003c/span\u003e {\n            user-select: none;\n            \u003cspan class=\"hljs-attribute\"\u003ecursor\u003c/span\u003e: pointer;\n            fill: \u003cspan class=\"hljs-number\"\u003e#000\u003c/span\u003e;\n            \n            \u003cspan class=\"hljs-comment\"\u003e/** \n             * 设置水平垂直居中\n             */\u003c/span\u003e\n            dominant-baseline: middle;\n            text-anchor: middle;\n        }\n    \u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003estyle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"language-javascript\"\u003e\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e rafId = -\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eWIDTH\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e70\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eHEIGHT\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eRADIUS\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e6\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eDEFAULT_OFFSET\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e15\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eSTORK_LENGTH\u003c/span\u003e = (\u003cspan class=\"hljs-variable constant_\"\u003eWIDTH\u003c/span\u003e + \u003cspan class=\"hljs-variable constant_\"\u003eHEIGHT\u003c/span\u003e) \u0026lt;\u0026lt; \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eSTEP\u003c/span\u003e = \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e;\n\n        \u003cspan class=\"hljs-comment\"\u003e/**\n         * \u003cspan class=\"hljs-doctag\"\u003e@description\u003c/span\u003e: 生成带有圆角的path\n         */\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eroundedRect\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ew, h, tlr, trr, brr, blr\u003c/span\u003e) {\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e`M 0 \u003cspan class=\"hljs-subst\"\u003e${tlr}\u003c/span\u003e A \u003cspan class=\"hljs-subst\"\u003e${tlr}\u003c/span\u003e \u003cspan class=\"hljs-subst\"\u003e${tlr}\u003c/span\u003e 0 0 1 \u003cspan class=\"hljs-subst\"\u003e${tlr}\u003c/span\u003e 0 L \u003cspan class=\"hljs-subst\"\u003e${w - trr}\u003c/span\u003e 0 `\u003c/span\u003e\n                + \u003cspan class=\"hljs-string\"\u003e`A \u003cspan class=\"hljs-subst\"\u003e${trr}\u003c/span\u003e \u003cspan class=\"hljs-subst\"\u003e${trr}\u003c/span\u003e 0 0 1 \u003cspan class=\"hljs-subst\"\u003e${w}\u003c/span\u003e \u003cspan class=\"hljs-subst\"\u003e${trr}\u003c/span\u003e L \u003cspan class=\"hljs-subst\"\u003e${w}\u003c/span\u003e \u003cspan class=\"hljs-subst\"\u003e${h - brr}\u003c/span\u003e `\u003c/span\u003e\n                + \u003cspan class=\"hljs-string\"\u003e`A \u003cspan class=\"hljs-subst\"\u003e${brr}\u003c/span\u003e \u003cspan class=\"hljs-subst\"\u003e${brr}\u003c/span\u003e 0 0 1 \u003cspan class=\"hljs-subst\"\u003e${w - brr}\u003c/span\u003e \u003cspan class=\"hljs-subst\"\u003e${h}\u003c/span\u003e L \u003cspan class=\"hljs-subst\"\u003e${blr}\u003c/span\u003e \u003cspan class=\"hljs-subst\"\u003e${h}\u003c/span\u003e `\u003c/span\u003e\n                + \u003cspan class=\"hljs-string\"\u003e`A \u003cspan class=\"hljs-subst\"\u003e${blr}\u003c/span\u003e \u003cspan class=\"hljs-subst\"\u003e${blr}\u003c/span\u003e 0 0 1 0 \u003cspan class=\"hljs-subst\"\u003e${h - blr}\u003c/span\u003e Z`\u003c/span\u003e;\n        }\n\n        \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eanimation\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n            \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e path = \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003equerySelector\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;#path\u0026#x27;\u003c/span\u003e);\n            \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e preOffset = path.\u003cspan class=\"hljs-title function_\"\u003egetAttribute\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;stroke-dashoffset\u0026#x27;\u003c/span\u003e);\n            \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e newOffset = preOffset - \u003cspan class=\"hljs-variable constant_\"\u003eSTEP\u003c/span\u003e;\n            path.\u003cspan class=\"hljs-title function_\"\u003esetAttribute\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;stroke-dashoffset\u0026#x27;\u003c/span\u003e, newOffset);\n            \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (newOffset \u0026gt;= \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e) {\n                rafId = \u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003erequestAnimationFrame\u003c/span\u003e(animation);\n            } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n                path.\u003cspan class=\"hljs-title function_\"\u003esetAttribute\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;stroke-dashoffset\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-variable constant_\"\u003eSTORK_LENGTH\u003c/span\u003e - \u003cspan class=\"hljs-variable constant_\"\u003eDEFAULT_OFFSET\u003c/span\u003e);\n                \u003cspan class=\"hljs-title function_\"\u003ealert\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;success\u0026#x27;\u003c/span\u003e);\n            }\n        }\n\n        \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eonMouseDown\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n            rafId = \u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003erequestAnimationFrame\u003c/span\u003e(animation);\n        }\n\n        \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eonMouseUp\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n            \u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecancelAnimationFrame\u003c/span\u003e(rafId);\n            path.\u003cspan class=\"hljs-title function_\"\u003esetAttribute\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;stroke-dashoffset\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-variable constant_\"\u003eSTORK_LENGTH\u003c/span\u003e - \u003cspan class=\"hljs-variable constant_\"\u003eDEFAULT_OFFSET\u003c/span\u003e);\n        }\n\n        \u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;load\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n            \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e path = \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003equerySelector\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;#path\u0026#x27;\u003c/span\u003e);\n            \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e background = \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003equerySelector\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;#background\u0026#x27;\u003c/span\u003e);\n            path.\u003cspan class=\"hljs-title function_\"\u003esetAttribute\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;stroke-dashoffset\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-variable constant_\"\u003eSTORK_LENGTH\u003c/span\u003e - \u003cspan class=\"hljs-variable constant_\"\u003eDEFAULT_OFFSET\u003c/span\u003e);\n            path.\u003cspan class=\"hljs-title function_\"\u003esetAttribute\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;stroke-dasharray\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-variable constant_\"\u003eSTORK_LENGTH\u003c/span\u003e);\n\n            \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e roundedPath = \u003cspan class=\"hljs-title function_\"\u003eroundedRect\u003c/span\u003e(\u003cspan class=\"hljs-variable constant_\"\u003eWIDTH\u003c/span\u003e, \u003cspan class=\"hljs-variable constant_\"\u003eHEIGHT\u003c/span\u003e, \u003cspan class=\"hljs-variable constant_\"\u003eRADIUS\u003c/span\u003e, \u003cspan class=\"hljs-variable constant_\"\u003eRADIUS\u003c/span\u003e, \u003cspan class=\"hljs-variable constant_\"\u003eRADIUS\u003c/span\u003e, \u003cspan class=\"hljs-variable constant_\"\u003eRADIUS\u003c/span\u003e);\n            path.\u003cspan class=\"hljs-title function_\"\u003esetAttribute\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;d\u0026#x27;\u003c/span\u003e, roundedPath);\n            background.\u003cspan class=\"hljs-title function_\"\u003esetAttribute\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;d\u0026#x27;\u003c/span\u003e, roundedPath);\n        });\n    \u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003esvg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;svg\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;80\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;40\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003efill\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;#ccc\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eonmousedown\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;onMouseDown()\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eonmouseup\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;onMouseUp()\u0026quot;\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003exmlns\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;http://www.w3.org/2000/svg\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003epath\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;path\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003epath\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003epath\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;background\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003epath\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etext\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;text\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ex\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;40\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ey\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;20\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003eclick me\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etext\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003esvg\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e最终效果\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://mrrs878.github.io/awesome/static/img/button.gif\" alt=\"最终效果\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://mrrs878.github.io/awesome/interactive-button/index.html\"\u003e在线体验\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e参考：\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://www.cnblogs.com/daisygogogo/p/11044353.html\"\u003eSVG学习之stroke-dasharray 和 stroke-dashoffset 详解\u003c/a\u003e\u003c/p\u003e\n"},{"title":"typescript学习-拾遗","tags":["never"],"categories":"typescript","description":"`never` 类型是 TypeScript 中的底层类型。一些例子：\n\n- 一个从来不会有返回值的函数（如：如果函数内含有 `while(true) {}`）；\n- 一个总是会抛出错误的函数（如：`function foo() { throw new Error('Not Implemented') }`，`foo` 的返回类型是 `never`）；\n\n使用场景：详细的返回值检查\n``` t","createDate":"2021-10-08 13:20:35","updateDate":"2021-10-08 21:21:44","body":"\u003cp\u003e\u003ccode\u003enever\u003c/code\u003e 类型是 TypeScript 中的底层类型。一些例子：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e一个从来不会有返回值的函数（如：如果函数内含有 \u003ccode\u003ewhile(true) {}\u003c/code\u003e）；\u003c/li\u003e\n\u003cli\u003e一个总是会抛出错误的函数（如：\u003ccode\u003efunction foo() { throw new Error(\u0026#39;Not Implemented\u0026#39;) }\u003c/code\u003e，\u003ccode\u003efoo\u003c/code\u003e 的返回类型是 \u003ccode\u003enever\u003c/code\u003e）；\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e使用场景：详细的返回值检查\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efoo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ex: \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e | \u003cspan class=\"hljs-built_in\"\u003enumber\u003c/span\u003e\u003c/span\u003e): \u003cspan class=\"hljs-built_in\"\u003eboolean\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e x === \u003cspan class=\"hljs-string\"\u003e\u0026#x27;string\u0026#x27;\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e x === \u003cspan class=\"hljs-string\"\u003e\u0026#x27;number\u0026#x27;\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n  }\n\n  \u003cspan class=\"hljs-comment\"\u003e// 如果不是一个 never 类型，这会报错：\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// - 不是所有条件都有返回值 （严格模式下）\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// - 或者检查到无法访问的代码\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// 但是由于 TypeScript 理解 `fail` 函数返回为 `never` 类型\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// 它可以让你调用它，因为你可能会在运行时用它来做安全或者详细的检查。\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efail\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Unexhaustive\u0026#x27;\u003c/span\u003e);\n}\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efail\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003emessage: \u003cspan class=\"hljs-built_in\"\u003estring\u003c/span\u003e\u003c/span\u003e): \u003cspan class=\"hljs-built_in\"\u003enever\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eError\u003c/span\u003e(message);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e与 \u003ccode\u003evoid\u003c/code\u003e 的差异：\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003enever\u003c/code\u003e 表示一个从来不会优雅的返回的函数时，你可能马上就会想到与此类似的 \u003ccode\u003evoid\u003c/code\u003e，然而实际上，\u003ccode\u003evoid\u003c/code\u003e 表示没有任何类型，\u003ccode\u003enever\u003c/code\u003e 表示永远不存在的值的类型。\u003c/p\u003e\n\u003cp\u003e当一个函数返回空值时，它的返回值为 \u003ccode\u003evoid\u003c/code\u003e 类型，但是，当一个函数永不返回时（或者总是抛出错误），它的返回值为 \u003ccode\u003enever\u003c/code\u003e 类型。\u003ccode\u003evoid\u003c/code\u003e 类型可以被赋值（在 \u003ccode\u003estrictNullChecking\u003c/code\u003e 为 \u003ccode\u003efalse\u003c/code\u003e时），但是除了 \u003ccode\u003enever\u003c/code\u003e 本身以外，其他任何类型不能赋值给 \u003ccode\u003enever\u003c/code\u003e\u003c/p\u003e\n"}]},"__N_SSG":true},"page":"/","query":{},"buildId":"G8SRe3ccBbz7hzZBCxuYD","assetPrefix":"/next-blog","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>