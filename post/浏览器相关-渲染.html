<!DOCTYPE html><html><head><link rel="icon" href="https://mrrsblog.oss-cn-shanghai.aliyuncs.com/avatar.jpg"/><script async="" src="/js/L2Dwidget.min.js"></script><script async="" src="/js/initL2D.js"></script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Mr.RS的个人博客-浏览器相关-渲染</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/15773988a510c3d3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/15773988a510c3d3.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-b927671265afed5e.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-1e7421553b9673ee.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ca6aae25bc99a05f.js" defer=""></script><script src="/_next/static/chunks/899-3eff910f6206cfe7.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Btitle%5D-d89e1712c82a34ac.js" defer=""></script><script src="/_next/static/HbYP_GwUE9gOGOO8F4jR8/_buildManifest.js" defer=""></script><script src="/_next/static/HbYP_GwUE9gOGOO8F4jR8/_ssgManifest.js" defer=""></script><script src="/_next/static/HbYP_GwUE9gOGOO8F4jR8/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><header class="fixed top-0 py-4 left-0 right-0 h-auto px-10 shadow bg-white z-50"><nav><ul class="flex w-auto"><li class="mr-4 hover:text-yellow"><a href="/">首页</a></li><li class="mx-4 hover:text-yellow"><a href="/categories">分类</a></li><li class="mx-4 hover:text-yellow"><a href="/tags">标签</a></li><li class="ml-4 hover:text-yellow"><a href="/timeline">归档</a></li></ul></nav></header><main class="mt-20 mb-4 mx-auto justify-center w-2/3"><div class="mx-auto lg:max-w-5xl md:max-w-3xl"><article class="flex flex-col justify-around pb-16 px-4 mx-auto space-y-10 text-base"><div class="flex flex-col space-y-4"><h1 class="inline pt-10 text-4xl text-skin-primary">浏览器相关-渲染</h1><div class="text-sm space-x-2 text-skin-muted grid grid-cols-5"><span class="flex align-middle"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 inline-block mr-1"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>2019-06-30 15:10:22</span><span class="flex align-middle"><svg class="w-5 h-5 inline-block mr-1" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1903" width="20" height="20"><path d="M257.7 752c2 0 4-0.2 6-0.5L431.9 722c2-0.4 3.9-1.3 5.3-2.8l423.9-423.9c3.9-3.9 3.9-10.2 0-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2c-1.9 11.1 1.5 21.9 9.4 29.8 6.6 6.4 14.9 9.9 23.8 9.9z m67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z" p-id="1904"></path></svg>10/1/2021, 3:34:43 AM</span></div></div><div class="mt-8 flex"><div class="w-full flex-auto custom-markdown-body"><div class="markdown-body" id="write">
      <h2>
        <span class="prefix"></span>
        <span class="content">渲染流程图示</span>
        <span class="suffix"></span>
      </h2>
    <p><img src="https://mrrsblog.oss-cn-shanghai.aliyuncs.com/render-0.png" alt="浏览器渲染过程"></p>

      <h3>
        <span class="prefix"></span>
        <span class="content">解析 HTML 文件</span>
        <span class="suffix"></span>
      </h3>
    <p><img src="https://mrrsblog.oss-cn-shanghai.aliyuncs.com/render-1.png" alt="解析HTML文件">
token：标记，本质上还是字符串，是构成代码的最小单位，这一过程会将代码分为一块块，并在这些内容打上标记，便于理解这些最小单位的代码是什么意思
<img src="https://mrrsblog.oss-cn-shanghai.aliyuncs.com/render-2.png" alt="token"></p>

      <h3>
        <span class="prefix"></span>
        <span class="content">解析 CSS 文件</span>
        <span class="suffix"></span>
      </h3>
    <p><img src="https://mrrsblog.oss-cn-shanghai.aliyuncs.com/render-3.png" alt="解析CSS文件"></p>

      <h3>
        <span class="prefix"></span>
        <span class="content">生成渲染树</span>
        <span class="suffix"></span>
      </h3>
    <p>渲染树只会包含需要显示的节点和这些节点的样式信息，如果这个节点是 display: none，那么就不会在渲染树上显示。当浏览器生成渲染树以后就会根据渲染树来进行布局（回流），然后调用 GPU 绘制，合成图层，显示在屏幕上</p>

      <h2>
        <span class="prefix"></span>
        <span class="content">操作 DOM 慢的原因</span>
        <span class="suffix"></span>
      </h2>
    <p>DOM 属于渲染引擎中的东西，JS 又是 JS 引擎中的东西，当通过 JS 操作 DOM 的时候，其实这个操作涉及到了<strong>两个线程之间的通信</strong>，那么势必会带来一些性能上的损耗，操作 DOM 次数一多，也就等同于一直在进行线程之间的通信，并且操作 DOM 可能还会带来<strong>重绘回流</strong>的情况，所以就导致了性能上的问题</p>

      <h2>
        <span class="prefix"></span>
        <span class="content">什么情况阻塞渲染</span>
        <span class="suffix"></span>
      </h2>
    <p>渲染的前提是生成渲染树，所以 HTML 和 CSS 肯定会阻塞渲染，如果想渲染的越快，就越应该降低一开始需要渲染的文件大小，并且扁平层级，优化选择器
然后当浏览器解析到 script 标签时，会暂停构建 DOM，完成后才会从暂停的地方重新开始，也就是说，如果你想首屏渲染的越快，就越不应该在首屏就加载 JS 文件，这也是都建议将 script 标签放在 body 标签底部的原因。
当然在当下，并不是说 script 标签必须放在底部，因为你可以给 script 标签添加 defer 或者 async 属性。
当 script 标签加上 defer 属性以后，表示该 JS 文件会并行下载，但是会放到 HTML 解析完成后顺序执行，所以对于这种情况你可以把 script 标签放在任意位置。
对于没有任何依赖的 JS 文件可以加上 async 属性，表示 JS 文件下载和解析不会阻塞渲染。</p>

      <h2>
        <span class="prefix"></span>
        <span class="content">重绘和回流</span>
        <span class="suffix"></span>
      </h2>
    <p>重绘会在设置节点样式时频繁出现，同时也会很大程度上影响性能</p>
<ul>
<li>重绘是当节点需要更改外观而不会影响布局的时候发生，比如改变 color 就叫重绘</li>
<li>回流是布局或者几何属性需要改变就称为回流</li>
</ul>
<p>回流必然会引起重绘，重绘不一定为引发回流</p>

      <h2>
        <span class="prefix"></span>
        <span class="content">会引起回流的操作</span>
        <span class="suffix"></span>
      </h2>
    <ul>
<li>页面首次渲染</li>
<li>浏览器窗口大小发生改变</li>
<li>元素尺寸或者位置发生改变</li>
<li>元素内容变化（文字数量或者图片发小发生改变）</li>
<li>元素字体大小的变化</li>
<li>添加或删除<strong>可见</strong>的DOM元素</li>
<li>激活CSS伪类（:hover）</li>
<li>查询某些属性或调用某些方法<ul>
<li><code>clientWidth</code>、<code>clientHeight</code>、<code>clientTop</code>、<code>clientLeft</code></li>
<li><code>offsetWidth</code>、<code>offsetHeight</code>、<code>offsetTop</code>、<code>offsetLeft</code></li>
<li><code>scrollWidth</code>、<code>scrollHeight</code>、<code>scrollTop</code>、<code>scrollLeft</code></li>
<li><code>scrollIntoView()</code>、<code>scrollIntoViewIfNeeded()</code></li>
<li><code>getComputedStyle()</code></li>
<li><code>getBoundingClientRect()</code></li>
<li><code>scrollTo()</code></li>
</ul>
</li>
</ul>

      <h2>
        <span class="prefix"></span>
        <span class="content">减少重绘和回流</span>
        <span class="suffix"></span>
      </h2>
    <ul>
<li>使用 transform 代替 top</li>
<li>使用 visiblity 代替 display: none（前者引起重绘，后者引起回流）</li>
<li>不要把节点的属性值放在一个循环里当循环的变量</li>
<li>不要使用 table 布局</li>
<li>动画的选择</li>
<li>CSS 选择符从右到左匹配查找，避免节点层级过多</li>
</ul>
</div></div></div></article></div></main><footer class="flex flex-col items-center justify-center leading-8 text-sm w-full py-2 border-t text-skin-muted"><p>Designed &amp; developed by<a class="ml-1 text-yellow" target="_blank" href="https://github.com/mrrs878" rel="noreferrer">Mr.RS</a></p><p>2024</p></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"浏览器相关-渲染","tags":["浏览器","浏览器渲染"],"categories":"浏览器","description":"## 渲染流程图示\n\n![浏览器渲染过程](https://mrrsblog.oss-cn-shanghai.aliyuncs.com/render-0.png)\n\n### 解析 HTML 文件\n\n![解析HTML文件](https://mrrsblog.oss-cn-shanghai.aliyuncs.com/render-1.png)\ntoken：标记，本质上还是字符串，是构成代码的最小单","createDate":"2019-06-30 15:10:22","updateDate":"10/1/2021, 3:34:43 AM","body":"\n      \u003ch2\u003e\n        \u003cspan class=\"prefix\"\u003e\u003c/span\u003e\n        \u003cspan class=\"content\"\u003e渲染流程图示\u003c/span\u003e\n        \u003cspan class=\"suffix\"\u003e\u003c/span\u003e\n      \u003c/h2\u003e\n    \u003cp\u003e\u003cimg src=\"https://mrrsblog.oss-cn-shanghai.aliyuncs.com/render-0.png\" alt=\"浏览器渲染过程\"\u003e\u003c/p\u003e\n\n      \u003ch3\u003e\n        \u003cspan class=\"prefix\"\u003e\u003c/span\u003e\n        \u003cspan class=\"content\"\u003e解析 HTML 文件\u003c/span\u003e\n        \u003cspan class=\"suffix\"\u003e\u003c/span\u003e\n      \u003c/h3\u003e\n    \u003cp\u003e\u003cimg src=\"https://mrrsblog.oss-cn-shanghai.aliyuncs.com/render-1.png\" alt=\"解析HTML文件\"\u003e\ntoken：标记，本质上还是字符串，是构成代码的最小单位，这一过程会将代码分为一块块，并在这些内容打上标记，便于理解这些最小单位的代码是什么意思\n\u003cimg src=\"https://mrrsblog.oss-cn-shanghai.aliyuncs.com/render-2.png\" alt=\"token\"\u003e\u003c/p\u003e\n\n      \u003ch3\u003e\n        \u003cspan class=\"prefix\"\u003e\u003c/span\u003e\n        \u003cspan class=\"content\"\u003e解析 CSS 文件\u003c/span\u003e\n        \u003cspan class=\"suffix\"\u003e\u003c/span\u003e\n      \u003c/h3\u003e\n    \u003cp\u003e\u003cimg src=\"https://mrrsblog.oss-cn-shanghai.aliyuncs.com/render-3.png\" alt=\"解析CSS文件\"\u003e\u003c/p\u003e\n\n      \u003ch3\u003e\n        \u003cspan class=\"prefix\"\u003e\u003c/span\u003e\n        \u003cspan class=\"content\"\u003e生成渲染树\u003c/span\u003e\n        \u003cspan class=\"suffix\"\u003e\u003c/span\u003e\n      \u003c/h3\u003e\n    \u003cp\u003e渲染树只会包含需要显示的节点和这些节点的样式信息，如果这个节点是 display: none，那么就不会在渲染树上显示。当浏览器生成渲染树以后就会根据渲染树来进行布局（回流），然后调用 GPU 绘制，合成图层，显示在屏幕上\u003c/p\u003e\n\n      \u003ch2\u003e\n        \u003cspan class=\"prefix\"\u003e\u003c/span\u003e\n        \u003cspan class=\"content\"\u003e操作 DOM 慢的原因\u003c/span\u003e\n        \u003cspan class=\"suffix\"\u003e\u003c/span\u003e\n      \u003c/h2\u003e\n    \u003cp\u003eDOM 属于渲染引擎中的东西，JS 又是 JS 引擎中的东西，当通过 JS 操作 DOM 的时候，其实这个操作涉及到了\u003cstrong\u003e两个线程之间的通信\u003c/strong\u003e，那么势必会带来一些性能上的损耗，操作 DOM 次数一多，也就等同于一直在进行线程之间的通信，并且操作 DOM 可能还会带来\u003cstrong\u003e重绘回流\u003c/strong\u003e的情况，所以就导致了性能上的问题\u003c/p\u003e\n\n      \u003ch2\u003e\n        \u003cspan class=\"prefix\"\u003e\u003c/span\u003e\n        \u003cspan class=\"content\"\u003e什么情况阻塞渲染\u003c/span\u003e\n        \u003cspan class=\"suffix\"\u003e\u003c/span\u003e\n      \u003c/h2\u003e\n    \u003cp\u003e渲染的前提是生成渲染树，所以 HTML 和 CSS 肯定会阻塞渲染，如果想渲染的越快，就越应该降低一开始需要渲染的文件大小，并且扁平层级，优化选择器\n然后当浏览器解析到 script 标签时，会暂停构建 DOM，完成后才会从暂停的地方重新开始，也就是说，如果你想首屏渲染的越快，就越不应该在首屏就加载 JS 文件，这也是都建议将 script 标签放在 body 标签底部的原因。\n当然在当下，并不是说 script 标签必须放在底部，因为你可以给 script 标签添加 defer 或者 async 属性。\n当 script 标签加上 defer 属性以后，表示该 JS 文件会并行下载，但是会放到 HTML 解析完成后顺序执行，所以对于这种情况你可以把 script 标签放在任意位置。\n对于没有任何依赖的 JS 文件可以加上 async 属性，表示 JS 文件下载和解析不会阻塞渲染。\u003c/p\u003e\n\n      \u003ch2\u003e\n        \u003cspan class=\"prefix\"\u003e\u003c/span\u003e\n        \u003cspan class=\"content\"\u003e重绘和回流\u003c/span\u003e\n        \u003cspan class=\"suffix\"\u003e\u003c/span\u003e\n      \u003c/h2\u003e\n    \u003cp\u003e重绘会在设置节点样式时频繁出现，同时也会很大程度上影响性能\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e重绘是当节点需要更改外观而不会影响布局的时候发生，比如改变 color 就叫重绘\u003c/li\u003e\n\u003cli\u003e回流是布局或者几何属性需要改变就称为回流\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e回流必然会引起重绘，重绘不一定为引发回流\u003c/p\u003e\n\n      \u003ch2\u003e\n        \u003cspan class=\"prefix\"\u003e\u003c/span\u003e\n        \u003cspan class=\"content\"\u003e会引起回流的操作\u003c/span\u003e\n        \u003cspan class=\"suffix\"\u003e\u003c/span\u003e\n      \u003c/h2\u003e\n    \u003cul\u003e\n\u003cli\u003e页面首次渲染\u003c/li\u003e\n\u003cli\u003e浏览器窗口大小发生改变\u003c/li\u003e\n\u003cli\u003e元素尺寸或者位置发生改变\u003c/li\u003e\n\u003cli\u003e元素内容变化（文字数量或者图片发小发生改变）\u003c/li\u003e\n\u003cli\u003e元素字体大小的变化\u003c/li\u003e\n\u003cli\u003e添加或删除\u003cstrong\u003e可见\u003c/strong\u003e的DOM元素\u003c/li\u003e\n\u003cli\u003e激活CSS伪类（:hover）\u003c/li\u003e\n\u003cli\u003e查询某些属性或调用某些方法\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eclientWidth\u003c/code\u003e、\u003ccode\u003eclientHeight\u003c/code\u003e、\u003ccode\u003eclientTop\u003c/code\u003e、\u003ccode\u003eclientLeft\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eoffsetWidth\u003c/code\u003e、\u003ccode\u003eoffsetHeight\u003c/code\u003e、\u003ccode\u003eoffsetTop\u003c/code\u003e、\u003ccode\u003eoffsetLeft\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003escrollWidth\u003c/code\u003e、\u003ccode\u003escrollHeight\u003c/code\u003e、\u003ccode\u003escrollTop\u003c/code\u003e、\u003ccode\u003escrollLeft\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003escrollIntoView()\u003c/code\u003e、\u003ccode\u003escrollIntoViewIfNeeded()\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003egetComputedStyle()\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003egetBoundingClientRect()\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003escrollTo()\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n      \u003ch2\u003e\n        \u003cspan class=\"prefix\"\u003e\u003c/span\u003e\n        \u003cspan class=\"content\"\u003e减少重绘和回流\u003c/span\u003e\n        \u003cspan class=\"suffix\"\u003e\u003c/span\u003e\n      \u003c/h2\u003e\n    \u003cul\u003e\n\u003cli\u003e使用 transform 代替 top\u003c/li\u003e\n\u003cli\u003e使用 visiblity 代替 display: none（前者引起重绘，后者引起回流）\u003c/li\u003e\n\u003cli\u003e不要把节点的属性值放在一个循环里当循环的变量\u003c/li\u003e\n\u003cli\u003e不要使用 table 布局\u003c/li\u003e\n\u003cli\u003e动画的选择\u003c/li\u003e\n\u003cli\u003eCSS 选择符从右到左匹配查找，避免节点层级过多\u003c/li\u003e\n\u003c/ul\u003e\n"}},"__N_SSG":true},"page":"/post/[title]","query":{"title":"浏览器相关-渲染"},"buildId":"HbYP_GwUE9gOGOO8F4jR8","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>