<!DOCTYPE html><html><head><link rel="icon" href="https://mrrsblog.oss-cn-shanghai.aliyuncs.com/avatar.jpg"/><script async="" src="/js/L2Dwidget.min.js"></script><script async="" src="/js/initL2D.js"></script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Mr.RS的个人博客-webpack学习-ModuleFederation</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/15773988a510c3d3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/15773988a510c3d3.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-b927671265afed5e.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-1e7421553b9673ee.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ca6aae25bc99a05f.js" defer=""></script><script src="/_next/static/chunks/899-3eff910f6206cfe7.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Btitle%5D-d89e1712c82a34ac.js" defer=""></script><script src="/_next/static/HbYP_GwUE9gOGOO8F4jR8/_buildManifest.js" defer=""></script><script src="/_next/static/HbYP_GwUE9gOGOO8F4jR8/_ssgManifest.js" defer=""></script><script src="/_next/static/HbYP_GwUE9gOGOO8F4jR8/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><header class="fixed top-0 py-4 left-0 right-0 h-auto px-10 shadow bg-white z-50"><nav><ul class="flex w-auto"><li class="mr-4 hover:text-yellow"><a href="/">首页</a></li><li class="mx-4 hover:text-yellow"><a href="/categories">分类</a></li><li class="mx-4 hover:text-yellow"><a href="/tags">标签</a></li><li class="ml-4 hover:text-yellow"><a href="/timeline">归档</a></li></ul></nav></header><main class="mt-20 mb-4 mx-auto justify-center w-2/3"><div class="mx-auto lg:max-w-5xl md:max-w-3xl"><article class="flex flex-col justify-around pb-16 px-4 mx-auto space-y-10 text-base"><div class="flex flex-col space-y-4"><h1 class="inline pt-10 text-4xl text-skin-primary">webpack学习-ModuleFederation</h1><div class="text-sm space-x-2 text-skin-muted grid grid-cols-5"><span class="flex align-middle"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 inline-block mr-1"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>2022-06-11 18:51:42</span><span class="flex align-middle"><svg class="w-5 h-5 inline-block mr-1" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1903" width="20" height="20"><path d="M257.7 752c2 0 4-0.2 6-0.5L431.9 722c2-0.4 3.9-1.3 5.3-2.8l423.9-423.9c3.9-3.9 3.9-10.2 0-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2c-1.9 11.1 1.5 21.9 9.4 29.8 6.6 6.4 14.9 9.9 23.8 9.9z m67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z" p-id="1904"></path></svg>2022-06-12 22:51:42</span></div></div><div class="mt-8 flex"><div class="w-full flex-auto custom-markdown-body"><div class="markdown-body" id="write"><p>学习<a href="mailto:&#119;&#x65;&#98;&#x70;&#97;&#x63;&#x6b;&#x40;&#x35;&#x2e;&#x37;&#x33;&#46;&#48;">&#119;&#x65;&#98;&#x70;&#97;&#x63;&#x6b;&#x40;&#x35;&#x2e;&#x37;&#x33;&#46;&#48;</a>的 ModuleFederation</p>

      <h2>
        <span class="prefix"></span>
        <span class="content">WHAT</span>
        <span class="suffix"></span>
      </h2>
    <p>webpack 提供的一种跨项目模块共享机制</p>
<p>先通过一个 🌰 了解一下</p>
<p><img src="/img/webpack-mf-0.png" alt="webpack ModuleFederation"></p>
<p>如图所示，分别创建了两个项目 <code>host</code> 和 <code>remote</code></p>
<ul>
<li><code>remote</code> 中创建了两个组件 <code>Button</code> 和 <code>Header</code></li>
<li><code>host</code> 中的 <code>bootstrap.jsx</code> 引用了两个组件 (注意，这两个组件在 <code>host</code> 项目中并未定义)</li>
</ul>
<p>分别在两个项目下执行 <code>npx webpack serve</code> ，然后访问 <code>host</code> 的开发地址 <code>http://localhost:8080/</code> 效果如图所示，接着尝试修改 <code>remote</code> 中的 <code>components/Header.jsx</code> 发现页面中也相应发生变化</p>
<p>🤔</p>
<p>也就是说，我们在 <code>host</code> 中引用了 <code>remote</code> 中的组件？😱</p>
<p>对的，这就是 webpack5 提供的新特性 ModuleFederation ，中文直译模块联邦</p>
<p>联邦模块有两个主要概念： <code>host</code> （消费其他 <code>remote</code> ）和 <code>remote</code> （被 <code>host</code> 消费）。 每个项目可以是 <code>host</code> 也可以是 <code>remote</code> ，也可以两个都是。可以通过 webpack 配置来区分，可以参考上述的例子</p>
<ul>
<li><p>作为 <code>host</code> 需要配置 <code>remotes</code> 列表</p>
</li>
<li><p>作为 <code>remote</code> 需要配置项目名（ <code>name</code> ），打包后的文件名（ <code>filename</code> ），提供的模块（ <code>exposes</code> ）</p>
</li>
</ul>
<p>而且想要开启这一特性，只需要少许的配置即可</p>
<p>在需要共享的项目中，即上述的 <code>remote</code> 中，添加这个 webpack 配置</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">ModuleFederationPlugin</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;webpack&quot;</span>).<span class="hljs-property">container</span>;

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModuleFederationPlugin</span>({
      <span class="hljs-comment">// 当前应用的名字，全局唯一ID，通过 name/{expose} 的方式使用</span>
      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;remote&quot;</span>,
      <span class="hljs-comment">// *可选，打包方式，与 name 保持一致即可</span>
      <span class="hljs-attr">library</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">&quot;var&quot;</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;remote&quot;</span> },
      <span class="hljs-comment">// 共享组件/模块打包后所在的文件，使用者直接导入这个文件即可</span>
      <span class="hljs-attr">filename</span>: <span class="hljs-string">&quot;remoteEntry.js&quot;</span>,
      <span class="hljs-attr">exposes</span>: {
        <span class="hljs-comment">// 这里便是我们要共享的模块/组件，引用方式为 import(name/{expose})，比如 import(&#x27;remote/Button&#x27;)</span>
        <span class="hljs-string">&quot;./Button&quot;</span>: <span class="hljs-string">&quot;./src/components/Button.jsx&quot;</span>,
        <span class="hljs-string">&quot;./Header&quot;</span>: <span class="hljs-string">&quot;./src/components/Header.jsx&quot;</span>,
      },
      <span class="hljs-comment">// 在这里指定需要共享的package</span>
      <span class="hljs-attr">shared</span>: {
        <span class="hljs-attr">react</span>: { <span class="hljs-attr">singleton</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">requiredVersion</span>: <span class="hljs-string">&quot;^18.1.0&quot;</span> },
        <span class="hljs-string">&quot;react-dom&quot;</span>: { <span class="hljs-attr">singleton</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">requiredVersion</span>: <span class="hljs-string">&quot;^18.1.0&quot;</span> },
      },
    }),
  ],
};
</code></pre>
<p>同时，在需要引用这些组件的项目中，即上述的<code>host</code>项目，webpack 配置文件中新增这些配置</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">ModuleFederationPlugin</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;webpack&quot;</span>).<span class="hljs-property">container</span>;

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ModuleFederationPlugin</span>({
      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;host&quot;</span>,
      <span class="hljs-comment">// 表示当前应用是一个 Host，可以引用 remote 中 expose 的模块</span>
      <span class="hljs-attr">remotes</span>: {
        <span class="hljs-attr">remote</span>: <span class="hljs-string">&quot;remote@http://localhost:8081/remoteEntry.js&quot;</span>,
      },
      <span class="hljs-comment">// 在这里指定需要共享的package</span>
      <span class="hljs-comment">// 在使用 Module Federation 时，Host、Remote 必须配置一致的 shared 这样才会生效</span>
      <span class="hljs-attr">shared</span>: {
        <span class="hljs-attr">react</span>: { <span class="hljs-attr">singleton</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">requiredVersion</span>: <span class="hljs-string">&quot;^18.1.0&quot;</span> },
        <span class="hljs-string">&quot;react-dom&quot;</span>: { <span class="hljs-attr">singleton</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">requiredVersion</span>: <span class="hljs-string">&quot;^18.1.0&quot;</span> },
      },
    }),
  ],
};
</code></pre>
<p>在这里，我们也可以简单得分析一下 host 应用加载的 js 文件</p>
<p><img src="/img/webpack-mf-1.png" alt="webpack ModuleFederation配置shared的构建文件"></p>
<p>如图所示，在本示例中 host 加载了三个 remote 的文件<code>remoteEntry.js</code>和<code>src_components_Header_jsx.js</code>与<code>src_components_Button_jsx.js</code>，其中后两者是加载的组件代码，<code>remoteEntry.js</code>是入口文件，可以发现并没有加载 react 相关的源码，这是因为我们配置了<code>shared</code>，这样 remote 就可以和 host 共用一套 react（在这里，react 是被打包进<code>main.js</code>中）。如果没有配置<code>shared</code>选项，那么会单独加载一份 react 代码</p>
<p><img src="/img/webpack-mf-2.png" alt="webpack ModuleFederation未配置shared的构建文件"></p>
<p>可以看到，这时会单独加载一份react源码</p>

      <h2>
        <span class="prefix"></span>
        <span class="content">WHY</span>
        <span class="suffix"></span>
      </h2>
    <p>在构建工具层面上对模块共享、模块加载做一些扩展、优化</p>

      <h2>
        <span class="prefix"></span>
        <span class="content">HOW</span>
        <span class="suffix"></span>
      </h2>
    <p>修改了 <code>webpack_require</code> 的部分实现，在 <code>require</code> 的时候从远程加载资源，缓存到全局对象 <code>window[&quot;webpackChunk&quot;+appName]</code> 中，然后合并到 <code>webpack_modules</code> 中</p>
<p>webpack 每次打包都会将资源全部包裹在一个立即执行函数里面，这样虽然避免了全局环境的污染，但也使得外部不能访问内部模块。 在这个立即执行函数里面，webpack 使用 <code>webpack_modules</code> 对象保存所有的模块代码，然后用内部定义的 <code>webpack_require</code> 方法从 <code>webpack_modules</code> 中加载模块。并且在异步加载和文件拆分两种情况下向全局暴露一个 <code>webpackChunk</code> 数组用于沟通多个 webpack 资源，这个数组通过被 webpack 重写 <code>push</code> 方法，会在其他资源向 <code>webpackChunk</code> 数组中新增内容时同步添加到 <code>webpack_modules</code> 中从而实现模块整合</p>

      <h2>
        <span class="prefix"></span>
        <span class="content">参考</span>
        <span class="suffix"></span>
      </h2>
    <p><a href="https://www.zoo.team/article/webpack-modular">模块联邦浅析</a></p>
<p><a href="https://webpack.docschina.org/concepts/module-federation/#Uncaught-Error-Shared-module-is-not-available-for-eager-consumption">webpack 中文文档</a></p>
<p><a href="https://github.com/module-federation/module-federation-examples/tree/master/basic-host-remote">module-federation-examples/basic-host-remote</a></p>
</div></div></div></article></div></main><footer class="flex flex-col items-center justify-center leading-8 text-sm w-full py-2 border-t text-skin-muted"><p>Designed &amp; developed by<a class="ml-1 text-yellow" target="_blank" href="https://github.com/mrrs878" rel="noreferrer">Mr.RS</a></p><p>2024</p></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"webpack学习-ModuleFederation","tags":["webpack","ModuleFederation"],"categories":"webpack","description":"学习webpack@5.73.0的 ModuleFederation\n\n## WHAT\n\nwebpack 提供的一种跨项目模块共享机制\n\n先通过一个 🌰 了解一下\n\n![webpack ModuleFederation](/img/webpack-mf-0.png)\n\n如图所示，分别创建了两个项目 `host` 和 `remote`\n\n- `remote` 中创建了两个组件 `Button`","createDate":"2022-06-11 18:51:42","updateDate":"2022-06-12 22:51:42","body":"\u003cp\u003e学习\u003ca href=\"mailto:\u0026#119;\u0026#x65;\u0026#98;\u0026#x70;\u0026#97;\u0026#x63;\u0026#x6b;\u0026#x40;\u0026#x35;\u0026#x2e;\u0026#x37;\u0026#x33;\u0026#46;\u0026#48;\"\u003e\u0026#119;\u0026#x65;\u0026#98;\u0026#x70;\u0026#97;\u0026#x63;\u0026#x6b;\u0026#x40;\u0026#x35;\u0026#x2e;\u0026#x37;\u0026#x33;\u0026#46;\u0026#48;\u003c/a\u003e的 ModuleFederation\u003c/p\u003e\n\n      \u003ch2\u003e\n        \u003cspan class=\"prefix\"\u003e\u003c/span\u003e\n        \u003cspan class=\"content\"\u003eWHAT\u003c/span\u003e\n        \u003cspan class=\"suffix\"\u003e\u003c/span\u003e\n      \u003c/h2\u003e\n    \u003cp\u003ewebpack 提供的一种跨项目模块共享机制\u003c/p\u003e\n\u003cp\u003e先通过一个 🌰 了解一下\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/img/webpack-mf-0.png\" alt=\"webpack ModuleFederation\"\u003e\u003c/p\u003e\n\u003cp\u003e如图所示，分别创建了两个项目 \u003ccode\u003ehost\u003c/code\u003e 和 \u003ccode\u003eremote\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eremote\u003c/code\u003e 中创建了两个组件 \u003ccode\u003eButton\u003c/code\u003e 和 \u003ccode\u003eHeader\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ehost\u003c/code\u003e 中的 \u003ccode\u003ebootstrap.jsx\u003c/code\u003e 引用了两个组件 (注意，这两个组件在 \u003ccode\u003ehost\u003c/code\u003e 项目中并未定义)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e分别在两个项目下执行 \u003ccode\u003enpx webpack serve\u003c/code\u003e ，然后访问 \u003ccode\u003ehost\u003c/code\u003e 的开发地址 \u003ccode\u003ehttp://localhost:8080/\u003c/code\u003e 效果如图所示，接着尝试修改 \u003ccode\u003eremote\u003c/code\u003e 中的 \u003ccode\u003ecomponents/Header.jsx\u003c/code\u003e 发现页面中也相应发生变化\u003c/p\u003e\n\u003cp\u003e🤔\u003c/p\u003e\n\u003cp\u003e也就是说，我们在 \u003ccode\u003ehost\u003c/code\u003e 中引用了 \u003ccode\u003eremote\u003c/code\u003e 中的组件？😱\u003c/p\u003e\n\u003cp\u003e对的，这就是 webpack5 提供的新特性 ModuleFederation ，中文直译模块联邦\u003c/p\u003e\n\u003cp\u003e联邦模块有两个主要概念： \u003ccode\u003ehost\u003c/code\u003e （消费其他 \u003ccode\u003eremote\u003c/code\u003e ）和 \u003ccode\u003eremote\u003c/code\u003e （被 \u003ccode\u003ehost\u003c/code\u003e 消费）。 每个项目可以是 \u003ccode\u003ehost\u003c/code\u003e 也可以是 \u003ccode\u003eremote\u003c/code\u003e ，也可以两个都是。可以通过 webpack 配置来区分，可以参考上述的例子\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cp\u003e作为 \u003ccode\u003ehost\u003c/code\u003e 需要配置 \u003ccode\u003eremotes\u003c/code\u003e 列表\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e作为 \u003ccode\u003eremote\u003c/code\u003e 需要配置项目名（ \u003ccode\u003ename\u003c/code\u003e ），打包后的文件名（ \u003ccode\u003efilename\u003c/code\u003e ），提供的模块（ \u003ccode\u003eexposes\u003c/code\u003e ）\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e而且想要开启这一特性，只需要少许的配置即可\u003c/p\u003e\n\u003cp\u003e在需要共享的项目中，即上述的 \u003ccode\u003eremote\u003c/code\u003e 中，添加这个 webpack 配置\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eModuleFederationPlugin\u003c/span\u003e } = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;webpack\u0026quot;\u003c/span\u003e).\u003cspan class=\"hljs-property\"\u003econtainer\u003c/span\u003e;\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-attr\"\u003eplugins\u003c/span\u003e: [\n    \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n    \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eModuleFederationPlugin\u003c/span\u003e({\n      \u003cspan class=\"hljs-comment\"\u003e// 当前应用的名字，全局唯一ID，通过 name/{expose} 的方式使用\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;remote\u0026quot;\u003c/span\u003e,\n      \u003cspan class=\"hljs-comment\"\u003e// *可选，打包方式，与 name 保持一致即可\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003elibrary\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;var\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;remote\u0026quot;\u003c/span\u003e },\n      \u003cspan class=\"hljs-comment\"\u003e// 共享组件/模块打包后所在的文件，使用者直接导入这个文件即可\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003efilename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;remoteEntry.js\u0026quot;\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eexposes\u003c/span\u003e: {\n        \u003cspan class=\"hljs-comment\"\u003e// 这里便是我们要共享的模块/组件，引用方式为 import(name/{expose})，比如 import(\u0026#x27;remote/Button\u0026#x27;)\u003c/span\u003e\n        \u003cspan class=\"hljs-string\"\u003e\u0026quot;./Button\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;./src/components/Button.jsx\u0026quot;\u003c/span\u003e,\n        \u003cspan class=\"hljs-string\"\u003e\u0026quot;./Header\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;./src/components/Header.jsx\u0026quot;\u003c/span\u003e,\n      },\n      \u003cspan class=\"hljs-comment\"\u003e// 在这里指定需要共享的package\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eshared\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003ereact\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003esingleton\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003erequiredVersion\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;^18.1.0\u0026quot;\u003c/span\u003e },\n        \u003cspan class=\"hljs-string\"\u003e\u0026quot;react-dom\u0026quot;\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003esingleton\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003erequiredVersion\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;^18.1.0\u0026quot;\u003c/span\u003e },\n      },\n    }),\n  ],\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e同时，在需要引用这些组件的项目中，即上述的\u003ccode\u003ehost\u003c/code\u003e项目，webpack 配置文件中新增这些配置\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eModuleFederationPlugin\u003c/span\u003e } = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;webpack\u0026quot;\u003c/span\u003e).\u003cspan class=\"hljs-property\"\u003econtainer\u003c/span\u003e;\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = {\n  \u003cspan class=\"hljs-attr\"\u003eplugins\u003c/span\u003e: [\n    \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eModuleFederationPlugin\u003c/span\u003e({\n      \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;host\u0026quot;\u003c/span\u003e,\n      \u003cspan class=\"hljs-comment\"\u003e// 表示当前应用是一个 Host，可以引用 remote 中 expose 的模块\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eremotes\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003eremote\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;remote@http://localhost:8081/remoteEntry.js\u0026quot;\u003c/span\u003e,\n      },\n      \u003cspan class=\"hljs-comment\"\u003e// 在这里指定需要共享的package\u003c/span\u003e\n      \u003cspan class=\"hljs-comment\"\u003e// 在使用 Module Federation 时，Host、Remote 必须配置一致的 shared 这样才会生效\u003c/span\u003e\n      \u003cspan class=\"hljs-attr\"\u003eshared\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003ereact\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003esingleton\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003erequiredVersion\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;^18.1.0\u0026quot;\u003c/span\u003e },\n        \u003cspan class=\"hljs-string\"\u003e\u0026quot;react-dom\u0026quot;\u003c/span\u003e: { \u003cspan class=\"hljs-attr\"\u003esingleton\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e, \u003cspan class=\"hljs-attr\"\u003erequiredVersion\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;^18.1.0\u0026quot;\u003c/span\u003e },\n      },\n    }),\n  ],\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e在这里，我们也可以简单得分析一下 host 应用加载的 js 文件\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/img/webpack-mf-1.png\" alt=\"webpack ModuleFederation配置shared的构建文件\"\u003e\u003c/p\u003e\n\u003cp\u003e如图所示，在本示例中 host 加载了三个 remote 的文件\u003ccode\u003eremoteEntry.js\u003c/code\u003e和\u003ccode\u003esrc_components_Header_jsx.js\u003c/code\u003e与\u003ccode\u003esrc_components_Button_jsx.js\u003c/code\u003e，其中后两者是加载的组件代码，\u003ccode\u003eremoteEntry.js\u003c/code\u003e是入口文件，可以发现并没有加载 react 相关的源码，这是因为我们配置了\u003ccode\u003eshared\u003c/code\u003e，这样 remote 就可以和 host 共用一套 react（在这里，react 是被打包进\u003ccode\u003emain.js\u003c/code\u003e中）。如果没有配置\u003ccode\u003eshared\u003c/code\u003e选项，那么会单独加载一份 react 代码\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/img/webpack-mf-2.png\" alt=\"webpack ModuleFederation未配置shared的构建文件\"\u003e\u003c/p\u003e\n\u003cp\u003e可以看到，这时会单独加载一份react源码\u003c/p\u003e\n\n      \u003ch2\u003e\n        \u003cspan class=\"prefix\"\u003e\u003c/span\u003e\n        \u003cspan class=\"content\"\u003eWHY\u003c/span\u003e\n        \u003cspan class=\"suffix\"\u003e\u003c/span\u003e\n      \u003c/h2\u003e\n    \u003cp\u003e在构建工具层面上对模块共享、模块加载做一些扩展、优化\u003c/p\u003e\n\n      \u003ch2\u003e\n        \u003cspan class=\"prefix\"\u003e\u003c/span\u003e\n        \u003cspan class=\"content\"\u003eHOW\u003c/span\u003e\n        \u003cspan class=\"suffix\"\u003e\u003c/span\u003e\n      \u003c/h2\u003e\n    \u003cp\u003e修改了 \u003ccode\u003ewebpack_require\u003c/code\u003e 的部分实现，在 \u003ccode\u003erequire\u003c/code\u003e 的时候从远程加载资源，缓存到全局对象 \u003ccode\u003ewindow[\u0026quot;webpackChunk\u0026quot;+appName]\u003c/code\u003e 中，然后合并到 \u003ccode\u003ewebpack_modules\u003c/code\u003e 中\u003c/p\u003e\n\u003cp\u003ewebpack 每次打包都会将资源全部包裹在一个立即执行函数里面，这样虽然避免了全局环境的污染，但也使得外部不能访问内部模块。 在这个立即执行函数里面，webpack 使用 \u003ccode\u003ewebpack_modules\u003c/code\u003e 对象保存所有的模块代码，然后用内部定义的 \u003ccode\u003ewebpack_require\u003c/code\u003e 方法从 \u003ccode\u003ewebpack_modules\u003c/code\u003e 中加载模块。并且在异步加载和文件拆分两种情况下向全局暴露一个 \u003ccode\u003ewebpackChunk\u003c/code\u003e 数组用于沟通多个 webpack 资源，这个数组通过被 webpack 重写 \u003ccode\u003epush\u003c/code\u003e 方法，会在其他资源向 \u003ccode\u003ewebpackChunk\u003c/code\u003e 数组中新增内容时同步添加到 \u003ccode\u003ewebpack_modules\u003c/code\u003e 中从而实现模块整合\u003c/p\u003e\n\n      \u003ch2\u003e\n        \u003cspan class=\"prefix\"\u003e\u003c/span\u003e\n        \u003cspan class=\"content\"\u003e参考\u003c/span\u003e\n        \u003cspan class=\"suffix\"\u003e\u003c/span\u003e\n      \u003c/h2\u003e\n    \u003cp\u003e\u003ca href=\"https://www.zoo.team/article/webpack-modular\"\u003e模块联邦浅析\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://webpack.docschina.org/concepts/module-federation/#Uncaught-Error-Shared-module-is-not-available-for-eager-consumption\"\u003ewebpack 中文文档\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/module-federation/module-federation-examples/tree/master/basic-host-remote\"\u003emodule-federation-examples/basic-host-remote\u003c/a\u003e\u003c/p\u003e\n"}},"__N_SSG":true},"page":"/post/[title]","query":{"title":"webpack学习-ModuleFederation"},"buildId":"HbYP_GwUE9gOGOO8F4jR8","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>