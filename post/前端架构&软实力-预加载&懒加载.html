<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Mr.RS的个人博客-前端架构&amp;软实力-预加载&amp;懒加载</title><meta name="next-head-count" content="3"/><link rel="preload" href="/next-blog/_next/static/css/1bf96eec8dc413e7.css" as="style"/><link rel="stylesheet" href="/next-blog/_next/static/css/1bf96eec8dc413e7.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/next-blog/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/next-blog/_next/static/chunks/webpack-cf185e4b59cdddcf.js" defer=""></script><script src="/next-blog/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/next-blog/_next/static/chunks/main-1c9e93b8392c1bc9.js" defer=""></script><script src="/next-blog/_next/static/chunks/pages/_app-ca6aae25bc99a05f.js" defer=""></script><script src="/next-blog/_next/static/chunks/899-1cd3a59abdb8ea18.js" defer=""></script><script src="/next-blog/_next/static/chunks/pages/post/%5Btitle%5D-406bad804ceffd1d.js" defer=""></script><script src="/next-blog/_next/static/VEO_ERUabz6t4SXdQFN9R/_buildManifest.js" defer=""></script><script src="/next-blog/_next/static/VEO_ERUabz6t4SXdQFN9R/_ssgManifest.js" defer=""></script><script src="/next-blog/_next/static/VEO_ERUabz6t4SXdQFN9R/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><header class="fixed top-0 py-4 left-0 right-0 h-auto px-10 shadow bg-white z-50"><nav><ul class="flex w-auto"><li class="mr-4 hover:text-yellow"><a href="/next-blog">首页</a></li><li class="mx-4 hover:text-yellow"><a href="/next-blog/categories">分类</a></li><li class="mx-4 hover:text-yellow"><a href="/next-blog/tags">标签</a></li><li class="ml-4 hover:text-yellow"><a href="/next-blog/timeline">归档</a></li></ul></nav></header><main class="mt-20 mb-4 mx-auto justify-center w-2/3"><div class="mx-auto lg:max-w-5xl md:max-w-3xl"><article class="flex flex-col justify-around pb-16 px-4 mx-auto space-y-10 text-base"><div class="flex flex-col space-y-4"><h1 class="inline pt-10 text-4xl text-skin-primary">前端架构&amp;软实力-预加载&amp;懒加载</h1><div class="text-sm space-x-2 text-skin-muted"><span><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 inline-block mr-1"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>2020-04-24 21:17:04</span><span><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 inline-block mr-1"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>44</span></div></div><div class="mt-8 flex"><div class="w-full flex-auto custom-markdown-body"><div class="markdown-body" id="write"><h1 id="预加载">预加载</h1>
<h2 id="实现思路">实现思路</h2>
<p><code>new</code>一个新的<code>Imgnode</code>，给<code>Imgnode</code>的<code>src</code>赋值为真正的<code>src</code>；该<code>Imgnode</code>在加载完毕后相应的图片资源就会在本地缓存。</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">function</span>  <span class="hljs-title function_">preLoad</span> (...src) {
    src.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span>  =&gt;</span> {
        <span class="hljs-keyword">const</span>  imgNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>()
        imgNode.<span class="hljs-property">src</span> = realSrc
    })
}
</code></pre>
<h1 id="懒加载">懒加载</h1>
<h2 id="实现思路-1">实现思路</h2>
<p>首先设置一个临时属性 <code>data-src</code>，当前元素是否出现在视口时使用 <code>src</code> 代替 <code>data-src</code>。</p>
<ol>
<li><p><code>window.onscroll</code> + <code>clientTop</code>，<code>offsetTop</code>，<code>clientHeight</code> <code>scrollTop</code> + 节流 👎</p>
<p>不容易判断元素的位置</p>
</li>
<li><p><code>window.onscroll</code> + <code>Element.getBoundingClientRect()</code> + 节流👎</p>
<p><code>getBoundingClientRect</code>会触发回流</p>
</li>
<li><p><code>IntersectionObserver</code>👍</p>
<pre><code class="hljs language-js">&lt;img  style=<span class="hljs-string">&quot;width: 200px;&quot;</span>  id=<span class="hljs-string">&quot;img&quot;</span>  data-src=<span class="hljs-string">&quot;./assets/yoda.jpg&quot;</span>  alt=<span class="hljs-string">&quot;&quot;</span>  srcset=<span class="hljs-string">&quot;&quot;</span>&gt;

<span class="hljs-keyword">const</span>  observer = <span class="hljs-keyword">new</span>  <span class="hljs-title class_">IntersectionObserver</span>(<span class="hljs-function"><span class="hljs-params">changes</span>=&gt;</span> {
    changes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">change</span>  =&gt;</span> {
        <span class="hljs-comment">// change.isIntersecting 判断当前元素是否出现在视口中</span>
        <span class="hljs-keyword">if</span> (change.<span class="hljs-property">isIntersecting</span>) {
            <span class="hljs-keyword">const</span>  img = change.<span class="hljs-property">target</span>
            img.<span class="hljs-property">src</span> = img.<span class="hljs-property">dataset</span>.<span class="hljs-property">src</span>
            <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">deleteProperty</span>(img.<span class="hljs-property">dataset</span>, <span class="hljs-string">&quot;src&quot;</span>)
            observer.<span class="hljs-title function_">unobserve</span>(img)
        }
    })
})
observer.<span class="hljs-title function_">observe</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&quot;#img&quot;</span>))
</code></pre>
</li>
<li><p><code>img</code>的<code>lazy</code>属性 👎</p>
<p>兼容性差，<a href="https://www.jianguoyun.com/static/stackedit/%5Bhttps://www.zhangxinxu.com/wordpress/2019/09/native-img-loading-lazy/%5D(https://www.zhangxinxu.com/wordpress/2019/09/native-img-loading-lazy/)">具体实践</a></p>
<p><code>&lt;img loading=&quot;lazy&quot; src=&quot;http://blog.p18c.top/imgs/avatar.png&quot; alt=&quot;&quot; srcset=&quot;&quot;&gt;</code></p>
</li>
</ol>
<h1 id="预加载-vs-懒加载">预加载 VS 懒加载</h1>
<p>|      | 预加载                             | 懒加载                                      |
| </p>
</div></div></div></article></div></main><footer class="flex flex-col items-center justify-center leading-8 text-sm w-full py-2 border-t text-skin-muted"><p>Designed &amp; developed by<a class="ml-1 text-yellow" target="_blank" href="https://github.com/mrrs878" rel="noreferrer">Mr.RS</a></p><p>©<!-- --> <!-- -->2022</p></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"前端架构\u0026软实力-预加载\u0026懒加载","tags":["预加载\u0026懒加载"],"categories":"前端架构\u0026软实力","description":"# 预加载\n\n## 实现思路\n\n`new`一个新的`Imgnode`，给`Imgnode`的`src`赋值为真正的`src`；该`Imgnode`在加载完毕后相应的图片资源就会在本地缓存。\n\n```js\nfunction  preLoad (...src) {\n\tsrc.forEach(item  =\u003e {\n\t\tconst  imgNode = new Image()\n\t\timgNode.sr","createDate":"2020-04-24 21:17:04","updateDate":"2021-02-20 17:16:23","body":"\u003ch1 id=\"预加载\"\u003e预加载\u003c/h1\u003e\n\u003ch2 id=\"实现思路\"\u003e实现思路\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003enew\u003c/code\u003e一个新的\u003ccode\u003eImgnode\u003c/code\u003e，给\u003ccode\u003eImgnode\u003c/code\u003e的\u003ccode\u003esrc\u003c/code\u003e赋值为真正的\u003ccode\u003esrc\u003c/code\u003e；该\u003ccode\u003eImgnode\u003c/code\u003e在加载完毕后相应的图片资源就会在本地缓存。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e  \u003cspan class=\"hljs-title function_\"\u003epreLoad\u003c/span\u003e (...src) {\n    src.\u003cspan class=\"hljs-title function_\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eitem\u003c/span\u003e  =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e  imgNode = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eImage\u003c/span\u003e()\n        imgNode.\u003cspan class=\"hljs-property\"\u003esrc\u003c/span\u003e = realSrc\n    })\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch1 id=\"懒加载\"\u003e懒加载\u003c/h1\u003e\n\u003ch2 id=\"实现思路-1\"\u003e实现思路\u003c/h2\u003e\n\u003cp\u003e首先设置一个临时属性 \u003ccode\u003edata-src\u003c/code\u003e，当前元素是否出现在视口时使用 \u003ccode\u003esrc\u003c/code\u003e 代替 \u003ccode\u003edata-src\u003c/code\u003e。\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003ewindow.onscroll\u003c/code\u003e + \u003ccode\u003eclientTop\u003c/code\u003e，\u003ccode\u003eoffsetTop\u003c/code\u003e，\u003ccode\u003eclientHeight\u003c/code\u003e \u003ccode\u003escrollTop\u003c/code\u003e + 节流 👎\u003c/p\u003e\n\u003cp\u003e不容易判断元素的位置\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003ewindow.onscroll\u003c/code\u003e + \u003ccode\u003eElement.getBoundingClientRect()\u003c/code\u003e + 节流👎\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003egetBoundingClientRect\u003c/code\u003e会触发回流\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003eIntersectionObserver\u003c/code\u003e👍\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u0026lt;img  style=\u003cspan class=\"hljs-string\"\u003e\u0026quot;width: 200px;\u0026quot;\u003c/span\u003e  id=\u003cspan class=\"hljs-string\"\u003e\u0026quot;img\u0026quot;\u003c/span\u003e  data-src=\u003cspan class=\"hljs-string\"\u003e\u0026quot;./assets/yoda.jpg\u0026quot;\u003c/span\u003e  alt=\u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e  srcset=\u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e\u0026gt;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e  observer = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e  \u003cspan class=\"hljs-title class_\"\u003eIntersectionObserver\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003echanges\u003c/span\u003e=\u0026gt;\u003c/span\u003e {\n    changes.\u003cspan class=\"hljs-title function_\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003echange\u003c/span\u003e  =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-comment\"\u003e// change.isIntersecting 判断当前元素是否出现在视口中\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (change.\u003cspan class=\"hljs-property\"\u003eisIntersecting\u003c/span\u003e) {\n            \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e  img = change.\u003cspan class=\"hljs-property\"\u003etarget\u003c/span\u003e\n            img.\u003cspan class=\"hljs-property\"\u003esrc\u003c/span\u003e = img.\u003cspan class=\"hljs-property\"\u003edataset\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003esrc\u003c/span\u003e\n            \u003cspan class=\"hljs-title class_\"\u003eReflect\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003edeleteProperty\u003c/span\u003e(img.\u003cspan class=\"hljs-property\"\u003edataset\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026quot;src\u0026quot;\u003c/span\u003e)\n            observer.\u003cspan class=\"hljs-title function_\"\u003eunobserve\u003c/span\u003e(img)\n        }\n    })\n})\nobserver.\u003cspan class=\"hljs-title function_\"\u003eobserve\u003c/span\u003e(\u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003equerySelector\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;#img\u0026quot;\u003c/span\u003e))\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003cp\u003e\u003ccode\u003eimg\u003c/code\u003e的\u003ccode\u003elazy\u003c/code\u003e属性 👎\u003c/p\u003e\n\u003cp\u003e兼容性差，\u003ca href=\"https://www.jianguoyun.com/static/stackedit/%5Bhttps://www.zhangxinxu.com/wordpress/2019/09/native-img-loading-lazy/%5D(https://www.zhangxinxu.com/wordpress/2019/09/native-img-loading-lazy/)\"\u003e具体实践\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e\u0026lt;img loading=\u0026quot;lazy\u0026quot; src=\u0026quot;http://blog.p18c.top/imgs/avatar.png\u0026quot; alt=\u0026quot;\u0026quot; srcset=\u0026quot;\u0026quot;\u0026gt;\u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch1 id=\"预加载-vs-懒加载\"\u003e预加载 VS 懒加载\u003c/h1\u003e\n\u003cp\u003e|      | 预加载                             | 懒加载                                      |\n| \u003c/p\u003e\n"}},"__N_SSG":true},"page":"/post/[title]","query":{"title":"前端架构\u0026软实力-预加载\u0026懒加载"},"buildId":"VEO_ERUabz6t4SXdQFN9R","assetPrefix":"/next-blog","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>