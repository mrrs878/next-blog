<!DOCTYPE html><html><head><link rel="icon" href="https://mrrsblog.oss-cn-shanghai.aliyuncs.com/avatar.jpg"/><script async="" src="/js/L2Dwidget.min.js"></script><script async="" src="/js/initL2D.js"></script><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>Mr.RSçš„ä¸ªäººåšå®¢-JavaScriptå¤ä¹ -å¼‚æ­¥</title><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/15773988a510c3d3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/15773988a510c3d3.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-b927671265afed5e.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-1e7421553b9673ee.js" defer=""></script><script src="/_next/static/chunks/pages/_app-ca6aae25bc99a05f.js" defer=""></script><script src="/_next/static/chunks/899-1cd3a59abdb8ea18.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Btitle%5D-d89e1712c82a34ac.js" defer=""></script><script src="/_next/static/6Z6s6-Ql91pBaqq4AHUDJ/_buildManifest.js" defer=""></script><script src="/_next/static/6Z6s6-Ql91pBaqq4AHUDJ/_ssgManifest.js" defer=""></script><script src="/_next/static/6Z6s6-Ql91pBaqq4AHUDJ/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><header class="fixed top-0 py-4 left-0 right-0 h-auto px-10 shadow bg-white z-50"><nav><ul class="flex w-auto"><li class="mr-4 hover:text-yellow"><a href="/">é¦–é¡µ</a></li><li class="mx-4 hover:text-yellow"><a href="/categories">åˆ†ç±»</a></li><li class="mx-4 hover:text-yellow"><a href="/tags">æ ‡ç­¾</a></li><li class="ml-4 hover:text-yellow"><a href="/timeline">å½’æ¡£</a></li></ul></nav></header><main class="mt-20 mb-4 mx-auto justify-center w-2/3"><div class="mx-auto lg:max-w-5xl md:max-w-3xl"><article class="flex flex-col justify-around pb-16 px-4 mx-auto space-y-10 text-base"><div class="flex flex-col space-y-4"><h1 class="inline pt-10 text-4xl text-skin-primary">JavaScriptå¤ä¹ -å¼‚æ­¥</h1><div class="text-sm space-x-2 text-skin-muted grid grid-cols-5"><span class="flex align-middle"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 inline-block mr-1"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>2021-05-12 10:36:56</span><span class="flex align-middle"><svg class="w-5 h-5 inline-block mr-1" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1903" width="20" height="20"><path d="M257.7 752c2 0 4-0.2 6-0.5L431.9 722c2-0.4 3.9-1.3 5.3-2.8l423.9-423.9c3.9-3.9 3.9-10.2 0-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2c-1.9 11.1 1.5 21.9 9.4 29.8 6.6 6.4 14.9 9.9 23.8 9.9z m67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z" p-id="1904"></path></svg>2021-06-24 18:47:28</span></div></div><div class="mt-8 flex"><div class="w-full flex-auto custom-markdown-body"><div class="markdown-body" id="write"><p>JavaScriptä¸ºå¼‚æ­¥éé˜»å¡ï¼ŒES6ä¹‹å‰ä¸»è¦é å›è°ƒå‡½æ•°æ¥å®ç°å¼‚æ­¥ï¼Œä½†ç”±äºå›è°ƒå‡½æ•°å®¹æ˜“å‡ºç°å›è°ƒåœ°ç‹±ç­‰é—®é¢˜ï¼Œäºæ˜¯ES6+æä¾›äº†äº†<code>Generator</code>ã€<code>Promise</code>ã€<code>async/await</code>è¿™äº›APIæ¥é™ä½å¼‚æ­¥ç¼–ç¨‹çš„éš¾åº¦ä¸å¤æ‚åº¦ã€‚</p>

      <h2>
        <span class="prefix"></span>
        <span class="content">å›è°ƒå‡½æ•°</span>
        <span class="suffix"></span>
      </h2>
    <p>å›è°ƒå‡½æ•°å®¹æ˜“å‡ºç°å›è°ƒåœ°ç‹±ï¼Œå¯è¯»æ€§å·®</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ajax</span>(<span class="hljs-params">url, options, onSuccess</span>) {
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-title function_">ajax</span>(<span class="hljs-string">&#x27;/api/xxx&#x27;</span>, {}, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
    <span class="hljs-title function_">ajax</span>(<span class="hljs-string">&#x27;/api/yyy&#x27;</span>, {}, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
        <span class="hljs-title function_">ajax</span>(<span class="hljs-string">&#x27;/api/zzz&#x27;</span>, (), <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
        })
    })
})
</code></pre>

      <h3>
        <span class="prefix"></span>
        <span class="content">Generator</span>
        <span class="suffix"></span>
      </h3>
    <p>å½¢å¼ä¸Šï¼Œ<code>generator</code>å‡½æ•°æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œå°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€ã€‚æ‰§è¡Œ<code>generator</code>å‡½æ•°ä¼šè¿”å›ä¸€ä¸ª<strong>éå†å™¨å¯¹è±¡</strong></p>
<p>è¯­æ³•ä¸Šï¼Œ<code>generator</code>å‡½æ•°æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ã€‚<code>function</code>å…³é”®å­—ä¸å‡½æ•°åä¹‹é—´æœ‰ä¸€ä¸ª<code>*</code>ï¼›å‡½æ•°ä½“å†…ä½¿ç”¨<code>yield</code>è¡¨è¾¾å¼å®šä¹‰ä¸åŒçš„å†…éƒ¨çŠ¶æ€</p>
<p>ä¸æ™®é€šå‡½æ•°ä¸åŒï¼Œ<code>generator</code>å‡½æ•°è¢«è°ƒç”¨å<strong>å¹¶ä¸æ‰§è¡Œ</strong>ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªæŒ‡å‘å†…éƒ¨çŠ¶æ€çš„æŒ‡é’ˆå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯<strong>éå†å™¨å¯¹è±¡</strong>ã€‚ä¸‹ä¸€æ­¥ï¼Œ<strong>å¿…é¡»è°ƒç”¨éå†å™¨å¯¹è±¡çš„<code>next</code>æ–¹æ³•</strong>ä½¿å¾—æŒ‡é’ˆç§»å‘ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡è°ƒç”¨<code>next</code>æ–¹æ³•ï¼Œå†…éƒ¨æŒ‡é’ˆå°±ä»å‡½æ•°å¤´éƒ¨æˆ–ä¸Šä¸€æ¬¡åœä¸‹æ¥çš„åœ°æ–¹å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª<code>yield</code>æˆ–<code>return</code></p>
<pre><code class="hljs language-js"><span class="hljs-keyword">function</span>* <span class="hljs-title function_">gen</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> str1 = <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;hello&quot;</span>
  <span class="hljs-comment">// str1 = 222</span>
  <span class="hljs-keyword">const</span> str2 = <span class="hljs-keyword">yield</span> <span class="hljs-string">&quot;world&quot;</span>
  <span class="hljs-comment">// str2 = 333</span>
  <span class="hljs-keyword">return</span> str2
}

<span class="hljs-keyword">const</span> iter = <span class="hljs-title function_">gen</span>()
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(iter.<span class="hljs-title function_">next</span>())
<span class="hljs-comment">// { value: &quot;hello&quot;, done: false }</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(iter.<span class="hljs-title function_">next</span>(<span class="hljs-number">222</span>))
<span class="hljs-comment">// { value: &quot;world&quot;, done: false }</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(iter.<span class="hljs-title function_">next</span>(<span class="hljs-number">333</span>))
<span class="hljs-comment">// { value: 333, done: false }</span>
</code></pre>
<p>ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œ<code>generator</code>å‡½æ•°å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ç¬¬ä¸€ä¸ª<code>yield</code>è¡¨è¾¾å¼ä¸ºæ­¢ã€‚<code>next</code>æ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„<code>value</code>å€¼å°±æ˜¯å½“å‰<code>yield</code>è¡¨è¾¾å¼çš„å€¼ï¼Œ<code>done</code>çš„å€¼ä¸º<code>false</code></p>
<p>ç¬¬äºŒæ¬¡è°ƒç”¨ï¼Œ<code>generator</code>ä»ä¸Šæ¬¡<code>yield</code>è¡¨è¾¾å¼åœä¸‹æ¥çš„åœ°æ–¹ä¸€ç›´æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ª<code>yield</code>è¡¨è¾¾å¼ ğŸ‘† â€¦â€¦</p>
<p>ç¬¬ä¸‰æ¬¡è°ƒç”¨ï¼Œ<code>generator</code>å‡½æ•°ä»ä¸Šæ¬¡<code>yield</code>è¡¨è¾¾å¼åœä¸‹æ¥çš„åœ°æ–¹ä¸€ç›´æ‰§è¡Œåˆ°<code>return</code>è¯­å¥ï¼Œ<code>next</code>è¿”å›çš„<code>value</code>å€¼å°±æ˜¯<code>return</code>åé¢è¡¨è¾¾å¼çš„å€¼ï¼Œ<code>done</code>ä¸º<code>true</code></p>
<p><code>yield</code>è¡¨è¾¾å¼æœ¬èº«æ²¡æœ‰è¿”å›å€¼ï¼ˆæˆ–è€…è¯´æ€»æ˜¯è¿”å›<code>undefined</code>ï¼‰ã€‚<code>next</code>æ–¹æ³•å¯ä»¥å¸¦ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°ä¼šè¢«å½“ä½œ<strong>ä¸Šä¸€ä¸ª</strong><code>yield</code>è¡¨è¾¾å¼çš„è¿”å›å€¼</p>

      <h2>
        <span class="prefix"></span>
        <span class="content">Promise</span>
        <span class="suffix"></span>
      </h2>
    <p>ES6æä¾›çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹æ–¹æ¡ˆ</p>
<p>ä¸€ä¸ª<code>Promise</code>å¯¹è±¡å¿…ç„¶å¤„äºä»¥ä¸‹ä¸‰ç§çŠ¶æ€ï¼š</p>
<ul>
<li>pendingï¼Œåˆå§‹çŠ¶æ€</li>
<li>fulfilledï¼ŒæˆåŠŸ</li>
<li>rejectedï¼Œå¤±è´¥</li>
</ul>
<p><code>pending</code>çŠ¶æ€çš„<code>Promise</code>å¯¹è±¡å¯ä»¥è½¬æ¢ä¸º<code>fulfilled</code>æˆ–<code>rejected</code>çŠ¶æ€ï¼Œè€Œä¸”æ­¤è¿‡ç¨‹æ˜¯ä¸å¯é€†çš„ã€‚å½“çŠ¶æ€å˜æ›´æ—¶ï¼Œ<code>then()</code>æ–¹æ³•æ³¨å†Œçš„å›è°ƒå°±ä¼šè¢«è°ƒç”¨</p>
<p><code>then()</code> æˆ–è€… <code>catch()</code> çš„å‚æ•°æœŸæœ›æ˜¯å‡½æ•°ï¼Œä¼ â¼Šâ¾®å‡½æ•°åˆ™ä¼šå‘â½£å€¼é€ä¼ <code>(value =&gt; value)</code></p>
<pre><code class="hljs language-js"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>)
 .<span class="hljs-title function_">then</span>(<span class="hljs-number">2</span>) <span class="hljs-comment">// .then(1 =&gt; 1)</span>
 .<span class="hljs-title function_">then</span>(<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">3</span>)) <span class="hljs-comment">// .then(1 =&gt; 1)</span>
 .<span class="hljs-title function_">then</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>)
<span class="hljs-comment">// 1</span>
</code></pre>
<pre><code class="hljs language-js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-params">url, options = {}</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();
    xhr.<span class="hljs-title function_">open</span>(options.<span class="hljs-property">method</span> || <span class="hljs-string">&#x27;GET&#x27;</span>, url);
    <span class="hljs-keyword">const</span> headers = { <span class="hljs-string">&#x27;Content-Type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>, ...options.<span class="hljs-property">headers</span> || {} };
    <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">ownKeys</span>(headers)
      .<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">header</span>) =&gt;</span> xhr.<span class="hljs-title function_">setRequestHeader</span>(header, headers[header]));
    xhr.<span class="hljs-title function_">send</span>(options.<span class="hljs-property">method</span> === <span class="hljs-string">&#x27;POST&#x27;</span> ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(options.<span class="hljs-property">data</span> || {}) : <span class="hljs-literal">null</span>);
    xhr.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> <span class="hljs-title function_">reject</span>(e);
    xhr.<span class="hljs-property">onreadystatechange</span> = <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">readyState</span> === <span class="hljs-title class_">XMLHttpRequest</span>.<span class="hljs-property">DONE</span>
        &amp;&amp; [<span class="hljs-number">200</span>, <span class="hljs-number">201</span>, <span class="hljs-number">301</span>, <span class="hljs-number">302</span>, <span class="hljs-number">304</span>].<span class="hljs-title function_">includes</span>(xhr.<span class="hljs-property">status</span>)) {
        <span class="hljs-title function_">resolve</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(xhr.<span class="hljs-property">responseText</span>));
      }
    };
  });
}
<span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;http://localhost:3004/get&#x27;</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);
}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e);
})
</code></pre>
<pre><code class="hljs language-js"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>)=&gt;</span>{
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;1&quot;</span>)
    <span class="hljs-title function_">resolve</span>();
}).<span class="hljs-title function_">then</span>(<span class="hljs-function">()=&gt;</span>{
    <span class="hljs-comment">// å¤–éƒ¨ç¬¬1ä¸ªthen</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;2&quot;</span>)
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>)=&gt;</span>{
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;3&quot;</span>)
        <span class="hljs-title function_">resolve</span>();
    }).<span class="hljs-title function_">then</span>(<span class="hljs-function">()=&gt;</span>{
        <span class="hljs-comment">// å†…éƒ¨ç¬¬1ä¸ªthen</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;4&quot;</span>)
    }).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-comment">// å†…éƒ¨ç¬¬2ä¸ªthen</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;5&quot;</span>)
    })
}).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>)=&gt;</span>{
    <span class="hljs-comment">// å¤–éƒ¨ç¬¬2ä¸ªthen</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;6&quot;</span>)
})
</code></pre>
<p>ç®€å•æ¥è®²å°±æ˜¯thenå›è°ƒçš„æ³¨å†Œéœ€è¦ä¸Šä¸€ä¸ªthené‡Œé¢çš„åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•</p>
<p>æ‹¿ä¸Šé¢çš„ä»£ç æ¥è®²ï¼Œå½“å¤–éƒ¨ç¬¬1ä¸ªthené‡Œçš„resovle()æ‰§è¡Œå®Œæ¯•åï¼Œè¯¥Promiseçš„çŠ¶æ€å·²ç»æ›´æ”¹ï¼Œä¼šå°†å†…éƒ¨ç¬¬1ä¸ªthenå›è°ƒæ·»åŠ ï¼ˆæ³¨å†Œï¼‰åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼›å†…éƒ¨ç¬¬2ä¸ªthenç”±äºä¸Šä¸€ä¸ªthenå›è°ƒæ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œå› æ­¤ä¸ä¼šæ³¨å†Œã€‚æ­¤æ—¶å¤–éƒ¨ç¬¬1ä¸ªthené‡Œçš„åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œä¼šæ³¨å†Œå¤–éƒ¨ç¬¬2ä¸ªthenå›è°ƒ</p>
<p>æ•´ç†ä¸€ä¸‹ï¼šthenå›è°ƒæ³¨å†Œçš„é¡ºåºæ˜¯ï¼šå¤–éƒ¨ç¬¬1ä¸ªthen --&gt; å†…éƒ¨ç¬¬1ä¸ªthen --&gt; å¤–éƒ¨ç¬¬2ä¸ªthen --&gt; å†…éƒ¨ç¬¬2ä¸ªthen</p>
<p>ps: å¦‚æœå°†å¤–éƒ¨ç¬¬1ä¸ªthené‡Œçš„new Promise(xxx)æ”¹ä¸ºreturn new Promise(xxx)çš„è¯å†…éƒ¨ç¬¬2ä¸ªthençš„æ³¨å†Œå°†æ—©äº* å¤–éƒ¨ç¬¬2ä¸ªthen*</p>

      <h2>
        <span class="prefix"></span>
        <span class="content">async/await</span>
        <span class="suffix"></span>
      </h2>
    <p>ç›®å‰æ¥è®²ï¼Œæœ€ä¸ºä¼˜ç§€çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹æ–¹æ¡ˆï¼Œä¸ES2017æå‡º</p>
<p>å®ç°ä¸Šæ˜¯<code>Generator</code>+<code>Promise</code>çš„è¯­æ³•ç³–</p>
<p>é€šè¿‡åœ¨<code>onFulFilled()</code>é‡Œè°ƒç”¨<code>next()</code>ã€åœ¨<code>next()</code>é‡Œè°ƒç”¨<code>onFulfilled()</code>å½¢æˆä¸€ä¸ªè‡ªæ‰§è¡Œå™¨ï¼Œåªæœ‰å½“å…¨éƒ¨ä»£ç æ‰§è¡Œå®Œæ¯•åæ‰ä¼šç»ˆæ­¢</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;http://localhost:3004/get&#x27;</span>);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e);
    }
}
</code></pre>
<p><code>async/await</code>åŸç†: <strong>è‡ªåŠ¨æ‰§è¡Œgeneratorå‡½æ•°</strong></p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">getData</span> = (<span class="hljs-params"></span>) =&gt;
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-string">&quot;data&quot;</span>), <span class="hljs-number">1000</span>));

<span class="hljs-keyword">function</span>* <span class="hljs-title function_">testG</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// awaitè¢«ç¼–è¯‘æˆäº†yield</span>
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">yield</span> <span class="hljs-title function_">getData</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;data: &quot;</span>, data);
  <span class="hljs-keyword">const</span> data2 = <span class="hljs-keyword">yield</span> <span class="hljs-title function_">getData</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;data2: &quot;</span>, data2);
  <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">asyncToGenerator</span>(<span class="hljs-params">generatorFunc</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">const</span> gen = generatorFunc.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">function</span> <span class="hljs-title function_">step</span>(<span class="hljs-params">key, arg</span>) {
        <span class="hljs-keyword">let</span> generatorResult;
        <span class="hljs-keyword">try</span> {
          generatorResult = gen[key](arg);
        } <span class="hljs-keyword">catch</span> (error) {
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(error);
        }

        <span class="hljs-keyword">const</span> { value, done } = generatorResult;

        <span class="hljs-keyword">if</span> (done) {
          <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolve</span>(value);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(value).<span class="hljs-title function_">then</span>(
            <span class="hljs-keyword">function</span> <span class="hljs-title function_">onResolve</span>(<span class="hljs-params">val</span>) {
              <span class="hljs-title function_">step</span>(<span class="hljs-string">&quot;next&quot;</span>, val);
            },
            <span class="hljs-keyword">function</span> <span class="hljs-title function_">onReject</span>(<span class="hljs-params">err</span>) {
              <span class="hljs-title function_">step</span>(<span class="hljs-string">&quot;throw&quot;</span>, err);
            }
          );
        }
      }
      <span class="hljs-title function_">step</span>(<span class="hljs-string">&quot;next&quot;</span>);
    });
  };
}

<span class="hljs-keyword">const</span> testGAsync = <span class="hljs-title function_">asyncToGenerator</span>(testG);
<span class="hljs-title function_">testGAsync</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result);
});
</code></pre>

      <h2>
        <span class="prefix"></span>
        <span class="content">å‚è€ƒ</span>
        <span class="suffix"></span>
      </h2>
    <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise">MDN-Promise</a></p>
<p><a href="https://github.com/imtaotao/co-share">co-share</a></p>
</div></div></div></article></div></main><footer class="flex flex-col items-center justify-center leading-8 text-sm w-full py-2 border-t text-skin-muted"><p>Designed &amp; developed by<a class="ml-1 text-yellow" target="_blank" href="https://github.com/mrrs878" rel="noreferrer">Mr.RS</a></p><p>Â©<!-- --> <!-- -->2024</p></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"JavaScriptå¤ä¹ -å¼‚æ­¥","tags":["JavaScript","Promise","Generator","Promise"],"categories":"2021å¤ä¹ ","description":"JavaScriptä¸ºå¼‚æ­¥éé˜»å¡ï¼ŒES6ä¹‹å‰ä¸»è¦é å›è°ƒå‡½æ•°æ¥å®ç°å¼‚æ­¥ï¼Œä½†ç”±äºå›è°ƒå‡½æ•°å®¹æ˜“å‡ºç°å›è°ƒåœ°ç‹±ç­‰é—®é¢˜ï¼Œäºæ˜¯ES6+æä¾›äº†äº†`Generator`ã€`Promise`ã€`async/await`è¿™äº›APIæ¥é™ä½å¼‚æ­¥ç¼–ç¨‹çš„éš¾åº¦ä¸å¤æ‚åº¦ã€‚\n\n## å›è°ƒå‡½æ•°\n\nå›è°ƒå‡½æ•°å®¹æ˜“å‡ºç°å›è°ƒåœ°ç‹±ï¼Œå¯è¯»æ€§å·®\n\n``` js\nfunction ajax(url, options, onSuccess) {","createDate":"2021-05-12 10:36:56","updateDate":"2021-06-24 18:47:28","body":"\u003cp\u003eJavaScriptä¸ºå¼‚æ­¥éé˜»å¡ï¼ŒES6ä¹‹å‰ä¸»è¦é å›è°ƒå‡½æ•°æ¥å®ç°å¼‚æ­¥ï¼Œä½†ç”±äºå›è°ƒå‡½æ•°å®¹æ˜“å‡ºç°å›è°ƒåœ°ç‹±ç­‰é—®é¢˜ï¼Œäºæ˜¯ES6+æä¾›äº†äº†\u003ccode\u003eGenerator\u003c/code\u003eã€\u003ccode\u003ePromise\u003c/code\u003eã€\u003ccode\u003easync/await\u003c/code\u003eè¿™äº›APIæ¥é™ä½å¼‚æ­¥ç¼–ç¨‹çš„éš¾åº¦ä¸å¤æ‚åº¦ã€‚\u003c/p\u003e\n\n      \u003ch2\u003e\n        \u003cspan class=\"prefix\"\u003e\u003c/span\u003e\n        \u003cspan class=\"content\"\u003eå›è°ƒå‡½æ•°\u003c/span\u003e\n        \u003cspan class=\"suffix\"\u003e\u003c/span\u003e\n      \u003c/h2\u003e\n    \u003cp\u003eå›è°ƒå‡½æ•°å®¹æ˜“å‡ºç°å›è°ƒåœ°ç‹±ï¼Œå¯è¯»æ€§å·®\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eajax\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eurl, options, onSuccess\u003c/span\u003e) {\n    \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n}\n\n\u003cspan class=\"hljs-title function_\"\u003eajax\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;/api/xxx\u0026#x27;\u003c/span\u003e, {}, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-title function_\"\u003eajax\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;/api/yyy\u0026#x27;\u003c/span\u003e, {}, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n        \u003cspan class=\"hljs-title function_\"\u003eajax\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;/api/zzz\u0026#x27;\u003c/span\u003e, (), \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n        })\n    })\n})\n\u003c/code\u003e\u003c/pre\u003e\n\n      \u003ch3\u003e\n        \u003cspan class=\"prefix\"\u003e\u003c/span\u003e\n        \u003cspan class=\"content\"\u003eGenerator\u003c/span\u003e\n        \u003cspan class=\"suffix\"\u003e\u003c/span\u003e\n      \u003c/h3\u003e\n    \u003cp\u003eå½¢å¼ä¸Šï¼Œ\u003ccode\u003egenerator\u003c/code\u003eå‡½æ•°æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œå°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€ã€‚æ‰§è¡Œ\u003ccode\u003egenerator\u003c/code\u003eå‡½æ•°ä¼šè¿”å›ä¸€ä¸ª\u003cstrong\u003eéå†å™¨å¯¹è±¡\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eè¯­æ³•ä¸Šï¼Œ\u003ccode\u003egenerator\u003c/code\u003eå‡½æ•°æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ã€‚\u003ccode\u003efunction\u003c/code\u003eå…³é”®å­—ä¸å‡½æ•°åä¹‹é—´æœ‰ä¸€ä¸ª\u003ccode\u003e*\u003c/code\u003eï¼›å‡½æ•°ä½“å†…ä½¿ç”¨\u003ccode\u003eyield\u003c/code\u003eè¡¨è¾¾å¼å®šä¹‰ä¸åŒçš„å†…éƒ¨çŠ¶æ€\u003c/p\u003e\n\u003cp\u003eä¸æ™®é€šå‡½æ•°ä¸åŒï¼Œ\u003ccode\u003egenerator\u003c/code\u003eå‡½æ•°è¢«è°ƒç”¨å\u003cstrong\u003eå¹¶ä¸æ‰§è¡Œ\u003c/strong\u003eï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªæŒ‡å‘å†…éƒ¨çŠ¶æ€çš„æŒ‡é’ˆå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯\u003cstrong\u003eéå†å™¨å¯¹è±¡\u003c/strong\u003eã€‚ä¸‹ä¸€æ­¥ï¼Œ\u003cstrong\u003eå¿…é¡»è°ƒç”¨éå†å™¨å¯¹è±¡çš„\u003ccode\u003enext\u003c/code\u003eæ–¹æ³•\u003c/strong\u003eä½¿å¾—æŒ‡é’ˆç§»å‘ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡è°ƒç”¨\u003ccode\u003enext\u003c/code\u003eæ–¹æ³•ï¼Œå†…éƒ¨æŒ‡é’ˆå°±ä»å‡½æ•°å¤´éƒ¨æˆ–ä¸Šä¸€æ¬¡åœä¸‹æ¥çš„åœ°æ–¹å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª\u003ccode\u003eyield\u003c/code\u003eæˆ–\u003ccode\u003ereturn\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e* \u003cspan class=\"hljs-title function_\"\u003egen\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e str1 = \u003cspan class=\"hljs-keyword\"\u003eyield\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;hello\u0026quot;\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// str1 = 222\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e str2 = \u003cspan class=\"hljs-keyword\"\u003eyield\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;world\u0026quot;\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// str2 = 333\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e str2\n}\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e iter = \u003cspan class=\"hljs-title function_\"\u003egen\u003c/span\u003e()\n\u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(iter.\u003cspan class=\"hljs-title function_\"\u003enext\u003c/span\u003e())\n\u003cspan class=\"hljs-comment\"\u003e// { value: \u0026quot;hello\u0026quot;, done: false }\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(iter.\u003cspan class=\"hljs-title function_\"\u003enext\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e222\u003c/span\u003e))\n\u003cspan class=\"hljs-comment\"\u003e// { value: \u0026quot;world\u0026quot;, done: false }\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(iter.\u003cspan class=\"hljs-title function_\"\u003enext\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e333\u003c/span\u003e))\n\u003cspan class=\"hljs-comment\"\u003e// { value: 333, done: false }\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œ\u003ccode\u003egenerator\u003c/code\u003eå‡½æ•°å¼€å§‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ç¬¬ä¸€ä¸ª\u003ccode\u003eyield\u003c/code\u003eè¡¨è¾¾å¼ä¸ºæ­¢ã€‚\u003ccode\u003enext\u003c/code\u003eæ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„\u003ccode\u003evalue\u003c/code\u003eå€¼å°±æ˜¯å½“å‰\u003ccode\u003eyield\u003c/code\u003eè¡¨è¾¾å¼çš„å€¼ï¼Œ\u003ccode\u003edone\u003c/code\u003eçš„å€¼ä¸º\u003ccode\u003efalse\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eç¬¬äºŒæ¬¡è°ƒç”¨ï¼Œ\u003ccode\u003egenerator\u003c/code\u003eä»ä¸Šæ¬¡\u003ccode\u003eyield\u003c/code\u003eè¡¨è¾¾å¼åœä¸‹æ¥çš„åœ°æ–¹ä¸€ç›´æ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ª\u003ccode\u003eyield\u003c/code\u003eè¡¨è¾¾å¼ ğŸ‘† â€¦â€¦\u003c/p\u003e\n\u003cp\u003eç¬¬ä¸‰æ¬¡è°ƒç”¨ï¼Œ\u003ccode\u003egenerator\u003c/code\u003eå‡½æ•°ä»ä¸Šæ¬¡\u003ccode\u003eyield\u003c/code\u003eè¡¨è¾¾å¼åœä¸‹æ¥çš„åœ°æ–¹ä¸€ç›´æ‰§è¡Œåˆ°\u003ccode\u003ereturn\u003c/code\u003eè¯­å¥ï¼Œ\u003ccode\u003enext\u003c/code\u003eè¿”å›çš„\u003ccode\u003evalue\u003c/code\u003eå€¼å°±æ˜¯\u003ccode\u003ereturn\u003c/code\u003eåé¢è¡¨è¾¾å¼çš„å€¼ï¼Œ\u003ccode\u003edone\u003c/code\u003eä¸º\u003ccode\u003etrue\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eyield\u003c/code\u003eè¡¨è¾¾å¼æœ¬èº«æ²¡æœ‰è¿”å›å€¼ï¼ˆæˆ–è€…è¯´æ€»æ˜¯è¿”å›\u003ccode\u003eundefined\u003c/code\u003eï¼‰ã€‚\u003ccode\u003enext\u003c/code\u003eæ–¹æ³•å¯ä»¥å¸¦ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°ä¼šè¢«å½“ä½œ\u003cstrong\u003eä¸Šä¸€ä¸ª\u003c/strong\u003e\u003ccode\u003eyield\u003c/code\u003eè¡¨è¾¾å¼çš„è¿”å›å€¼\u003c/p\u003e\n\n      \u003ch2\u003e\n        \u003cspan class=\"prefix\"\u003e\u003c/span\u003e\n        \u003cspan class=\"content\"\u003ePromise\u003c/span\u003e\n        \u003cspan class=\"suffix\"\u003e\u003c/span\u003e\n      \u003c/h2\u003e\n    \u003cp\u003eES6æä¾›çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹æ–¹æ¡ˆ\u003c/p\u003e\n\u003cp\u003eä¸€ä¸ª\u003ccode\u003ePromise\u003c/code\u003eå¯¹è±¡å¿…ç„¶å¤„äºä»¥ä¸‹ä¸‰ç§çŠ¶æ€ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ependingï¼Œåˆå§‹çŠ¶æ€\u003c/li\u003e\n\u003cli\u003efulfilledï¼ŒæˆåŠŸ\u003c/li\u003e\n\u003cli\u003erejectedï¼Œå¤±è´¥\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003ccode\u003epending\u003c/code\u003eçŠ¶æ€çš„\u003ccode\u003ePromise\u003c/code\u003eå¯¹è±¡å¯ä»¥è½¬æ¢ä¸º\u003ccode\u003efulfilled\u003c/code\u003eæˆ–\u003ccode\u003erejected\u003c/code\u003eçŠ¶æ€ï¼Œè€Œä¸”æ­¤è¿‡ç¨‹æ˜¯ä¸å¯é€†çš„ã€‚å½“çŠ¶æ€å˜æ›´æ—¶ï¼Œ\u003ccode\u003ethen()\u003c/code\u003eæ–¹æ³•æ³¨å†Œçš„å›è°ƒå°±ä¼šè¢«è°ƒç”¨\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ethen()\u003c/code\u003e æˆ–è€… \u003ccode\u003ecatch()\u003c/code\u003e çš„å‚æ•°æœŸæœ›æ˜¯å‡½æ•°ï¼Œä¼ â¼Šâ¾®å‡½æ•°åˆ™ä¼šå‘â½£å€¼é€ä¼ \u003ccode\u003e(value =\u0026gt; value)\u003c/code\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eresolve\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n .\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e) \u003cspan class=\"hljs-comment\"\u003e// .then(1 =\u0026gt; 1)\u003c/span\u003e\n .\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eresolve\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e)) \u003cspan class=\"hljs-comment\"\u003e// .then(1 =\u0026gt; 1)\u003c/span\u003e\n .\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elog\u003c/span\u003e)\n\u003cspan class=\"hljs-comment\"\u003e// 1\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eurl, options = {}\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e xhr = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eXMLHttpRequest\u003c/span\u003e();\n    xhr.\u003cspan class=\"hljs-title function_\"\u003eopen\u003c/span\u003e(options.\u003cspan class=\"hljs-property\"\u003emethod\u003c/span\u003e || \u003cspan class=\"hljs-string\"\u003e\u0026#x27;GET\u0026#x27;\u003c/span\u003e, url);\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e headers = { \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Content-Type\u0026#x27;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;application/json\u0026#x27;\u003c/span\u003e, ...options.\u003cspan class=\"hljs-property\"\u003eheaders\u003c/span\u003e || {} };\n    \u003cspan class=\"hljs-title class_\"\u003eReflect\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eownKeys\u003c/span\u003e(headers)\n      .\u003cspan class=\"hljs-title function_\"\u003eforEach\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eheader\u003c/span\u003e) =\u0026gt;\u003c/span\u003e xhr.\u003cspan class=\"hljs-title function_\"\u003esetRequestHeader\u003c/span\u003e(header, headers[header]));\n    xhr.\u003cspan class=\"hljs-title function_\"\u003esend\u003c/span\u003e(options.\u003cspan class=\"hljs-property\"\u003emethod\u003c/span\u003e === \u003cspan class=\"hljs-string\"\u003e\u0026#x27;POST\u0026#x27;\u003c/span\u003e ? \u003cspan class=\"hljs-title class_\"\u003eJSON\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003estringify\u003c/span\u003e(options.\u003cspan class=\"hljs-property\"\u003edata\u003c/span\u003e || {}) : \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e);\n    xhr.\u003cspan class=\"hljs-property\"\u003eonerror\u003c/span\u003e = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ereject\u003c/span\u003e(e);\n    xhr.\u003cspan class=\"hljs-property\"\u003eonreadystatechange\u003c/span\u003e = \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (xhr.\u003cspan class=\"hljs-property\"\u003ereadyState\u003c/span\u003e === \u003cspan class=\"hljs-title class_\"\u003eXMLHttpRequest\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eDONE\u003c/span\u003e\n        \u0026amp;\u0026amp; [\u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e201\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e301\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e302\u003c/span\u003e, \u003cspan class=\"hljs-number\"\u003e304\u003c/span\u003e].\u003cspan class=\"hljs-title function_\"\u003eincludes\u003c/span\u003e(xhr.\u003cspan class=\"hljs-property\"\u003estatus\u003c/span\u003e)) {\n        \u003cspan class=\"hljs-title function_\"\u003eresolve\u003c/span\u003e(\u003cspan class=\"hljs-title class_\"\u003eJSON\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eparse\u003c/span\u003e(xhr.\u003cspan class=\"hljs-property\"\u003eresponseText\u003c/span\u003e));\n      }\n    };\n  });\n}\n\u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;http://localhost:3004/get\u0026#x27;\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(res);\n}).\u003cspan class=\"hljs-title function_\"\u003ecatch\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eerror\u003c/span\u003e(e);\n})\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve,reject\u003c/span\u003e)=\u0026gt;\u003c/span\u003e{\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;1\u0026quot;\u003c/span\u003e)\n    \u003cspan class=\"hljs-title function_\"\u003eresolve\u003c/span\u003e();\n}).\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e()=\u0026gt;\u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// å¤–éƒ¨ç¬¬1ä¸ªthen\u003c/span\u003e\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;2\u0026quot;\u003c/span\u003e)\n    \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve,reject\u003c/span\u003e)=\u0026gt;\u003c/span\u003e{\n        \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;3\u0026quot;\u003c/span\u003e)\n        \u003cspan class=\"hljs-title function_\"\u003eresolve\u003c/span\u003e();\n    }).\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e()=\u0026gt;\u003c/span\u003e{\n        \u003cspan class=\"hljs-comment\"\u003e// å†…éƒ¨ç¬¬1ä¸ªthen\u003c/span\u003e\n        \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;4\u0026quot;\u003c/span\u003e)\n    }).\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-comment\"\u003e// å†…éƒ¨ç¬¬2ä¸ªthen\u003c/span\u003e\n        \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;5\u0026quot;\u003c/span\u003e)\n    })\n}).\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e)=\u0026gt;\u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// å¤–éƒ¨ç¬¬2ä¸ªthen\u003c/span\u003e\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;6\u0026quot;\u003c/span\u003e)\n})\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eç®€å•æ¥è®²å°±æ˜¯thenå›è°ƒçš„æ³¨å†Œéœ€è¦ä¸Šä¸€ä¸ªthené‡Œé¢çš„åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•\u003c/p\u003e\n\u003cp\u003eæ‹¿ä¸Šé¢çš„ä»£ç æ¥è®²ï¼Œå½“å¤–éƒ¨ç¬¬1ä¸ªthené‡Œçš„resovle()æ‰§è¡Œå®Œæ¯•åï¼Œè¯¥Promiseçš„çŠ¶æ€å·²ç»æ›´æ”¹ï¼Œä¼šå°†å†…éƒ¨ç¬¬1ä¸ªthenå›è°ƒæ·»åŠ ï¼ˆæ³¨å†Œï¼‰åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼›å†…éƒ¨ç¬¬2ä¸ªthenç”±äºä¸Šä¸€ä¸ªthenå›è°ƒæ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œå› æ­¤ä¸ä¼šæ³¨å†Œã€‚æ­¤æ—¶å¤–éƒ¨ç¬¬1ä¸ªthené‡Œçš„åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œä¼šæ³¨å†Œå¤–éƒ¨ç¬¬2ä¸ªthenå›è°ƒ\u003c/p\u003e\n\u003cp\u003eæ•´ç†ä¸€ä¸‹ï¼šthenå›è°ƒæ³¨å†Œçš„é¡ºåºæ˜¯ï¼šå¤–éƒ¨ç¬¬1ä¸ªthen --\u0026gt; å†…éƒ¨ç¬¬1ä¸ªthen --\u0026gt; å¤–éƒ¨ç¬¬2ä¸ªthen --\u0026gt; å†…éƒ¨ç¬¬2ä¸ªthen\u003c/p\u003e\n\u003cp\u003eps: å¦‚æœå°†å¤–éƒ¨ç¬¬1ä¸ªthené‡Œçš„new Promise(xxx)æ”¹ä¸ºreturn new Promise(xxx)çš„è¯å†…éƒ¨ç¬¬2ä¸ªthençš„æ³¨å†Œå°†æ—©äº* å¤–éƒ¨ç¬¬2ä¸ªthen*\u003c/p\u003e\n\n      \u003ch2\u003e\n        \u003cspan class=\"prefix\"\u003e\u003c/span\u003e\n        \u003cspan class=\"content\"\u003easync/await\u003c/span\u003e\n        \u003cspan class=\"suffix\"\u003e\u003c/span\u003e\n      \u003c/h2\u003e\n    \u003cp\u003eç›®å‰æ¥è®²ï¼Œæœ€ä¸ºä¼˜ç§€çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹æ–¹æ¡ˆï¼Œä¸ES2017æå‡º\u003c/p\u003e\n\u003cp\u003eå®ç°ä¸Šæ˜¯\u003ccode\u003eGenerator\u003c/code\u003e+\u003ccode\u003ePromise\u003c/code\u003eçš„è¯­æ³•ç³–\u003c/p\u003e\n\u003cp\u003eé€šè¿‡åœ¨\u003ccode\u003eonFulFilled()\u003c/code\u003eé‡Œè°ƒç”¨\u003ccode\u003enext()\u003c/code\u003eã€åœ¨\u003ccode\u003enext()\u003c/code\u003eé‡Œè°ƒç”¨\u003ccode\u003eonFulfilled()\u003c/code\u003eå½¢æˆä¸€ä¸ªè‡ªæ‰§è¡Œå™¨ï¼Œåªæœ‰å½“å…¨éƒ¨ä»£ç æ‰§è¡Œå®Œæ¯•åæ‰ä¼šç»ˆæ­¢\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efn\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e res = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;http://localhost:3004/get\u0026#x27;\u003c/span\u003e);\n        \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(res);\n    } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (e) {\n        \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eerror\u003c/span\u003e(e);\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003easync/await\u003c/code\u003eåŸç†: \u003cstrong\u003eè‡ªåŠ¨æ‰§è¡Œgeneratorå‡½æ•°\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetData\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) =\u0026gt;\n  \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve\u003c/span\u003e) =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003esetTimeout\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eresolve\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;data\u0026quot;\u003c/span\u003e), \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e));\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e* \u003cspan class=\"hljs-title function_\"\u003etestG\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-comment\"\u003e// awaitè¢«ç¼–è¯‘æˆäº†yield\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e data = \u003cspan class=\"hljs-keyword\"\u003eyield\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetData\u003c/span\u003e();\n  \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;data: \u0026quot;\u003c/span\u003e, data);\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e data2 = \u003cspan class=\"hljs-keyword\"\u003eyield\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetData\u003c/span\u003e();\n  \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;data2: \u0026quot;\u003c/span\u003e, data2);\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;success\u0026quot;\u003c/span\u003e;\n}\n\n\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003easyncToGenerator\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003egeneratorFunc\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e...args\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e gen = generatorFunc.\u003cspan class=\"hljs-title function_\"\u003eapply\u003c/span\u003e(\u003cspan class=\"hljs-variable language_\"\u003ethis\u003c/span\u003e, args);\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003estep\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ekey, arg\u003c/span\u003e) {\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e generatorResult;\n        \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n          generatorResult = gen[key](arg);\n        } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (error) {\n          \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003ereject\u003c/span\u003e(error);\n        }\n\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { value, done } = generatorResult;\n\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (done) {\n          \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eresolve\u003c/span\u003e(value);\n        } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n          \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eresolve\u003c/span\u003e(value).\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\n            \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eonResolve\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eval\u003c/span\u003e) {\n              \u003cspan class=\"hljs-title function_\"\u003estep\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;next\u0026quot;\u003c/span\u003e, val);\n            },\n            \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eonReject\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e) {\n              \u003cspan class=\"hljs-title function_\"\u003estep\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;throw\u0026quot;\u003c/span\u003e, err);\n            }\n          );\n        }\n      }\n      \u003cspan class=\"hljs-title function_\"\u003estep\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;next\u0026quot;\u003c/span\u003e);\n    });\n  };\n}\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e testGAsync = \u003cspan class=\"hljs-title function_\"\u003easyncToGenerator\u003c/span\u003e(testG);\n\u003cspan class=\"hljs-title function_\"\u003etestGAsync\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresult\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(result);\n});\n\u003c/code\u003e\u003c/pre\u003e\n\n      \u003ch2\u003e\n        \u003cspan class=\"prefix\"\u003e\u003c/span\u003e\n        \u003cspan class=\"content\"\u003eå‚è€ƒ\u003c/span\u003e\n        \u003cspan class=\"suffix\"\u003e\u003c/span\u003e\n      \u003c/h2\u003e\n    \u003cp\u003e\u003ca href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise\"\u003eMDN-Promise\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/imtaotao/co-share\"\u003eco-share\u003c/a\u003e\u003c/p\u003e\n"}},"__N_SSG":true},"page":"/post/[title]","query":{"title":"JavaScriptå¤ä¹ -å¼‚æ­¥"},"buildId":"6Z6s6-Ql91pBaqq4AHUDJ","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>